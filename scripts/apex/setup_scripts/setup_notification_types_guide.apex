// CustomNotificationType ì„¤ì • ì™„ì „ ê°€ì´ë“œ ë° í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
System.debug('ğŸ”” =====CustomNotificationType ì„¤ì • ì™„ì „ ê°€ì´ë“œ=====');

try {
    System.debug('');
    System.debug('ğŸ“‹ í˜„ì¬ ì„¤ì • ìƒíƒœ í™•ì¸ ì¤‘...');
    
    // 1. í˜„ì¬ ì„¤ì •ëœ ëª¨ë“  CustomNotificationType ì¡°íšŒ
    List<CustomNotificationType> allTypes = [
        SELECT Id, DeveloperName, MasterLabel, Description, 
               Desktop, Mobile, CreatedDate, CreatedBy.Name
        FROM CustomNotificationType 
        ORDER BY CreatedDate DESC
    ];
    
    System.debug('');
    System.debug('ğŸ“Š ì „ì²´ CustomNotificationType ìˆ˜: ' + allTypes.size() + 'ê°œ');
    
    Boolean salesOrderExists = false;
    Boolean paymentNotificationExists = false;
    CustomNotificationType salesOrderType = null;
    CustomNotificationType paymentType = null;
    
    // ê¸°ì¡´ ì„¤ì • í™•ì¸
    for (CustomNotificationType type : allTypes) {
        System.debug('   â€¢ ' + type.MasterLabel + ' (' + type.DeveloperName + ')');
        System.debug('     - Desktop: ' + type.Desktop + ', Mobile: ' + type.Mobile);
        System.debug('     - ìƒì„±ì¼: ' + type.CreatedDate.format('yyyy-MM-dd HH:mm') + ' by ' + type.CreatedBy.Name);
        
        if (type.DeveloperName == 'Sales_Order_Notification') {
            salesOrderExists = true;
            salesOrderType = type;
        }
        if (type.DeveloperName == 'Payment_Notification') {
            paymentNotificationExists = true;
            paymentType = type;
        }
        System.debug('');
    }
    
    // 2. í•„ìˆ˜ ì„¤ì • ìƒíƒœ í™•ì¸
    System.debug('ğŸ¯ í•„ìˆ˜ ì„¤ì • ìƒíƒœ:');
    System.debug('');
    
    if (salesOrderExists) {
        System.debug('   âœ… Sales_Order_Notification: ì„¤ì • ì™„ë£Œ');
        System.debug('      - ID: ' + salesOrderType.Id);
        System.debug('      - Label: ' + salesOrderType.MasterLabel);
        System.debug('      - Desktop ì•Œë¦¼: ' + salesOrderType.Desktop);
        System.debug('      - Mobile ì•Œë¦¼: ' + salesOrderType.Mobile);
        System.debug('      - Description: ' + salesOrderType.Description);
    } else {
        System.debug('   âŒ Sales_Order_Notification: ì„¤ì • í•„ìš”');
    }
    
    System.debug('');
    
    if (paymentNotificationExists) {
        System.debug('   âœ… Payment_Notification: ì„¤ì • ì™„ë£Œ (ì„ íƒì‚¬í•­)');
        System.debug('      - ID: ' + paymentType.Id);
        System.debug('      - Label: ' + paymentType.MasterLabel);
        System.debug('      - Desktop ì•Œë¦¼: ' + paymentType.Desktop);
        System.debug('      - Mobile ì•Œë¦¼: ' + paymentType.Mobile);
    } else {
        System.debug('   âš ï¸ Payment_Notification: ë¯¸ì„¤ì • (ì„ íƒì‚¬í•­)');
    }
    
    // 3. ì„¤ì •ì´ í•„ìš”í•œ ê²½ìš° ìƒì„¸ ê°€ì´ë“œ ì œê³µ
    if (!salesOrderExists || !paymentNotificationExists) {
        System.debug('');
        System.debug('ğŸ”§ =====CustomNotificationType ìƒì„± ê°€ì´ë“œ=====');
        System.debug('');
        System.debug('ë‹¤ìŒ ë‹¨ê³„ë¥¼ ë”°ë¼ Salesforce Setupì—ì„œ ìƒì„±í•´ì£¼ì„¸ìš”:');
        System.debug('');
        System.debug('1ï¸âƒ£ Setup ì ‘ê·¼:');
        System.debug('   â€¢ Salesforce ìš°ìƒë‹¨ âš™ï¸ Setup í´ë¦­');
        System.debug('   â€¢ Quick Findì—ì„œ "Custom Notifications" ê²€ìƒ‰');
        System.debug('   â€¢ "Custom Notification Types" ì„ íƒ');
        System.debug('');
        
        if (!salesOrderExists) {
            System.debug('2ï¸âƒ£ Sales_Order_Notification ìƒì„± (í•„ìˆ˜):');
            System.debug('   â€¢ "New" ë²„íŠ¼ í´ë¦­');
            System.debug('   â€¢ Custom Notification Type Name: Sales Order Notification');
            System.debug('   â€¢ API Name: Sales_Order_Notification');
            System.debug('   â€¢ Description: Order ìƒì„±, Slack ì±„ë„ ìƒì„±, ì—°ì²´ ì•Œë¦¼ì„ ìœ„í•œ Sales ì•± ì•Œë¦¼');
            System.debug('   â€¢ Desktop: âœ… ì²´í¬');
            System.debug('   â€¢ Mobile: âœ… ì²´í¬');
            System.debug('   â€¢ "Save" í´ë¦­');
            System.debug('');
        }
        
        if (!paymentNotificationExists) {
            System.debug('3ï¸âƒ£ Payment_Notification ìƒì„± (ì„ íƒì‚¬í•­):');
            System.debug('   â€¢ "New" ë²„íŠ¼ í´ë¦­');
            System.debug('   â€¢ Custom Notification Type Name: Payment Notification');
            System.debug('   â€¢ API Name: Payment_Notification');
            System.debug('   â€¢ Description: ë‚©ë¶€ ì˜ˆì • ë° ì—°ì²´ ì•Œë¦¼ì„ ìœ„í•œ ìƒì„¸ ì•Œë¦¼');
            System.debug('   â€¢ Desktop: âœ… ì²´í¬');
            System.debug('   â€¢ Mobile: âœ… ì²´í¬');
            System.debug('   â€¢ "Save" í´ë¦­');
            System.debug('');
        }
        
        System.debug('4ï¸âƒ£ ìƒì„± ì™„ë£Œ í›„:');
        System.debug('   â€¢ ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ì—¬ ì„¤ì • í™•ì¸');
        System.debug('   â€¢ ë¸Œë¼ìš°ì €ì—ì„œ Salesforce ì•Œë¦¼ ê¶Œí•œ í—ˆìš©');
        System.debug('   â€¢ Lightning Experience ì‚¬ìš© (Classic ë¶ˆê°€)');
        System.debug('');
    }
    
    // 4. í˜„ì¬ ì‚¬ìš©ì ë° í™˜ê²½ ì •ë³´
    System.debug('ğŸ‘¤ í˜„ì¬ ì‚¬ìš©ì ë° í™˜ê²½ ì •ë³´:');
    
    User currentUser = [
        SELECT Id, Name, Email, ProfileId, Profile.Name, 
               ManagerId, Manager.Name, Manager.Email, IsActive
        FROM User 
        WHERE Id = :UserInfo.getUserId()
    ];
    
    System.debug('   ì‚¬ìš©ì: ' + currentUser.Name + ' (' + currentUser.Email + ')');
    System.debug('   Profile: ' + currentUser.Profile.Name);
    System.debug('   í™œì„± ìƒíƒœ: ' + currentUser.IsActive);
    
    if (currentUser.ManagerId != null) {
        System.debug('   Manager: ' + currentUser.Manager.Name + ' (' + currentUser.Manager.Email + ')');
    } else {
        System.debug('   Manager: ì—†ìŒ');
    }
    
    System.debug('   ì¡°ì§ ID: ' + UserInfo.getOrganizationId());
    System.debug('   ì‚¬ìš©ì ID: ' + UserInfo.getUserId());
    
    // 5. ì•Œë¦¼ í…ŒìŠ¤íŠ¸ (ì„¤ì •ì´ ì™„ë£Œëœ ê²½ìš°)
    if (salesOrderExists) {
        System.debug('');
        System.debug('ğŸ§ª Sales Order ì•Œë¦¼ í…ŒìŠ¤íŠ¸:');
        
        try {
            Set<String> recipients = new Set<String>();
            recipients.add(UserInfo.getUserId());
            
            // Managerê°€ ìˆìœ¼ë©´ ì¶”ê°€
            if (currentUser.ManagerId != null) {
                recipients.add(currentUser.ManagerId);
            }
            
            Messaging.CustomNotification testNotification = new Messaging.CustomNotification();
            testNotification.setTitle('ğŸ§ª Sales Order ì•Œë¦¼ í…ŒìŠ¤íŠ¸');
            testNotification.setBody('CustomNotificationType ì„¤ì •ì´ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
            testNotification.setNotificationTypeId(salesOrderType.Id);
            testNotification.send(recipients);
            
            System.debug('   âœ… í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë°œì†¡ ì™„ë£Œ');
            System.debug('   ğŸ’¡ Salesforce ìƒë‹¨ ğŸ”” ë²¨ ì•„ì´ì½˜ì„ í™•ì¸í•´ë³´ì„¸ìš”!');
            System.debug('   ğŸ“± Mobile ì•±ì—ì„œë„ í‘¸ì‹œ ì•Œë¦¼ì´ ë„ì°©í•©ë‹ˆë‹¤.');
            
        } catch (Exception testEx) {
            System.debug('   âŒ í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨: ' + testEx.getMessage());
            System.debug('   ğŸ’¡ ë¸Œë¼ìš°ì € ì•Œë¦¼ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
        }
    }
    
    if (paymentNotificationExists) {
        System.debug('');
        System.debug('ğŸ§ª Payment ì•Œë¦¼ í…ŒìŠ¤íŠ¸:');
        
        try {
            Set<String> recipients = new Set<String>();
            recipients.add(UserInfo.getUserId());
            
            Messaging.CustomNotification paymentTestNotification = new Messaging.CustomNotification();
            paymentTestNotification.setTitle('ğŸ’° Payment ì•Œë¦¼ í…ŒìŠ¤íŠ¸');
            paymentTestNotification.setBody('ë‚©ë¶€ ì•Œë¦¼ ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.');
            paymentTestNotification.setNotificationTypeId(paymentType.Id);
            paymentTestNotification.send(recipients);
            
            System.debug('   âœ… Payment í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë°œì†¡ ì™„ë£Œ');
            
        } catch (Exception paymentTestEx) {
            System.debug('   âŒ Payment í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨: ' + paymentTestEx.getMessage());
        }
    }
    
    // 6. ë¸Œë¼ìš°ì € ì„¤ì • ê°€ì´ë“œ
    System.debug('');
    System.debug('ğŸŒ ë¸Œë¼ìš°ì € ì„¤ì • í™•ì¸:');
    System.debug('   Chrome: ì£¼ì†Œì°½ ì™¼ìª½ ğŸ”’ ì•„ì´ì½˜ > ì•Œë¦¼ > í—ˆìš©');
    System.debug('   Firefox: ì£¼ì†Œì°½ ì™¼ìª½ ì•„ì´ì½˜ > ì•Œë¦¼ ê¶Œí•œ > í—ˆìš©');
    System.debug('   Safari: í™˜ê²½ì„¤ì • > ì›¹ì‚¬ì´íŠ¸ > ì•Œë¦¼ > Salesforce í—ˆìš©');
    
    // 7. ìµœì¢… ìƒíƒœ ìš”ì•½
    System.debug('');
    System.debug('ğŸ“Š =====ì„¤ì • ì™„ë£Œ ìƒíƒœ ìš”ì•½=====');
    
    Integer completedCount = 0;
    if (salesOrderExists) completedCount++;
    if (paymentNotificationExists) completedCount++;
    
    System.debug('   ì„¤ì • ì™„ë£Œ: ' + completedCount + '/2');
    System.debug('   Sales Order ì•Œë¦¼: ' + (salesOrderExists ? 'âœ… ì™„ë£Œ' : 'âŒ í•„ìš”'));
    System.debug('   Payment ì•Œë¦¼: ' + (paymentNotificationExists ? 'âœ… ì™„ë£Œ' : 'âš ï¸ ì„ íƒì‚¬í•­'));
    
    if (salesOrderExists) {
        System.debug('');
        System.debug('ğŸ‰ Order 00000149 ì•Œë¦¼ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ!');
        System.debug('   â€¢ Order ìƒì„± ì•Œë¦¼: ì¤€ë¹„ë¨');
        System.debug('   â€¢ Slack ì±„ë„ ìƒì„± ì•Œë¦¼: ì¤€ë¹„ë¨');
        System.debug('   â€¢ ì—°ì²´ ì•Œë¦¼: ì¤€ë¹„ë¨');
        System.debug('');
        System.debug('ë‹¤ìŒ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì „ì²´ ì‹œìŠ¤í…œì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”:');
        System.debug('sfdx force:apex:execute -f scripts/apex/review_order_149_notifications.apex');
    } else {
        System.debug('');
        System.debug('âš ï¸ ì•„ì§ ì„¤ì •ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        System.debug('   ìœ„ì˜ ê°€ì´ë“œë¥¼ ë”°ë¼ CustomNotificationTypeì„ ìƒì„±í•´ì£¼ì„¸ìš”.');
    }
    
} catch (Exception e) {
    System.debug('âŒ CustomNotificationType í™•ì¸ ì¤‘ ì˜¤ë¥˜: ' + e.getMessage());
    System.debug('   íƒ€ì…: ' + e.getTypeName());
    System.debug('   ë¼ì¸: ' + e.getLineNumber());
    System.debug('   ìŠ¤íƒ: ' + e.getStackTraceString());
}

System.debug('');
System.debug('âœ… =====CustomNotificationType ì„¤ì • ê°€ì´ë“œ ì™„ë£Œ=====');
