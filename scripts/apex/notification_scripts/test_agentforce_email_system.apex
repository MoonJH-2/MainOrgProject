/**
 * @description Agentforce Email ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
 * @author AI Assistant
 * @created 2025-07-24
 */

System.debug('ğŸ“§ =====Agentforce Email ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸=====');

System.debug('');
System.debug('ğŸ¯ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ');
System.debug('1. Order ê´€ë ¨ ì´ë©”ì¼ ìƒì„±');
System.debug('2. Payment ì•Œë¦¼ ì´ë©”ì¼ ìƒì„±');
System.debug('3. Asset ê°±ì‹  ì´ë©”ì¼ ìƒì„±');
System.debug('4. ì´ë©”ì¼ ìˆ˜ì • ê¸°ëŠ¥');

System.debug('');
System.debug('ğŸ“‹ 1. Order Email í…ŒìŠ¤íŠ¸');

try {
    // í…ŒìŠ¤íŠ¸ìš© Order ì¡°íšŒ
    List<Order> testOrders = [
        SELECT Id, OrderNumber, Status, Account.Name, Owner.Name
        FROM Order 
        WHERE OrderNumber IN ('00000153', '00000151', '00000138')
        LIMIT 3
    ];
    
    if (!testOrders.isEmpty()) {
        Order testOrder = testOrders[0];
        System.debug('âœ… í…ŒìŠ¤íŠ¸ Order: ' + testOrder.OrderNumber + ' (' + testOrder.Account.Name + ')');
        
        // Order Email Action í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜
        AgentforceEmailActions.OrderEmailRequest request = new AgentforceEmailActions.OrderEmailRequest();
        request.orderId = testOrder.Id;
        request.emailType = 'Order_Confirmation';
        
        List<AgentforceEmailActions.OrderEmailRequest> requests = new List<AgentforceEmailActions.OrderEmailRequest>{request};
        List<AgentforceEmailActions.EmailDraftResult> results = AgentforceEmailActions.draftOrderEmail(requests);
        
        if (!results.isEmpty() && results[0].success) {
            System.debug('ğŸ“§ ìƒì„±ëœ ì´ë©”ì¼ ì œëª©: ' + results[0].emailSubject);
            System.debug('ğŸ“ ì´ë©”ì¼ ë‚´ìš© (ì¼ë¶€): ' + results[0].emailBody.substring(0, Math.min(100, results[0].emailBody.length())) + '...');
        } else {
            System.debug('âŒ Order ì´ë©”ì¼ ìƒì„± ì‹¤íŒ¨: ' + (results.isEmpty() ? 'No results' : results[0].errorMessage));
        }
    } else {
        System.debug('âš ï¸ í…ŒìŠ¤íŠ¸ìš© Orderê°€ ì—†ìŠµë‹ˆë‹¤.');
    }
    
} catch (Exception e) {
    System.debug('âŒ Order Email í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ' + e.getMessage());
}

System.debug('');
System.debug('ğŸ’° 2. Payment Email í…ŒìŠ¤íŠ¸');

try {
    // PaymentStatus ì¡°íšŒ ì‹œë„
    List<SObject> paymentRecords = Database.query(
        'SELECT Id, Name, Order__c, Order__r.OrderNumber, Status__c ' +
        'FROM PaymentStatus__c LIMIT 1'
    );
    
    if (!paymentRecords.isEmpty()) {
        SObject payment = paymentRecords[0];
        System.debug('âœ… í…ŒìŠ¤íŠ¸ Payment: ' + payment.get('Name') + ' (Order: ' + payment.get('Order__r.OrderNumber') + ')');
        
        // Payment Email Action í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜
        AgentforceEmailActions.PaymentEmailRequest request = new AgentforceEmailActions.PaymentEmailRequest();
        request.paymentId = (String)payment.get('Id');
        request.emailType = 'Payment_Reminder';
        
        List<AgentforceEmailActions.PaymentEmailRequest> requests = new List<AgentforceEmailActions.PaymentEmailRequest>{request};
        List<AgentforceEmailActions.EmailDraftResult> results = AgentforceEmailActions.draftPaymentEmail(requests);
        
        if (!results.isEmpty() && results[0].success) {
            System.debug('ğŸ“§ ìƒì„±ëœ ì´ë©”ì¼ ì œëª©: ' + results[0].emailSubject);
            System.debug('ğŸ“ ì´ë©”ì¼ ë‚´ìš© (ì¼ë¶€): ' + results[0].emailBody.substring(0, Math.min(100, results[0].emailBody.length())) + '...');
        } else {
            System.debug('âŒ Payment ì´ë©”ì¼ ìƒì„± ì‹¤íŒ¨: ' + (results.isEmpty() ? 'No results' : results[0].errorMessage));
        }
    } else {
        System.debug('âš ï¸ PaymentStatus__c ë ˆì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.');
    }
    
} catch (Exception e) {
    System.debug('âŒ Payment Email í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ' + e.getMessage());
    System.debug('ğŸ’¡ PaymentStatus__c Custom Objectê°€ í•„ìš”í•©ë‹ˆë‹¤.');
}

System.debug('');
System.debug('ğŸ”„ 3. Asset Email í…ŒìŠ¤íŠ¸');

try {
    // Asset ì¡°íšŒ
    List<Asset> testAssets = [
        SELECT Id, Name, Status, Account.Name, Account.Owner.Name
        FROM Asset 
        WHERE Status = 'Installed'
        LIMIT 1
    ];
    
    if (!testAssets.isEmpty()) {
        Asset testAsset = testAssets[0];
        System.debug('âœ… í…ŒìŠ¤íŠ¸ Asset: ' + testAsset.Name + ' (' + testAsset.Account.Name + ')');
        
        // Asset Email Action í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜
        AgentforceEmailActions.AssetEmailRequest request = new AgentforceEmailActions.AssetEmailRequest();
        request.assetId = testAsset.Id;
        request.emailType = 'Asset_Renewal_Notice';
        
        List<AgentforceEmailActions.AssetEmailRequest> requests = new List<AgentforceEmailActions.AssetEmailRequest>{request};
        List<AgentforceEmailActions.EmailDraftResult> results = AgentforceEmailActions.draftAssetRenewalEmail(requests);
        
        if (!results.isEmpty() && results[0].success) {
            System.debug('ğŸ“§ ìƒì„±ëœ ì´ë©”ì¼ ì œëª©: ' + results[0].emailSubject);
            System.debug('ğŸ“ ì´ë©”ì¼ ë‚´ìš© (ì¼ë¶€): ' + results[0].emailBody.substring(0, Math.min(100, results[0].emailBody.length())) + '...');
        } else {
            System.debug('âŒ Asset ì´ë©”ì¼ ìƒì„± ì‹¤íŒ¨: ' + (results.isEmpty() ? 'No results' : results[0].errorMessage));
        }
    } else {
        System.debug('âš ï¸ ì„¤ì¹˜ëœ Assetì´ ì—†ìŠµë‹ˆë‹¤.');
    }
    
} catch (Exception e) {
    System.debug('âŒ Asset Email í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ' + e.getMessage());
}

System.debug('');
System.debug('âœï¸ 4. Email ìˆ˜ì • ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸');

try {
    // ì´ë©”ì¼ ìˆ˜ì • í…ŒìŠ¤íŠ¸
    AgentforceEmailActions.EmailRevisionRequest request = new AgentforceEmailActions.EmailRevisionRequest();
    request.originalSubject = '[ì•Œë¦¼] Order 00000153 - í…ŒìŠ¤íŠ¸ ì£¼ë¬¸';
    request.originalBody = 'ì•ˆë…•í•˜ì„¸ìš”, ê³ ê°ë‹˜\n\nì£¼ë¬¸ ê´€ë ¨ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.\n\nê°ì‚¬í•©ë‹ˆë‹¤.';
    request.revisionInstructions = 'formal';
    request.recipientEmail = 'test@example.com';
    
    List<AgentforceEmailActions.EmailRevisionRequest> requests = new List<AgentforceEmailActions.EmailRevisionRequest>{request};
    List<AgentforceEmailActions.EmailDraftResult> results = AgentforceEmailActions.reviseEmailDraft(requests);
    
    if (!results.isEmpty() && results[0].success) {
        System.debug('âœ… ìˆ˜ì •ëœ ì´ë©”ì¼ ì œëª©: ' + results[0].emailSubject);
        System.debug('ğŸ“ ìˆ˜ì •ëœ ë‚´ìš©: ' + results[0].emailBody);
        System.debug('ğŸ“‹ ìˆ˜ì • ë‚´ì—­: ' + results[0].revisionNotes);
    } else {
        System.debug('âŒ ì´ë©”ì¼ ìˆ˜ì • ì‹¤íŒ¨: ' + (results.isEmpty() ? 'No results' : results[0].errorMessage));
    }
    
} catch (Exception e) {
    System.debug('âŒ Email ìˆ˜ì • í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ' + e.getMessage());
}

System.debug('');
System.debug('ğŸ¯ Agentforce ì—°ë™ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤');
System.debug('Agent Conversationì—ì„œ í…ŒìŠ¤íŠ¸í•  ì§ˆë¬¸ë“¤:');
System.debug('');
System.debug('1. "Order 00000153ì— ëŒ€í•œ í™•ì¸ ì´ë©”ì¼ì„ ì‘ì„±í•´ì¤˜"');
System.debug('   â†’ Draft Order Email Action ì‹¤í–‰ í™•ì¸');
System.debug('');
System.debug('2. "Payment ì—°ì²´ ì•Œë¦¼ ì´ë©”ì¼ì´ í•„ìš”í•´"');
System.debug('   â†’ Draft Payment Email Action ì‹¤í–‰ í™•ì¸');
System.debug('');
System.debug('3. "Asset ê°±ì‹  ì•ˆë‚´ ì´ë©”ì¼ì„ ë§Œë“¤ì–´ì¤˜"');
System.debug('   â†’ Draft Asset Renewal Email Action ì‹¤í–‰ í™•ì¸');
System.debug('');
System.debug('4. "ìœ„ ì´ë©”ì¼ì„ ë” ê³µì‹ì ìœ¼ë¡œ ìˆ˜ì •í•´ì¤˜"');
System.debug('   â†’ Revise Email Draft Action ì‹¤í–‰ í™•ì¸');
System.debug('');
System.debug('5. "ì´ë©”ì¼ì„ ê°„ë‹¨í•˜ê²Œ ìš”ì•½í•´ì„œ ë‹¤ì‹œ ì‘ì„±í•´ì¤˜"');
System.debug('   â†’ Standard "Draft or Revise Email" Action ì—°ë™ í™•ì¸');

System.debug('');
System.debug('ğŸ“Š ë‹¤ìŒ ë‹¨ê³„');
System.debug('1. AgentforceEmailActions í´ë˜ìŠ¤ ë°°í¬');
System.debug('2. Agentforce Studioì—ì„œ Custom Actions ë“±ë¡');
System.debug('3. Agent Builderì—ì„œ Email Communications Topic ìƒì„±');
System.debug('4. Conversation Previewì—ì„œ ì‹¤ì œ í…ŒìŠ¤íŠ¸');
System.debug('5. í•„ìš”ì‹œ Email Templates Setup ì¶”ê°€ ì„¤ì •');

System.debug('');
System.debug('âœ… Agentforce Email ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!');
