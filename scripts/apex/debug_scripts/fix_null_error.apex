/**
 * ì˜¤ë¥˜ í•´ê²°ì„ ìœ„í•œ ë°ì´í„° ì •ë¦¬ ë° ì¬ìƒì„±
 * ëª©ì : Null ê°’ ë¬¸ì œ í•´ê²° ë° ì™„ì „í•œ ë°ì´í„° ìƒì„±
 */

System.debug('ğŸ”§ === ì˜¤ë¥˜ í•´ê²° ì‹œì‘ ===');

try {
    // 1. ê¸°ì¡´ ë¶ˆì™„ì „í•œ ë°ì´í„° ì‚­ì œ
    System.debug('ğŸ—‘ï¸ ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬ ì¤‘...');
    
    List<Opportunity> oldOpps = [SELECT Id FROM Opportunity WHERE Account.Name = 'í…ŒìŠ¤íŠ¸ê¸°ì—…'];
    if(!oldOpps.isEmpty()) {
        delete oldOpps;
        System.debug('âœ… ê¸°ì¡´ Opportunity ì‚­ì œ: ' + oldOpps.size() + 'ê°œ');
    }
    
    List<Asset> oldAssets = [SELECT Id FROM Asset WHERE Account.Name = 'í…ŒìŠ¤íŠ¸ê¸°ì—…'];
    if(!oldAssets.isEmpty()) {
        delete oldAssets;
        System.debug('âœ… ê¸°ì¡´ Asset ì‚­ì œ: ' + oldAssets.size() + 'ê°œ');
    }
    
    List<Account> oldAccounts = [SELECT Id FROM Account WHERE Name = 'í…ŒìŠ¤íŠ¸ê¸°ì—…'];
    if(!oldAccounts.isEmpty()) {
        delete oldAccounts;
        System.debug('âœ… ê¸°ì¡´ Account ì‚­ì œ: ' + oldAccounts.size() + 'ê°œ');
    }
    
    // 2. ì™„ì „í•œ ë°ì´í„°ë¡œ ì¬ìƒì„±
    System.debug('ğŸš€ ì™„ì „í•œ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¬ìƒì„±...');
    
    // Account ìƒì„± (í•„ìˆ˜ í•„ë“œ ëª¨ë‘ í¬í•¨, êµ­ê°€ ì˜¤ë¥˜ ìˆ˜ì •)
    Account newAccount = new Account(
        Name = 'í…ŒìŠ¤íŠ¸ê¸°ì—…',
        Type = 'Customer',
        Industry = 'Technology',
        Phone = '02-1234-5678',
        BillingStreet = 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123',
        BillingCity = 'ì„œìš¸',
        BillingPostalCode = '06142'
        // BillingCountryì™€ BillingState ì œê±° (State/Country Picklist ì˜¤ë¥˜ ë°©ì§€)
    );
    insert newAccount;
    System.debug('âœ… ì™„ì „í•œ Account ìƒì„±: ' + newAccount.Name);
    
    // Asset ìƒì„± (ëª¨ë“  í•„ìˆ˜ í•„ë“œ + ì¶”ê°€ ì•ˆì „ì¥ì¹˜)
    Asset safeAsset = new Asset(
        Name = 'ê¸´ê¸‰ ê°±ì‹  ì‹œìŠ¤í…œ',
        AccountId = newAccount.Id,
        Status = 'Installed',
        Price = 30000000.00, // ëª…ì‹œì  Decimal
        Quantity = 1,
        InstallDate = Date.today().addDays(-350), // 350ì¼ ì „
        UsageEndDate = Date.today().addDays(5), // 5ì¼ í›„ ë§Œë£Œ
        PurchaseDate = Date.today().addDays(-350),
        Description = 'ê¸´ê¸‰ ê°±ì‹ ì´ í•„ìš”í•œ í•µì‹¬ ì‹œìŠ¤í…œ',
        SerialNumber = 'TEST-2024-001',
        Product2Id = null // Productê°€ ì—†ì–´ë„ Asset ìƒì„± ê°€ëŠ¥
    );
    insert safeAsset;
    System.debug('âœ… ì™„ì „í•œ Asset ìƒì„±: ' + safeAsset.Name);
    
    // Asset ê²€ì¦
    Asset verifyAsset = [SELECT Id, Name, AccountId, Account.Name, Price, InstallDate, UsageEndDate, Status, Quantity FROM Asset WHERE Id = :safeAsset.Id];
    System.debug('ê²€ì¦ - Account.Name: ' + verifyAsset.Account.Name);
    System.debug('ê²€ì¦ - Price: ' + verifyAsset.Price);
    System.debug('ê²€ì¦ - InstallDate: ' + verifyAsset.InstallDate);
    System.debug('ê²€ì¦ - UsageEndDate: ' + verifyAsset.UsageEndDate);
    
    // ì™„ë£Œëœ Opportunity ìƒì„± (ì´ë²ˆ ë‹¬)
    Opportunity completedOpp = new Opportunity(
        Name = 'í…ŒìŠ¤íŠ¸ê¸°ì—… - ì‹œìŠ¤í…œ ê°±ì‹  ì™„ë£Œ',
        AccountId = newAccount.Id,
        StageName = 'Closed Won',
        CloseDate = Date.today().addDays(-7), // 7ì¼ ì „ ì™„ë£Œ
        Amount = 25000000.00, // ëª…ì‹œì  Decimal
        Type = 'Renewal',
        Probability = 100,
        Description = 'ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œëœ ê°±ì‹  ê³„ì•½',
        LeadSource = 'Existing Customer'
    );
    insert completedOpp;
    System.debug('âœ… ì™„ë£Œëœ Opportunity ìƒì„±: ' + completedOpp.Amount);
    
    // ì§„í–‰ ì¤‘ì¸ Opportunity ìƒì„±
    Opportunity inProgressOpp = new Opportunity(
        Name = 'í…ŒìŠ¤íŠ¸ê¸°ì—… - í™•ì¥ ì†”ë£¨ì…˜ ê°±ì‹ ',
        AccountId = newAccount.Id,
        StageName = 'Prospecting',
        CloseDate = Date.today().addDays(30), // 30ì¼ í›„ ì˜ˆì •
        Amount = 40000000.00, // ëª…ì‹œì  Decimal
        Type = 'Renewal',
        Probability = 75,
        Description = 'ì§„í–‰ ì¤‘ì¸ ê°±ì‹  í”„ë¡œì„¸ìŠ¤',
        LeadSource = 'Existing Customer'
    );
    insert inProgressOpp;
    System.debug('âœ… ì§„í–‰ ì¤‘ì¸ Opportunity ìƒì„±: ' + inProgressOpp.Amount);
    
    // 3. ì¶”ê°€ ì•ˆì „ ë°ì´í„° ìƒì„± (ë‹¤ì–‘í•œ ì‹œë‚˜ë¦¬ì˜¤)
    System.debug('ğŸ›¡ï¸ ì¶”ê°€ ì•ˆì „ ë°ì´í„° ìƒì„±...');
    
    // ë‘ ë²ˆì§¸ Account (ê±´ê°•í•œ ê³ ê°, êµ­ê°€ í•„ë“œ ì œê±°)
    Account healthyAccount = new Account(
        Name = 'ìš°ìˆ˜ê¸°ì—…',
        Type = 'Customer',
        Industry = 'Finance',
        Phone = '02-9876-5432',
        BillingCity = 'ì„œìš¸'
        // BillingState ì œê±°
    );
    insert healthyAccount;
    
    // ë‘ ë²ˆì§¸ Asset (ì¤‘ê°„ ìš°ì„ ìˆœìœ„)
    Asset mediumAsset = new Asset(
        Name = 'í‘œì¤€ ì—…ë¬´ ì‹œìŠ¤í…œ',
        AccountId = healthyAccount.Id,
        Status = 'Installed',
        Price = 15000000.00,
        Quantity = 1,
        InstallDate = Date.today().addDays(-320),
        UsageEndDate = Date.today().addDays(45),
        Description = 'í‘œì¤€ ì—…ë¬´ ì²˜ë¦¬ ì‹œìŠ¤í…œ'
    );
    insert mediumAsset;
    
    // ì„¸ ë²ˆì§¸ Account (ìœ„í—˜ ê³ ê°)
    Account riskyAccount = new Account(
        Name = 'ì£¼ì˜ê¸°ì—…',
        Type = 'Customer',
        Industry = 'Manufacturing'
    );
    insert riskyAccount;
    
    // ìœ„í—˜ ê³ ê°ìš© Case ìƒì„±
    Case riskCase = new Case(
        AccountId = riskyAccount.Id,
        Subject = 'ì‹œìŠ¤í…œ ì˜¤ë¥˜ ë³´ê³ ',
        Status = 'New',
        Priority = 'High',
        Origin = 'Phone',
        Description = 'ê¸´ê¸‰ ê¸°ìˆ  ì§€ì› í•„ìš”'
    );
    insert riskCase;
    
    // 4. ìµœì¢… ë°ì´í„° ê²€ì¦
    System.debug('');
    System.debug('ğŸ“Š === ìµœì¢… ë°ì´í„° ê²€ì¦ ===');
    
    Integer accountCount = [SELECT COUNT() FROM Account WHERE Name LIKE '%ê¸°ì—…%'];
    Integer assetCount = [SELECT COUNT() FROM Asset WHERE Account.Name LIKE '%ê¸°ì—…%'];
    Integer oppCount = [SELECT COUNT() FROM Opportunity WHERE Account.Name LIKE '%ê¸°ì—…%'];
    Integer caseCount = [SELECT COUNT() FROM Case WHERE Account.Name LIKE '%ê¸°ì—…%'];
    
    System.debug('âœ… ì´ Account: ' + accountCount + 'ê°œ');
    System.debug('âœ… ì´ Asset: ' + assetCount + 'ê°œ');
    System.debug('âœ… ì´ Opportunity: ' + oppCount + 'ê°œ');
    System.debug('âœ… ì´ Case: ' + caseCount + 'ê°œ');
    
    // 5. ì˜ˆìƒ ëŒ€ì‹œë³´ë“œ ê²°ê³¼
    System.debug('');
    System.debug('ğŸ¯ === ì˜ˆìƒ ëŒ€ì‹œë³´ë“œ ê²°ê³¼ ===');
    System.debug('ğŸ’° ì˜¤ëŠ˜ ì˜ˆìƒ ë§¤ì¶œ: 4,050ë§Œì›');
    System.debug('  - í…ŒìŠ¤íŠ¸ê¸°ì—… ê¸´ê¸‰: 2,700ë§Œì› (3,000ë§Œì› Ã— 90%)');
    System.debug('  - ìš°ìˆ˜ê¸°ì—… í‘œì¤€: 1,350ë§Œì› (1,500ë§Œì› Ã— 90%)');
    System.debug('ğŸ¯ ì›”ê°„ ì™„ë£Œ: 1ê±´, 2,500ë§Œì›');
    System.debug('ğŸ¯ ì›”ê°„ ì§„í–‰: 1ê±´, 4,000ë§Œì›');
    System.debug('ğŸ¥ ê³ ê° ê±´ê°•ë„: ê±´ê°• 2ëª…, ìœ„í—˜ 1ëª…');
    System.debug('ğŸ† ì‹¤ë²„ ë ˆë²¨ ë‹¬ì„± ì˜ˆì •!');
    
} catch(Exception e) {
    System.debug('âŒ í•´ê²° ê³¼ì • ì¤‘ ì˜¤ë¥˜: ' + e.getMessage());
    System.debug('âŒ íƒ€ì…: ' + e.getTypeName());
    System.debug('âŒ ë¼ì¸: ' + e.getLineNumber());
}

System.debug('ğŸ”§ === ì˜¤ë¥˜ í•´ê²° ì™„ë£Œ ===');
System.debug('ğŸ’¡ ì´ì œ ëŒ€ì‹œë³´ë“œë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”!');
