// Scheduled Jobs ìƒíƒœ í™•ì¸ ìŠ¤í¬ë¦½íŠ¸

System.debug('=== ìŠ¤ì¼€ì¤„ëœ ì‘ì—… ìƒíƒœ í™•ì¸ ===');

// í˜„ì¬ í™œì„±í™”ëœ ìŠ¤ì¼€ì¤„ëœ ì‘ì—…ë“¤ ì¡°íšŒ
List<CronTrigger> scheduledJobs = [
    SELECT Id, CronJobDetail.Name, CronJobDetail.JobType, 
           State, NextFireTime, PreviousFireTime, CronExpression
    FROM CronTrigger 
    WHERE CronJobDetail.Name LIKE '%Payment%'
];

if (scheduledJobs.isEmpty()) {
    System.debug('âš ï¸ Payment ê´€ë ¨ ìŠ¤ì¼€ì¤„ëœ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.');
} else {
    for (CronTrigger job : scheduledJobs) {
        System.debug('ğŸ“‹ ìŠ¤ì¼€ì¤„ëœ ì‘ì—…:');
        System.debug('  - ì´ë¦„: ' + job.CronJobDetail.Name);
        System.debug('  - ìƒíƒœ: ' + job.State);
        System.debug('  - ë‹¤ìŒ ì‹¤í–‰: ' + job.NextFireTime);
        System.debug('  - ì´ì „ ì‹¤í–‰: ' + job.PreviousFireTime);
        System.debug('  - Cron í‘œí˜„ì‹: ' + job.CronExpression);
        System.debug('---');
    }
}

System.debug('=== ë°°ì¹˜ ì‘ì—… íˆìŠ¤í† ë¦¬ í™•ì¸ ===');

// ìµœê·¼ ë°°ì¹˜ ì‘ì—… ì‹¤í–‰ íˆìŠ¤í† ë¦¬ ì¡°íšŒ
List<AsyncApexJob> batchJobs = [
    SELECT Id, ApexClass.Name, Status, JobItemsProcessed, 
           TotalJobItems, NumberOfErrors, CreatedDate, CompletedDate
    FROM AsyncApexJob 
    WHERE ApexClass.Name = 'PaymentNotificationBatch'
    ORDER BY CreatedDate DESC
    LIMIT 10
];

if (batchJobs.isEmpty()) {
    System.debug('âš ï¸ PaymentNotificationBatch ì‹¤í–‰ íˆìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.');
} else {
    for (AsyncApexJob job : batchJobs) {
        System.debug('ğŸ”„ ë°°ì¹˜ ì‘ì—…:');
        System.debug('  - ID: ' + job.Id);
        System.debug('  - ìƒíƒœ: ' + job.Status);
        System.debug('  - ì²˜ë¦¬ëœ í•­ëª©: ' + job.JobItemsProcessed + '/' + job.TotalJobItems);
        System.debug('  - ì˜¤ë¥˜ ìˆ˜: ' + job.NumberOfErrors);
        System.debug('  - ìƒì„±ì¼: ' + job.CreatedDate);
        System.debug('  - ì™„ë£Œì¼: ' + job.CompletedDate);
        System.debug('---');
    }
}

System.debug('=== ìµœê·¼ ì•Œë¦¼ í˜„í™© ===');

// ìµœê·¼ ìƒì„±ëœ ì•Œë¦¼ë“¤ ì¡°íšŒ
List<Payment_Notification__c> recentNotifications = [
    SELECT Id, NotificationType__c, NotificationChannel__c, 
           NotificationStatus__c, ScheduledDateTime__c, SentDateTime__c,
           PaymentStatus__r.Order__r.OrderNumber, ErrorMessage__c
    FROM Payment_Notification__c 
    ORDER BY CreatedDate DESC
    LIMIT 20
];

if (recentNotifications.isEmpty()) {
    System.debug('âš ï¸ ìƒì„±ëœ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.');
} else {
    for (Payment_Notification__c notification : recentNotifications) {
        System.debug('ğŸ“§ ì•Œë¦¼:');
        System.debug('  - ID: ' + notification.Id);
        System.debug('  - ìœ í˜•: ' + notification.NotificationType__c);
        System.debug('  - ì±„ë„: ' + notification.NotificationChannel__c);
        System.debug('  - ìƒíƒœ: ' + notification.NotificationStatus__c);
        System.debug('  - ì˜ˆì •ì‹œê°„: ' + notification.ScheduledDateTime__c);
        System.debug('  - ë°œì†¡ì‹œê°„: ' + notification.SentDateTime__c);
        System.debug('  - ì£¼ë¬¸ë²ˆí˜¸: ' + notification.PaymentStatus__r.Order__r.OrderNumber);
        if (String.isNotBlank(notification.ErrorMessage__c)) {
            System.debug('  - ì˜¤ë¥˜: ' + notification.ErrorMessage__c);
        }
        System.debug('---');
    }
}

System.debug('=== ìƒíƒœ í™•ì¸ ì™„ë£Œ ===');
