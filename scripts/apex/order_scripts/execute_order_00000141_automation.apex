// Order 00000141 ìë™í™” ì‹œìŠ¤í…œ ì‹¤ì œ ì‹¤í–‰ (ë¹„ë™ê¸°)
System.debug('ğŸš€ =====Order 00000141 ì‹¤ì œ ìë™í™” ì‹œìŠ¤í…œ ì‹¤í–‰=====');

try {
    // 1. Order 00000141 ì¡°íšŒ
    List<Order> orders = [
        SELECT Id, OrderNumber, Account.Name, TotalAmount, Status
        FROM Order 
        WHERE OrderNumber = '00000141'
        AND Status = 'Activated'
        LIMIT 1
    ];
    
    if (orders.isEmpty()) {
        System.debug('âŒ Order 00000141 (Activated)ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        
        // Draft ìƒíƒœ Order í™•ì¸
        List<Order> draftOrders = [
            SELECT Id, OrderNumber, Status
            FROM Order 
            WHERE OrderNumber = '00000141'
            LIMIT 1
        ];
        
        if (!draftOrders.isEmpty()) {
            System.debug('ğŸ“‹ Order 00000141 ìƒíƒœ: ' + draftOrders[0].Status);
            System.debug('   Activated ìƒíƒœì˜ Orderë§Œ ìë™í™” ì‹œìŠ¤í…œì´ ë™ì‘í•©ë‹ˆë‹¤.');
        }
        return;
    }
    
    Order targetOrder = orders[0];
    System.debug('ğŸ“‹ Order: ' + targetOrder.OrderNumber + ' (' + targetOrder.Account.Name + ')');
    System.debug('   Status: ' + targetOrder.Status);
    System.debug('   Amount: â‚©' + targetOrder.TotalAmount.format());
    
    // 2. OrderItem ì¡´ì¬ í™•ì¸
    List<OrderItem> orderItems = [
        SELECT Id, Product2.Name, Quantity, TotalPrice
        FROM OrderItem 
        WHERE OrderId = :targetOrder.Id
    ];
    
    System.debug('   Order Products: ' + orderItems.size() + 'ê°œ');
    if (orderItems.isEmpty()) {
        System.debug('âŒ Orderì— Productê°€ ì—†ìŠµë‹ˆë‹¤. ìë™í™”ë¥¼ ì‹¤í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    
    for (OrderItem item : orderItems) {
        System.debug('   â€¢ ' + item.Product2.Name + ' (Qty: ' + item.Quantity + 
                     ', Total: â‚©' + item.TotalPrice.format() + ')');
    }
    
    // 3. í˜„ì¬ ìë™í™” ìƒíƒœ í™•ì¸
    System.debug('');
    System.debug('ğŸ“Š í˜„ì¬ ìë™í™” ìƒíƒœ í™•ì¸:');
    
    // PDF íŒŒì¼ í™•ì¸
    List<ContentDocumentLink> existingPDFs = [
        SELECT ContentDocument.Title, ContentDocument.CreatedDate
        FROM ContentDocumentLink 
        WHERE LinkedEntityId = :targetOrder.Id
        AND ContentDocument.FileExtension = 'pdf'
        AND ContentDocument.Title LIKE '%Product%ìƒì„¸ì„œ%'
        ORDER BY ContentDocument.CreatedDate DESC
    ];
    
    System.debug('   ê¸°ì¡´ Product ìƒì„¸ì„œ PDF: ' + existingPDFs.size() + 'ê°œ');
    
    // Slack ìƒíƒœ í™•ì¸
    Order orderWithSlack = [
        SELECT Slack_Channel_ID__c, Slack_Channel_Name__c, Slack_Notification_Status__c
        FROM Order 
        WHERE Id = :targetOrder.Id
    ];
    
    System.debug('   Slack ì±„ë„ ìƒíƒœ: ' + 
                 (String.isBlank(orderWithSlack.Slack_Notification_Status__c) ? 
                  'Not Created' : orderWithSlack.Slack_Notification_Status__c));
    
    // 4. ìë™í™” ì‹œìŠ¤í…œ ì‹¤í–‰
    System.debug('');
    System.debug('ğŸ¤– OrderProductAutomationService ì‹¤í–‰ ì¤‘...');
    
    Set<Id> orderIds = new Set<Id>{ targetOrder.Id };
    
    // @future ë©”ì„œë“œ í˜¸ì¶œ (ë¹„ë™ê¸° ì‹¤í–‰)
    OrderProductAutomationService.processOrderProductAutomation(orderIds);
    
    System.debug('âœ… ìë™í™” ì‹œìŠ¤í…œì´ ë¹„ë™ê¸°ë¡œ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.');
    System.debug('');
    System.debug('ğŸ“‹ ì²˜ë¦¬ë  ì‘ì—…:');
    System.debug('   1. Order Product ìƒì„¸ì„œ PDF ìë™ ìƒì„±');
    System.debug('   2. Slack ì±„ë„ ìë™ ìƒì„± (#' + targetOrder.OrderNumber + ')');
    System.debug('   3. Filesì— PDF ìë™ ì²¨ë¶€');
    System.debug('   4. Chatter ì™„ë£Œ ì•Œë¦¼ í¬ìŠ¤íŠ¸');
    System.debug('');
    System.debug('â° ì²˜ë¦¬ ì‹œê°„: ì•½ 30ì´ˆ~1ë¶„ ì†Œìš”');
    System.debug('ğŸ“ ê²°ê³¼ í™•ì¸: Order 00000141ì˜ Notes & Attachments ë° Chatter');
    
    System.debug('');
    System.debug('âœ… =====Order 00000141 ìë™í™” ì‹œìŠ¤í…œ ì‹¤í–‰ ì™„ë£Œ=====');
    
} catch (Exception e) {
    System.debug('âŒ ìë™í™” ì‹œìŠ¤í…œ ì‹¤í–‰ ì˜¤ë¥˜: ' + e.getMessage());
    System.debug('Stack Trace: ' + e.getStackTraceString());
}
