/**
 * Order Product ëˆ„ë½ ì¼ê´„ ë³´ì • ë°°ì¹˜ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
 * Developer Console > Debug > Open Execute Anonymous Windowì—ì„œ ì‹¤í–‰
 */

System.debug('ğŸ“¦ =====Order Product ëˆ„ë½ ì¼ê´„ ë³´ì • ë°°ì¹˜ ì‹¤í–‰=====');

try {
    // 1. í˜„ì¬ ìƒí™© íŒŒì•…
    List<Order> ordersWithoutProducts = [
        SELECT Id, OrderNumber, OpportunityId, TotalAmount, Status
        FROM Order 
        WHERE OpportunityId != null
        AND Id NOT IN (SELECT OrderId FROM OrderItem WHERE OrderId != null)
        AND TotalAmount <= 0
    ];
    
    System.debug('ğŸ“Š Order Productê°€ ëˆ„ë½ëœ Order ê°œìˆ˜: ' + ordersWithoutProducts.size());
    
    if (ordersWithoutProducts.isEmpty()) {
        System.debug('âœ… ë³´ì •ì´ í•„ìš”í•œ Orderê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    
    // ìƒì„¸ í˜„í™© ì¶œë ¥
    System.debug('ğŸ“‹ ë³´ì • ëŒ€ìƒ Order ëª©ë¡:');
    for (Order ord : ordersWithoutProducts) {
        System.debug('   - ' + ord.OrderNumber + ' (Amount: â‚©' + ord.TotalAmount + ', Status: ' + ord.Status + ')');
    }
    
    // 2. ë°°ì¹˜ ì‹¤í–‰
    System.debug('');
    System.debug('ğŸš€ ë°°ì¹˜ ì‹¤í–‰ ì‹œì‘...');
    
    OrderProductMissingCorrectionBatch batch = new OrderProductMissingCorrectionBatch();
    Id batchJobId = Database.executeBatch(batch, 10); // 10ê°œì”© ì²˜ë¦¬
    
    System.debug('âœ… ë°°ì¹˜ ì‹¤í–‰ ì™„ë£Œ');
    System.debug('   Batch Job ID: ' + batchJobId);
    System.debug('   ì²˜ë¦¬ ì˜ˆì • Order: ' + ordersWithoutProducts.size() + 'ê°œ');
    
    // 3. ë°°ì¹˜ ìƒíƒœ í™•ì¸ ë°©ë²• ì•ˆë‚´
    System.debug('');
    System.debug('ğŸ” ë°°ì¹˜ ì‹¤í–‰ ìƒíƒœ í™•ì¸ ë°©ë²•:');
    System.debug('1. Setup > Apex Jobsì—ì„œ ë°°ì¹˜ ì§„í–‰ ìƒí™© í™•ì¸');
    System.debug('2. ë˜ëŠ” ì•„ë˜ SOQLë¡œ ì§ì ‘ í™•ì¸:');
    System.debug('   SELECT Id, Status, JobItemsProcessed, TotalJobItems, NumberOfErrors');
    System.debug('   FROM AsyncApexJob WHERE Id = \'' + batchJobId + '\'');
    
    // 4. ê²°ê³¼ í™•ì¸ìš© ìŠ¤í¬ë¦½íŠ¸ ì œê³µ
    System.debug('');
    System.debug('ğŸ“ ë°°ì¹˜ ì™„ë£Œ í›„ ê²°ê³¼ í™•ì¸ ìŠ¤í¬ë¦½íŠ¸:');
    System.debug('// ë‚¨ì€ ëˆ„ë½ Order í™•ì¸');
    System.debug('List<Order> remaining = [SELECT Id, OrderNumber FROM Order WHERE OpportunityId != null AND Id NOT IN (SELECT OrderId FROM OrderItem) AND TotalAmount <= 0];');
    System.debug('System.debug(\"ë‚¨ì€ ì´ìŠˆ: \" + remaining.size() + \"ê°œ\");');
    
} catch (Exception e) {
    System.debug('âŒ ë°°ì¹˜ ì‹¤í–‰ ì˜¤ë¥˜: ' + e.getMessage());
    System.debug('Stack Trace: ' + e.getStackTraceString());
}

System.debug('ğŸ“¦ =====ë°°ì¹˜ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ ì™„ë£Œ=====');
