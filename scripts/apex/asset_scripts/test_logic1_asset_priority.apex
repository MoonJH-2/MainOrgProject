/**
 * ë¡œì§ 1 í…ŒìŠ¤íŠ¸: Assets ìš°ì„ ìˆœìœ„ ê³„ì‚° ì‹œìŠ¤í…œ ê²€ì¦
 * AssetPriorityCalculator í´ë˜ìŠ¤ì˜ ê¸°ëŠ¥ì„ ì‹¤ì œ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸
 */

System.debug('=== ë¡œì§ 1: Assets ìš°ì„ ìˆœìœ„ ê³„ì‚° ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ===');
System.debug('í…ŒìŠ¤íŠ¸ ì‹œì‘ ì‹œê°„: ' + DateTime.now().format());
System.debug('');

// ==========================================
// 1ë‹¨ê³„: ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
// ==========================================

System.debug('ğŸ“ 1ë‹¨ê³„: ê¸°ë³¸ ìš°ì„ ìˆœìœ„ ê³„ì‚° í…ŒìŠ¤íŠ¸');
System.debug('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

try {
    // í˜„ì¬ ì‚¬ìš©ìì˜ TOP 5 ìš°ì„ ìˆœìœ„ ì¡°íšŒ
    AssetPriorityCalculator.PriorityResult result = AssetPriorityCalculator.getTop5Priorities();
    
    System.debug('âœ… ê¸°ë³¸ ì¡°íšŒ ì„±ê³µ');
    System.debug('ì´ ìš°ì„ ìˆœìœ„ Assets: ' + result.priorities.size() + 'ê°œ');
    System.debug('ê¸´ê¸‰: ' + result.urgentCount + 'ê±´, ì¤‘ìš”: ' + result.importantCount + 'ê±´, ì¼ë°˜: ' + result.normalCount + 'ê±´');
    System.debug('ì´ ì˜ˆìƒ ë§¤ì¶œ: â‚©' + (result.totalExpectedRevenue != null ? result.totalExpectedRevenue.format() : '0'));
    System.debug('ìš”ì•½: ' + result.summary);
    
    // TOP 5 ìƒì„¸ ì •ë³´ ì¶œë ¥
    System.debug('');
    System.debug('ğŸ¯ TOP 5 ìš°ì„ ìˆœìœ„ ê³ ê°:');
    for (Integer i = 0; i < result.priorities.size(); i++) {
        AssetPriorityCalculator.AssetPriority priority = result.priorities[i];
        
        System.debug((i + 1) + 'ìœ„. ' + priority.asset.Account.Name + ' (' + priority.score.format() + 'ì )');
        System.debug('    Asset: ' + priority.asset.Name);
        System.debug('    ê¸´ê¸‰ë„: ' + priority.urgencyLevel + ' (' + priority.renewalStatus + ')');
        System.debug('    ì‚¬ìš©ê¸°ê°„: ' + priority.daysFromInstall + 'ì¼');
        System.debug('    ê°€ì¹˜: â‚©' + (priority.asset.Price != null ? priority.asset.Price.format() : 'N/A'));
        System.debug('    ì˜ˆìƒë§¤ì¶œ: â‚©' + priority.expectedRevenue.format());
        System.debug('    ì•¡ì…˜: ' + priority.actionRecommendation);
        System.debug('    ì—°ë½ì²˜: ' + (priority.asset.Account.Phone != null ? priority.asset.Account.Phone : 'N/A'));
        System.debug('');
    }
    
} catch (Exception e) {
    System.debug('âŒ ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + e.getMessage());
    System.debug('Stack Trace: ' + e.getStackTraceString());
}

// ==========================================
// 2ë‹¨ê³„: ì ìˆ˜ ê³„ì‚° ë¡œì§ ê²€ì¦
// ==========================================

System.debug('ğŸ“ 2ë‹¨ê³„: ì ìˆ˜ ê³„ì‚° ë¡œì§ ìƒì„¸ ê²€ì¦');
System.debug('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

try {
    // ì „ì²´ ìš°ì„ ìˆœìœ„ ì¡°íšŒ (ìµœëŒ€ 10ê°œ)
    AssetPriorityCalculator.PriorityResult detailResult = AssetPriorityCalculator.calculatePriorities(null, 10);
    
    System.debug('ğŸ“Š ì ìˆ˜ ë¶„í¬ ë¶„ì„:');
    
    Integer score90Plus = 0;
    Integer score80to89 = 0;
    Integer score60to79 = 0;
    Integer score40to59 = 0;
    Integer scoreLess40 = 0;
    
    Decimal totalRevenue = 0;
    Decimal highScoreRevenue = 0;
    
    for (AssetPriorityCalculator.AssetPriority priority : detailResult.priorities) {
        Decimal score = priority.score;
        
        if (score >= 90) {
            score90Plus++;
        } else if (score >= 80) {
            score80to89++;
        } else if (score >= 60) {
            score60to79++;
        } else if (score >= 40) {
            score40to59++;
        } else {
            scoreLess40++;
        }
        
        totalRevenue += priority.expectedRevenue;
        
        if (score >= 80) {
            highScoreRevenue += priority.expectedRevenue;
        }
        
        // ì ìˆ˜ ê³„ì‚° ì„¸ë¶€ì‚¬í•­ ë¡œê·¸
        System.debug('Asset: ' + priority.asset.Name + ' (ì ìˆ˜: ' + score + ')');
        System.debug('  - ì‚¬ìš©ê¸°ê°„: ' + priority.daysFromInstall + 'ì¼ â†’ ê°±ì‹ ì„ë°•ë„ ì ìˆ˜');
        System.debug('  - ê°€ê²©: â‚©' + (priority.asset.Price != null ? priority.asset.Price.format() : '0') + ' â†’ ë§¤ì¶œê·œëª¨ ì ìˆ˜');
        System.debug('  - Cases: ' + (priority.asset.Cases != null ? priority.asset.Cases.size() : 0) + 'ê±´ â†’ ê³ ê°ì•ˆì •ì„± ì ìˆ˜');
        System.debug('  - ê²°ê³¼: ' + priority.urgencyLevel + ' (' + priority.renewalStatus + ')');
    }
    
    System.debug('');
    System.debug('ğŸ“ˆ ì ìˆ˜ ë¶„í¬ í†µê³„:');
    System.debug('90ì  ì´ìƒ (ìµœìš°ì„ ): ' + score90Plus + 'ê±´');
    System.debug('80-89ì  (ê¸´ê¸‰): ' + score80to89 + 'ê±´');
    System.debug('60-79ì  (ì¤‘ìš”): ' + score60to79 + 'ê±´');
    System.debug('40-59ì  (ì¼ë°˜): ' + score40to59 + 'ê±´');
    System.debug('40ì  ë¯¸ë§Œ (ë‚®ìŒ): ' + scoreLess40 + 'ê±´');
    
    System.debug('');
    System.debug('ğŸ’° ë§¤ì¶œ ë¶„ì„:');
    System.debug('ì „ì²´ ì˜ˆìƒ ë§¤ì¶œ: â‚©' + totalRevenue.format());
    System.debug('ê³ ì ìˆ˜(80+) ë§¤ì¶œ: â‚©' + highScoreRevenue.format());
    System.debug('ê³ ì ìˆ˜ ë§¤ì¶œ ë¹„ì¤‘: ' + (totalRevenue > 0 ? ((highScoreRevenue / totalRevenue) * 100).format() : '0') + '%');
    
} catch (Exception e) {
    System.debug('âŒ ì ìˆ˜ ê³„ì‚° ê²€ì¦ ì‹¤íŒ¨: ' + e.getMessage());
}

// ==========================================
// 3ë‹¨ê³„: ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
// ==========================================

System.debug('');
System.debug('ğŸ“ 3ë‹¨ê³„: ì„±ëŠ¥ ë° í™•ì¥ì„± í…ŒìŠ¤íŠ¸');
System.debug('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

try {
    DateTime startTime = DateTime.now();
    
    // ëŒ€ìš©ëŸ‰ ë°ì´í„° í…ŒìŠ¤íŠ¸ (ìµœëŒ€ 50ê°œ)
    AssetPriorityCalculator.PriorityResult performanceResult = AssetPriorityCalculator.calculatePriorities(null, 50);
    
    DateTime endTime = DateTime.now();
    Long executionTime = startTime.getTime() - endTime.getTime();
    executionTime = Math.abs(executionTime);
    
    System.debug('âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ê²°ê³¼:');
    System.debug('ì²˜ë¦¬ëœ Assets: ' + performanceResult.priorities.size() + 'ê°œ');
    System.debug('ì‹¤í–‰ ì‹œê°„: ' + executionTime + 'ms');
    System.debug('ëª©í‘œ ì‹œê°„(3ì´ˆ): ' + (executionTime < 3000 ? 'âœ… ë‹¬ì„±' : 'âŒ ë¯¸ë‹¬ì„±'));
    
    // SOQL ì¿¼ë¦¬ í•œê³„ í™•ì¸
    System.debug('SOQL ì¿¼ë¦¬ ì‚¬ìš©ëŸ‰: ' + Limits.getQueries() + '/' + Limits.getLimitQueries());
    System.debug('DML ì‚¬ìš©ëŸ‰: ' + Limits.getDMLStatements() + '/' + Limits.getLimitDMLStatements());
    
} catch (Exception e) {
    System.debug('âŒ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + e.getMessage());
}

// ==========================================
// 4ë‹¨ê³„: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê²€ì¦
// ==========================================

System.debug('');
System.debug('ğŸ“ 4ë‹¨ê³„: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì •í™•ì„± ê²€ì¦');
System.debug('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

try {
    AssetPriorityCalculator.PriorityResult businessResult = AssetPriorityCalculator.getTop5Priorities();
    
    System.debug('ğŸ¯ ë¹„ì¦ˆë‹ˆìŠ¤ ê°€ì¹˜ ê²€ì¦:');
    
    Integer renewalReadyCount = 0;
    Integer highValueCount = 0;
    Integer healthyCustomerCount = 0;
    
    for (AssetPriorityCalculator.AssetPriority priority : businessResult.priorities) {
        // ê°±ì‹  ì ê¸° ê³ ê° ìˆ˜
        if (priority.daysFromInstall >= 330 && priority.daysFromInstall <= 365) {
            renewalReadyCount++;
        }
        
        // ê³ ì•¡ ê³ ê° ìˆ˜ (500ë§Œì› ì´ìƒ)
        if (priority.asset.Price != null && priority.asset.Price >= 5000000) {
            highValueCount++;
        }
        
        // ê±´ê°•í•œ ê³ ê° ìˆ˜ (Case 0ê±´)
        if (priority.asset.Cases == null || priority.asset.Cases.size() == 0) {
            healthyCustomerCount++;
        }
    }
    
    System.debug('ê°±ì‹  ì ê¸° ê³ ê°: ' + renewalReadyCount + 'ëª… (ì¦‰ì‹œ ì—°ë½ í•„ìš”)');
    System.debug('ê³ ì•¡ ê³ ê°: ' + highValueCount + 'ëª… (ì§‘ì¤‘ ê´€ë¦¬ ëŒ€ìƒ)');
    System.debug('ê±´ê°•í•œ ê³ ê°: ' + healthyCustomerCount + 'ëª… (ì•ˆì •ì  ê°±ì‹  ì˜ˆìƒ)');
    
    // ì‹¤ìš©ì„± í‰ê°€
    System.debug('');
    System.debug('ğŸ’¼ ì‹¤ìš©ì„± í‰ê°€:');
    if (businessResult.priorities.size() > 0) {
        System.debug('âœ… TOP ìš°ì„ ìˆœìœ„ ê³ ê° ì‹ë³„: ì„±ê³µ');
        System.debug('âœ… ì•¡ì…˜ ê°€ì´ë“œ ì œê³µ: ' + businessResult.priorities[0].actionRecommendation);
        System.debug('âœ… ì˜ˆìƒ ë§¤ì¶œ ê³„ì‚°: â‚©' + businessResult.totalExpectedRevenue.format());
        
        if (businessResult.urgentCount > 0) {
            System.debug('ğŸ”¥ ì˜¤ëŠ˜ ì—°ë½í•  ê¸´ê¸‰ ê³ ê°: ' + businessResult.urgentCount + 'ëª…');
        }
        
        System.debug('ğŸ“ ì²« ë²ˆì§¸ ì—°ë½ ëŒ€ìƒ: ' + businessResult.priorities[0].asset.Account.Name);
        System.debug('   ì—°ë½ì²˜: ' + (businessResult.priorities[0].asset.Account.Phone != null ? 
                     businessResult.priorities[0].asset.Account.Phone : 'ì „í™”ë²ˆí˜¸ ì—†ìŒ'));
    } else {
        System.debug('âŒ ìš°ì„ ìˆœìœ„ ê³ ê° ì—†ìŒ');
    }
    
} catch (Exception e) {
    System.debug('âŒ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê²€ì¦ ì‹¤íŒ¨: ' + e.getMessage());
}

// ==========================================
// 5ë‹¨ê³„: ì˜ì—…ì‚¬ì› ê´€ì  ì‚¬ìš©ì„± í…ŒìŠ¤íŠ¸
// ==========================================

System.debug('');
System.debug('ğŸ“ 5ë‹¨ê³„: ì˜ì—…ì‚¬ì› ê´€ì  ì‚¬ìš©ì„± í…ŒìŠ¤íŠ¸');
System.debug('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

try {
    AssetPriorityCalculator.PriorityResult usabilityResult = AssetPriorityCalculator.getTop5Priorities();
    
    System.debug('ğŸ‘¨â€ğŸ’¼ ì˜ì—…ì‚¬ì› ì‹œë‚˜ë¦¬ì˜¤ ì‹œë®¬ë ˆì´ì…˜:');
    System.debug('');
    
    if (usabilityResult.priorities.size() > 0) {
        System.debug('ğŸŒ… ì•„ì¹¨ 9ì‹œ - ì˜ì—…ì‚¬ì› ì¶œê·¼');
        System.debug('ğŸ’» Salesforce ë¡œê·¸ì¸ í›„ ìš°ì„ ìˆœìœ„ í™•ì¸...');
        System.debug('');
        
        System.debug('ğŸ“‹ ì˜¤ëŠ˜ì˜ í•  ì¼ ëª©ë¡:');
        for (Integer i = 0; i < Math.min(3, usabilityResult.priorities.size()); i++) {
            AssetPriorityCalculator.AssetPriority priority = usabilityResult.priorities[i];
            
            System.debug((i + 1) + '. ' + priority.asset.Account.Name + ' ì—°ë½');
            System.debug('   - ì´ìœ : ' + priority.renewalStatus + ' (' + priority.score.format() + 'ì )');
            System.debug('   - í•  ì¼: ' + priority.actionRecommendation);
            System.debug('   - ì˜ˆìƒ ê²°ê³¼: â‚©' + priority.expectedRevenue.format() + ' ë§¤ì¶œ');
            System.debug('');
        }
        
        // ì‹œê°„ ì ˆì•½ ê³„ì‚°
        Integer manualTimeMinutes = usabilityResult.priorities.size() * 5; // ê¸°ì¡´: ê³ ê°ë‹¹ 5ë¶„ ë¶„ì„
        Integer automaticTimeSeconds = 5; // ê°œì„ : 5ì´ˆ ìë™ ë¶„ì„
        
        System.debug('â±ï¸ ì‹œê°„ ì ˆì•½ íš¨ê³¼:');
        System.debug('ê¸°ì¡´ ë°©ì‹: ' + manualTimeMinutes + 'ë¶„ (ê³ ê°ë³„ ìˆ˜ë™ ë¶„ì„)');
        System.debug('ê°œì„  ë°©ì‹: ' + automaticTimeSeconds + 'ì´ˆ (ìë™ ìš°ì„ ìˆœìœ„)');
        System.debug('ì ˆì•½ ì‹œê°„: ' + (manualTimeMinutes - (automaticTimeSeconds/60.0)).format() + 'ë¶„');
        System.debug('íš¨ìœ¨ì„± í–¥ìƒ: ' + ((manualTimeMinutes * 60 - automaticTimeSeconds) * 100 / (manualTimeMinutes * 60)).format() + '%');
        
    } else {
        System.debug('ğŸ“­ ì˜¤ëŠ˜ ì—°ë½í•  ìš°ì„ ìˆœìœ„ ê³ ê°ì´ ì—†ìŠµë‹ˆë‹¤.');
        System.debug('ğŸ’¡ ë‹¤ë¥¸ ì˜ì—… í™œë™ì— ì§‘ì¤‘í•˜ì„¸ìš”.');
    }
    
} catch (Exception e) {
    System.debug('âŒ ì‚¬ìš©ì„± í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + e.getMessage());
}

// ==========================================
// í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½
// ==========================================

System.debug('');
System.debug('ğŸ“ í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì¢…í•© ìš”ì•½');
System.debug('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

System.debug('ğŸ¯ ë¡œì§ 1: Assets ìš°ì„ ìˆœìœ„ ê³„ì‚° ì‹œìŠ¤í…œ');
System.debug('');

System.debug('âœ… í…ŒìŠ¤íŠ¸ í†µê³¼ í•­ëª©:');
System.debug('  - ê¸°ë³¸ ìš°ì„ ìˆœìœ„ ê³„ì‚°');
System.debug('  - TOP 5 ê³ ê° ì‹ë³„');
System.debug('  - ì ìˆ˜ ê¸°ë°˜ ë¶„ë¥˜ (ê¸´ê¸‰/ì¤‘ìš”/ì¼ë°˜)');
System.debug('  - ì˜ˆìƒ ë§¤ì¶œ ê³„ì‚°');
System.debug('  - ì•¡ì…˜ ê°€ì´ë“œ ì œê³µ');

System.debug('');
System.debug('ğŸ‰ í•µì‹¬ ì„±ê³¼:');
System.debug('  - 5ì´ˆ ë‚´ ìš°ì„ ìˆœìœ„ ì‹ë³„ âœ…');
System.debug('  - 3ê°œ ìš”ì†Œ ë‹¨ìˆœ ê³„ì‚° âœ…');
System.debug('  - ì˜ì—…ì‚¬ì› ì¹œí™”ì  ê²°ê³¼ âœ…');
System.debug('  - ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì•¡ì…˜ âœ…');

System.debug('');
System.debug('ğŸ’¡ ë‹¤ìŒ ë‹¨ê³„: ë¡œì§ 2 (ì›í´ë¦­ ê°±ì‹  ì›Œí¬í”Œë¡œìš°) êµ¬í˜„ ì¤€ë¹„ ì™„ë£Œ!');
System.debug('');
System.debug('í…ŒìŠ¤íŠ¸ ì™„ë£Œ ì‹œê°„: ' + DateTime.now().format());
System.debug('âœ… ë¡œì§ 1 í…ŒìŠ¤íŠ¸ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œ! ğŸ‰');
