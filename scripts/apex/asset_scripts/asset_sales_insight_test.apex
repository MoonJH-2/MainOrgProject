/**
 * Asset ê¸°ë°˜ ì˜ì—… ì¸ì‚¬ì´íŠ¸ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
 * 
 * ì‚¬ìš©ë²•:
 * 1. Developer Console â†’ Debug â†’ Open Execute Anonymous Window
 * 2. ì•„ë˜ ì½”ë“œë¥¼ ë³µì‚¬í•˜ì—¬ ì‹¤í–‰
 * 3. Debug Logì—ì„œ ê²°ê³¼ í™•ì¸
 */

// ğŸ¯ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: (ì£¼)ê·¸ë¦°íŒŒì›Œí… Order 00000162 ë¶„ì„

System.debug('=== Asset ê¸°ë°˜ ì˜ì—… ì¸ì‚¬ì´íŠ¸ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');

// 1. í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¡°íšŒ (ë˜ëŠ” ìƒì„±)
Account testAccount;
List<Account> existingAccounts = [SELECT Id, Name FROM Account WHERE Name = '(ì£¼)ê·¸ë¦°íŒŒì›Œí…' LIMIT 1];

if (existingAccounts.isEmpty()) {
    // í…ŒìŠ¤íŠ¸ ê³„ì • ìƒì„±
    testAccount = new Account(
        Name = '(ì£¼)ê·¸ë¦°íŒŒì›Œí…',
        Industry = 'ì œì¡°ì—…',
        BillingCountry = 'ëŒ€í•œë¯¼êµ­',
        BillingState = 'ê²½ê¸°ë„',
        BillingCity = 'ì•ˆì–‘ì‹œ',
        Phone = '031-123-4567',
        Website = 'www.greenpower.co.kr'
    );
    insert testAccount;
    System.debug('âœ… í…ŒìŠ¤íŠ¸ ê³„ì • ìƒì„±: ' + testAccount.Id);
} else {
    testAccount = existingAccounts[0];
    System.debug('âœ… ê¸°ì¡´ ê³„ì • ì‚¬ìš©: ' + testAccount.Id);
}

// 2. í…ŒìŠ¤íŠ¸ Asset ì¡°íšŒ (ë˜ëŠ” ìƒì„±)
Asset testAsset;
List<Asset> existingAssets = [SELECT Id, Name, AccountId, Price, Status FROM Asset 
                             WHERE Name = 'Order 00000162' AND AccountId = :testAccount.Id LIMIT 1];

if (existingAssets.isEmpty()) {
    // í…ŒìŠ¤íŠ¸ Asset ìƒì„±
    testAsset = new Asset(
        Name = 'Order 00000162',
        AccountId = testAccount.Id,
        Price = 990000,
        PurchaseDate = Date.today().addDays(-180),  // 6ê°œì›” ì „ êµ¬ë§¤
        InstallDate = Date.today().addDays(-150),   // 5ê°œì›” ì „ ì„¤ì¹˜
        UsageEndDate = Date.today().addDays(185),   // 6ê°œì›” í›„ ë§Œë£Œ
        Status = 'Installed',
        Quantity = 1,
        Product2Id = null  // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” Product ID ë§¤í•‘ í•„ìš”
    );
    insert testAsset;
    System.debug('âœ… í…ŒìŠ¤íŠ¸ Asset ìƒì„±: ' + testAsset.Id);
} else {
    testAsset = existingAssets[0];
    System.debug('âœ… ê¸°ì¡´ Asset ì‚¬ìš©: ' + testAsset.Id);
}

System.debug('');
System.debug('ğŸ“Š í…ŒìŠ¤íŠ¸ ë°ì´í„° ìš”ì•½:');
System.debug('- ê³„ì •: ' + testAccount.Name + ' (' + testAccount.Id + ')');
System.debug('- Asset: ' + testAsset.Name + ' (' + testAsset.Id + ')');
System.debug('- ê°€ê²©: â‚©' + String.valueOf(testAsset.Price));
System.debug('- ìƒíƒœ: ' + testAsset.Status);

try {
    // 3. ê°±ì‹  ê¸°íšŒ ë¶„ì„ í…ŒìŠ¤íŠ¸
    System.debug('');
    System.debug('ğŸ”„ ê°±ì‹  ê¸°íšŒ ë¶„ì„ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
    
    AssetRenewalOpportunityEngine renewalEngine = new AssetRenewalOpportunityEngine();
    List<AssetRenewalOpportunityEngine.RenewalOpportunity> renewalResults = 
        renewalEngine.analyzeRenewalOpportunities(testAsset.Id);
    
    System.debug('ê°±ì‹  ê¸°íšŒ ë°œê²¬: ' + renewalResults.size() + 'ê±´');
    for (AssetRenewalOpportunityEngine.RenewalOpportunity renewal : renewalResults) {
        System.debug('- Asset: ' + renewal.assetName);
        System.debug('  ìš°ì„ ìˆœìœ„: ' + renewal.priorityScore + 'ì ');
        System.debug('  ê°±ì‹ ì¼: ' + renewal.renewalDate);
        System.debug('  ì˜ˆìƒê°€ì¹˜: â‚©' + String.valueOf(renewal.estimatedRenewalValue));
        System.debug('  ì „ëµ: ' + renewal.renewalStrategy);
        System.debug('  ---');
    }
    
} catch (Exception e) {
    System.debug('âŒ ê°±ì‹  ê¸°íšŒ ë¶„ì„ ì˜¤ë¥˜: ' + e.getMessage());
}

try {
    // 4. ì˜ì—… ê¸°íšŒ ë¶„ì„ í…ŒìŠ¤íŠ¸
    System.debug('');
    System.debug('ğŸ’¼ ì˜ì—… ê¸°íšŒ ë¶„ì„ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
    
    AssetBasedSalesOpportunityEngine salesEngine = new AssetBasedSalesOpportunityEngine();
    List<AssetBasedSalesOpportunityEngine.SalesOpportunity> salesResults = 
        salesEngine.analyzeSalesOpportunities(testAccount.Id);
    
    System.debug('ì˜ì—… ê¸°íšŒ ë°œê²¬: ' + salesResults.size() + 'ê±´');
    for (AssetBasedSalesOpportunityEngine.SalesOpportunity sales : salesResults) {
        System.debug('- ìœ í˜•: ' + sales.opportunityType);
        System.debug('  ì¶”ì²œì œí’ˆ: ' + sales.recommendedProduct);
        System.debug('  í˜„ì¬ì œí’ˆ: ' + sales.currentAsset);
        System.debug('  ì˜ˆìƒê°€ì¹˜: â‚©' + String.valueOf(sales.estimatedValue));
        System.debug('  ì‹ ë¢°ë„: ' + sales.confidenceLevel + '%');
        System.debug('  ê¸°ê°„: ' + sales.timeframe);
        System.debug('  ê·¼ê±°: ' + sales.reasoning);
        System.debug('  ì•¡ì…˜: ' + sales.actionPlan);
        System.debug('  ---');
    }
    
} catch (Exception e) {
    System.debug('âŒ ì˜ì—… ê¸°íšŒ ë¶„ì„ ì˜¤ë¥˜: ' + e.getMessage());
}

try {
    // 5. ê³ ê° ë¦¬ìŠ¤í¬ ë¶„ì„ í…ŒìŠ¤íŠ¸
    System.debug('');
    System.debug('âš ï¸ ê³ ê° ë¦¬ìŠ¤í¬ ë¶„ì„ í…ŒìŠ¤íŠ¸ ì‹œì‘...');
    
    AssetCustomerRiskAnalyzer riskAnalyzer = new AssetCustomerRiskAnalyzer();
    AssetCustomerRiskAnalyzer.CustomerRisk riskResult = 
        riskAnalyzer.analyzeCustomerRisk(testAccount.Id);
    
    System.debug('ë¦¬ìŠ¤í¬ ë¶„ì„ ê²°ê³¼:');
    System.debug('- ì „ì²´ ë¦¬ìŠ¤í¬: ' + riskResult.overallRiskScore + '% (' + riskResult.riskLevel + ')');
    System.debug('- ë‚©ë¶€ ë¦¬ìŠ¤í¬: ' + riskResult.paymentRiskScore + '%');
    System.debug('- ì‚¬ìš© íŒ¨í„´: ' + riskResult.usageRiskScore + '%');
    System.debug('- ì»¤ë®¤ë‹ˆì¼€ì´ì…˜: ' + riskResult.communicationRiskScore + '%');
    System.debug('- ê²½ìŸì‚¬ ìœ„í—˜: ' + riskResult.competitorRiskScore + '%');
    System.debug('- ë§Œì¡±ë„ ì˜ˆì¸¡: ' + riskResult.satisfactionPrediction + '% (' + riskResult.satisfactionLevel + ')');
    System.debug('- ì™„í™” ì•¡ì…˜: ' + riskResult.riskMitigationActions);
    
} catch (Exception e) {
    System.debug('âŒ ë¦¬ìŠ¤í¬ ë¶„ì„ ì˜¤ë¥˜: ' + e.getMessage());
}

// 6. ì¢…í•© ë¶„ì„ ê²°ê³¼
System.debug('');
System.debug('ğŸ“ˆ ì¢…í•© ë¶„ì„ ê²°ê³¼:');
System.debug('');
System.debug('ğŸ¯ ì˜ì—… ì‚¬ì›ì„ ìœ„í•œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì¸ì‚¬ì´íŠ¸:');
System.debug('');
System.debug('1. ê°±ì‹  ê¸°íšŒ:');
System.debug('   - (ì£¼)ê·¸ë¦°íŒŒì›Œí…ì˜ Order 00000162ëŠ” ì•½ 6ê°œì›” í›„ ê°±ì‹  ì˜ˆì •');
System.debug('   - í˜„ì¬ â‚©990,000 ê³„ì•½ìœ¼ë¡œ, ì•ˆì •ì ì¸ ë‚©ë¶€ ì´ë ¥ ë³´ìœ ');
System.debug('   - ì¡°ê¸° ê°±ì‹  í˜‘ìƒìœ¼ë¡œ í• ì¸ í˜œíƒ ì œê³µ ê°€ëŠ¥');
System.debug('');
System.debug('2. ì¶”ê°€ ì˜ì—… ê¸°íšŒ:');
System.debug('   - ì œì¡°ì—… íŠ¹ì„±ìƒ ìƒì‚°ëŸ‰ ì¦ê°€ì— ë”°ë¥¸ ì—…ê·¸ë ˆì´ë“œ í•„ìš”ì„±');
System.debug('   - ê´€ë ¨ ë¶€ê°€ ì„œë¹„ìŠ¤ë‚˜ ì œí’ˆ í¬ë¡œìŠ¤ì…€ ê¸°íšŒ');
System.debug('   - ì¥ê¸° ê³„ì•½ì„ í†µí•œ ë‹¨ê°€ í• ì¸ ë° ì•ˆì •ì  ìˆ˜ìµ í™•ë³´');
System.debug('');
System.debug('3. ê³ ê° ê´€ê³„ ê´€ë¦¬:');
System.debug('   - ë‚©ë¶€ ì´ë ¥ì´ ì–‘í˜¸í•˜ì—¬ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ê³ ê°');
System.debug('   - ì •ê¸°ì ì¸ ë§Œì¡±ë„ ì¡°ì‚¬ ë° ì‚¬ìš© í˜„í™© ì ê²€ í•„ìš”');
System.debug('   - ê²½ìŸì‚¬ ì ‘ì´‰ ë°©ì§€ë¥¼ ìœ„í•œ ê´€ê³„ ê°•í™” í™œë™ ê¶Œì¥');
System.debug('');
System.debug('ğŸ“ ê¶Œì¥ ì•¡ì…˜:');
System.debug('1. ê°±ì‹  3ê°œì›” ì „ (3ê°œì›” í›„) ê³ ê° ì ‘ì´‰ ì‹œì‘');
System.debug('2. í˜„ì¬ ì‚¬ìš© í˜„í™© ë° ë§Œì¡±ë„ í™•ì¸');
System.debug('3. ì—…ê·¸ë ˆì´ë“œë‚˜ ì¶”ê°€ ì œí’ˆ ë‹ˆì¦ˆ íŒŒì•…');
System.debug('4. ê²½ìŸë ¥ ìˆëŠ” ê°±ì‹  ì¡°ê±´ ì œì•ˆ');
System.debug('5. ì¥ê¸° íŒŒíŠ¸ë„ˆì‹­ ê´€ê³„ êµ¬ì¶•ì„ ìœ„í•œ ì „ëµ ìˆ˜ë¦½');

System.debug('');
System.debug('=== Asset ê¸°ë°˜ ì˜ì—… ì¸ì‚¬ì´íŠ¸ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===');
System.debug('');
System.debug('ğŸš€ ë‹¤ìŒ ë‹¨ê³„:');
System.debug('1. Lightning Experienceì—ì„œ Asset ë ˆì½”ë“œ í˜ì´ì§€ë¡œ ì´ë™');
System.debug('2. Asset Sales Insight Dashboard ì»´í¬ë„ŒíŠ¸ í™•ì¸');
System.debug('3. ê° íƒ­(ê°±ì‹ /ì˜ì—…/ë¦¬ìŠ¤í¬)ì˜ ë¶„ì„ ê²°ê³¼ ê²€í† ');
System.debug('4. "Opportunity ìƒì„±" ë° "Task ìƒì„±" ë²„íŠ¼ìœ¼ë¡œ í›„ì† ì¡°ì¹˜');
