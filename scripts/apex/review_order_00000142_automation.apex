// Order 00000142 ìë™í™” ì‹œìŠ¤í…œ ì‘ë™ ìƒíƒœ ê²€í† 
System.debug('ğŸ” =====Order 00000142 ìë™í™” ì‹œìŠ¤í…œ ê²€í† =====');

try {
    // 1. Order 00000142 ìƒì„¸ ì •ë³´ ì¡°íšŒ
    List<Order> orders = [
        SELECT Id, OrderNumber, Account.Name, TotalAmount, Status, EffectiveDate,
               Payment_Method__c, CreatedDate, LastModifiedDate,
               Slack_Channel_ID__c, Slack_Channel_Name__c, Slack_Notification_Status__c,
               (SELECT Id, Product2.Name, Product2.ProductCode, Quantity, 
                       UnitPrice, TotalPrice FROM OrderItems)
        FROM Order 
        WHERE OrderNumber = '00000142'
        LIMIT 1
    ];
    
    if (orders.isEmpty()) {
        System.debug('âŒ Order 00000142ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    
    Order targetOrder = orders[0];
    System.debug('ğŸ“‹ Order ê¸°ë³¸ ì •ë³´:');
    System.debug('   Order Number: ' + targetOrder.OrderNumber);
    System.debug('   Customer: ' + targetOrder.Account.Name);
    System.debug('   Status: ' + targetOrder.Status);
    System.debug('   Amount: â‚©' + targetOrder.TotalAmount.format());
    System.debug('   Payment Method: ' + targetOrder.Payment_Method__c);
    System.debug('   Created: ' + targetOrder.CreatedDate.format());
    System.debug('   Last Modified: ' + targetOrder.LastModifiedDate.format());
    
    // 2. Order Products ìƒíƒœ í™•ì¸
    System.debug('');
    System.debug('ğŸ›’ Order Products ìƒíƒœ:');
    System.debug('   ì´ Products: ' + targetOrder.OrderItems.size() + 'ê°œ');
    
    for (OrderItem item : targetOrder.OrderItems) {
        System.debug('   â€¢ ' + item.Product2.Name + ' (' + item.Product2.ProductCode + ')');
        System.debug('     Quantity: ' + item.Quantity + ', Unit Price: â‚©' + item.UnitPrice.format());
        System.debug('     Total: â‚©' + item.TotalPrice.format());
    }
    
    // 3. PaymentStatus ìƒì„± ìƒíƒœ í™•ì¸
    System.debug('');
    System.debug('ğŸ’° PaymentStatus ìë™ ìƒì„± ìƒíƒœ:');
    List<PaymentStatus__c> paymentStatuses = [
        SELECT Id, InstallmentNumber__c, Amount__c, DueDate__c, Status__c
        FROM PaymentStatus__c 
        WHERE Order__c = :targetOrder.Id
        ORDER BY InstallmentNumber__c ASC
    ];
    
    System.debug('   ì´ PaymentStatus: ' + paymentStatuses.size() + 'ê°œ');
    
    Boolean paymentScheduleCorrect = true;
    for (PaymentStatus__c payment : paymentStatuses) {
        System.debug('   â€¢ ' + payment.InstallmentNumber__c + 'ì°¨: â‚©' + payment.Amount__c.format() + 
                     ' (ì˜ˆì •ì¼: ' + payment.DueDate__c.format() + ', ìƒíƒœ: ' + payment.Status__c + ')');
        
        // ë¶„ê¸°ë³„ ë‚©ë¶€ì´ë¯€ë¡œ 4ê°œì˜ PaymentStatusê°€ ìˆì–´ì•¼ í•¨
        if (payment.Amount__c != 3180000) {
            paymentScheduleCorrect = false;
        }
    }
    
    if (paymentStatuses.size() == 4 && paymentScheduleCorrect) {
        System.debug('   âœ… PaymentStatus ìë™ ìƒì„±: ì •ìƒ');
    } else {
        System.debug('   âŒ PaymentStatus ìë™ ìƒì„±: ë¬¸ì œ ìˆìŒ');
    }
    
    // 4. PDF ìë™ ìƒì„± ìƒíƒœ í™•ì¸
    System.debug('');
    System.debug('ğŸ“„ PDF ìë™ ìƒì„± ìƒíƒœ:');
    List<ContentDocumentLink> pdfFiles = [
        SELECT ContentDocument.Id, ContentDocument.Title, ContentDocument.FileExtension,
               ContentDocument.CreatedDate, ContentDocument.ContentSize
        FROM ContentDocumentLink 
        WHERE LinkedEntityId = :targetOrder.Id
        AND ContentDocument.FileExtension = 'pdf'
        ORDER BY ContentDocument.CreatedDate DESC
    ];
    
    System.debug('   ì´ PDF íŒŒì¼: ' + pdfFiles.size() + 'ê°œ');
    
    Boolean productPDFExists = false;
    Boolean paymentPDFExists = false;
    
    for (ContentDocumentLink pdf : pdfFiles) {
        String fileType = '';
        if (pdf.ContentDocument.Title.contains('Product') || pdf.ContentDocument.Title.contains('ìƒì„¸ì„œ')) {
            fileType = ' [Product ìƒì„¸ì„œ]';
            productPDFExists = true;
        } else if (pdf.ContentDocument.Title.contains('ë‚©ë¶€ì¼ì •ì„œ') || pdf.ContentDocument.Title.contains('payment')) {
            fileType = ' [ë‚©ë¶€ì¼ì •ì„œ]';
            paymentPDFExists = true;
        }
        
        System.debug('   â€¢ ' + pdf.ContentDocument.Title + '.pdf' + fileType);
        System.debug('     ìƒì„±ì¼: ' + pdf.ContentDocument.CreatedDate.format() + 
                     ', í¬ê¸°: ' + (pdf.ContentDocument.ContentSize / 1024) + 'KB');
    }
    
    // PDF ìë™ ìƒì„± ìƒíƒœ í‰ê°€
    if (productPDFExists) {
        System.debug('   âœ… Order Product ìƒì„¸ì„œ PDF: ìë™ ìƒì„±ë¨');
    } else {
        System.debug('   âŒ Order Product ìƒì„¸ì„œ PDF: ìƒì„±ë˜ì§€ ì•ŠìŒ');
    }
    
    if (paymentPDFExists) {
        System.debug('   âœ… ë‚©ë¶€ì¼ì •ì„œ PDF: ìë™ ìƒì„±ë¨');
    } else {
        System.debug('   âš ï¸ ë‚©ë¶€ì¼ì •ì„œ PDF: ìƒì„±ë˜ì§€ ì•ŠìŒ (PaymentStatus ìƒì„± í›„ ìë™ ìƒì„±)');
    }
    
    // 5. Slack ì±„ë„ ìë™ ìƒì„± ìƒíƒœ í™•ì¸
    System.debug('');
    System.debug('ğŸ’¬ Slack ì±„ë„ ìë™ ìƒì„± ìƒíƒœ:');
    System.debug('   Channel ID: ' + (String.isBlank(targetOrder.Slack_Channel_ID__c) ? 'ì—†ìŒ' : targetOrder.Slack_Channel_ID__c));
    System.debug('   Channel Name: ' + (String.isBlank(targetOrder.Slack_Channel_Name__c) ? 'ì—†ìŒ' : targetOrder.Slack_Channel_Name__c));
    System.debug('   Notification Status: ' + (String.isBlank(targetOrder.Slack_Notification_Status__c) ? 'Not Created' : targetOrder.Slack_Notification_Status__c));
    
    if (String.isNotBlank(targetOrder.Slack_Channel_Name__c) && targetOrder.Slack_Notification_Status__c == 'Created') {
        System.debug('   âœ… Slack ì±„ë„: ìë™ ìƒì„±ë¨');
    } else if (targetOrder.Slack_Notification_Status__c == 'Not Created') {
        System.debug('   âŒ Slack ì±„ë„: ìƒì„±ë˜ì§€ ì•ŠìŒ');
    } else {
        System.debug('   âš ï¸ Slack ì±„ë„: ì²˜ë¦¬ ì¤‘...');
    }
    
    // 6. Chatter ì•Œë¦¼ ìƒíƒœ í™•ì¸
    System.debug('');
    System.debug('ğŸ’¬ Chatter ì•Œë¦¼ ìƒíƒœ:');
    List<FeedItem> chatterPosts = [
        SELECT Id, Body, CreatedDate, CreatedBy.Name
        FROM FeedItem 
        WHERE ParentId = :targetOrder.Id
        AND Body LIKE '%ìë™í™”%'
        ORDER BY CreatedDate DESC
        LIMIT 5
    ];
    
    System.debug('   ìë™í™” ê´€ë ¨ Chatter í¬ìŠ¤íŠ¸: ' + chatterPosts.size() + 'ê°œ');
    
    for (FeedItem post : chatterPosts) {
        String bodyPreview = post.Body.length() > 50 ? post.Body.substring(0, 50) + '...' : post.Body;
        System.debug('   â€¢ ' + post.CreatedDate.format() + ' by ' + post.CreatedBy.Name + ': ' + bodyPreview);
    }
    
    if (chatterPosts.size() > 0) {
        System.debug('   âœ… Chatter ì•Œë¦¼: ìƒì„±ë¨');
    } else {
        System.debug('   âŒ Chatter ì•Œë¦¼: ìƒì„±ë˜ì§€ ì•ŠìŒ');
    }
    
    // 7. ìë™í™” ì‹œìŠ¤í…œ ì „ì²´ ìƒíƒœ í‰ê°€
    System.debug('');
    System.debug('ğŸ“Š ìë™í™” ì‹œìŠ¤í…œ ì „ì²´ ìƒíƒœ í‰ê°€:');
    
    int successCount = 0;
    int totalChecks = 5;
    
    // 1. Order Products ì¡´ì¬
    if (!targetOrder.OrderItems.isEmpty()) {
        System.debug('   âœ… Order Products: ì •ìƒ (' + targetOrder.OrderItems.size() + 'ê°œ)');
        successCount++;
    } else {
        System.debug('   âŒ Order Products: ì—†ìŒ');
    }
    
    // 2. PaymentStatus ìë™ ìƒì„±
    if (paymentStatuses.size() == 4 && paymentScheduleCorrect) {
        System.debug('   âœ… PaymentStatus ìë™ ìƒì„±: ì •ìƒ');
        successCount++;
    } else {
        System.debug('   âŒ PaymentStatus ìë™ ìƒì„±: ë¬¸ì œ');
    }
    
    // 3. PDF ìë™ ìƒì„± (Product ìƒì„¸ì„œ)
    if (productPDFExists) {
        System.debug('   âœ… Product ìƒì„¸ì„œ PDF: ì •ìƒ');
        successCount++;
    } else {
        System.debug('   âŒ Product ìƒì„¸ì„œ PDF: ëˆ„ë½');
    }
    
    // 4. Slack ì±„ë„ ìë™ ìƒì„±
    if (targetOrder.Slack_Notification_Status__c == 'Created') {
        System.debug('   âœ… Slack ì±„ë„ ìƒì„±: ì •ìƒ');
        successCount++;
    } else {
        System.debug('   âŒ Slack ì±„ë„ ìƒì„±: ëˆ„ë½');
    }
    
    // 5. Chatter ì•Œë¦¼
    if (chatterPosts.size() > 0) {
        System.debug('   âœ… Chatter ì•Œë¦¼: ì •ìƒ');
        successCount++;
    } else {
        System.debug('   âŒ Chatter ì•Œë¦¼: ëˆ„ë½');
    }
    
    // ì „ì²´ í‰ê°€
    Double successRate = (Double)successCount / totalChecks * 100;
    System.debug('');
    System.debug('ğŸ¯ ì „ì²´ ìë™í™” ì„±ê³µë¥ : ' + successRate.intValue() + '% (' + successCount + '/' + totalChecks + ')');
    
    if (successRate >= 80) {
        System.debug('âœ… ìë™í™” ì‹œìŠ¤í…œ: ì •ìƒ ì‘ë™');
    } else if (successRate >= 60) {
        System.debug('âš ï¸ ìë™í™” ì‹œìŠ¤í…œ: ë¶€ë¶„ ì‘ë™ (ê°œì„  í•„ìš”)');
    } else {
        System.debug('âŒ ìë™í™” ì‹œìŠ¤í…œ: ë¬¸ì œ ìˆìŒ (ì ê²€ í•„ìš”)');
    }
    
    // 8. ê°œì„  ê¶Œì¥ì‚¬í•­
    System.debug('');
    System.debug('ğŸ’¡ ê°œì„  ê¶Œì¥ì‚¬í•­:');
    
    if (!productPDFExists) {
        System.debug('   â€¢ Order Product ìƒì„¸ì„œ PDF ìˆ˜ë™ ìƒì„± í•„ìš”');
        System.debug('     â†’ scripts/apex/execute_order_00000142_automation.apex ì‹¤í–‰');
    }
    
    if (targetOrder.Slack_Notification_Status__c != 'Created') {
        System.debug('   â€¢ Slack ì±„ë„ ìˆ˜ë™ ìƒì„± í•„ìš”');
        System.debug('     â†’ Slack API í† í° ì„¤ì • ë˜ëŠ” ìˆ˜ë™ ì±„ë„ ìƒì„±');
    }
    
    if (chatterPosts.size() == 0) {
        System.debug('   â€¢ Chatter ì•Œë¦¼ ìˆ˜ë™ ìƒì„± í•„ìš”');
        System.debug('     â†’ ìë™í™” ì„œë¹„ìŠ¤ ì¬ì‹¤í–‰ ë˜ëŠ” ìˆ˜ë™ í¬ìŠ¤íŠ¸ ìƒì„±');
    }
    
    System.debug('');
    System.debug('âœ… =====Order 00000142 ê²€í†  ì™„ë£Œ=====');
    
} catch (Exception e) {
    System.debug('âŒ ê²€í†  ì¤‘ ì˜¤ë¥˜: ' + e.getMessage());
    System.debug('Stack Trace: ' + e.getStackTraceString());
}
