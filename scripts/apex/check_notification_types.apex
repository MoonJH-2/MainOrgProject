// Sales ì•± ì•Œë¦¼ì„ ìœ„í•œ CustomNotificationType ì„¤ì • í™•ì¸ ë° ìƒì„± ê°€ì´ë“œ
System.debug('ğŸ”” =====Sales ì•± ì•Œë¦¼ CustomNotificationType ì„¤ì • í™•ì¸=====');

try {
    // 1. í˜„ì¬ ì„¤ì •ëœ CustomNotificationType í™•ì¸
    List<CustomNotificationType> existingTypes = [
        SELECT Id, DeveloperName, MasterLabel, Description
        FROM CustomNotificationType 
        ORDER BY DeveloperName
    ];
    
    System.debug('');
    System.debug('ğŸ“‹ í˜„ì¬ ì„¤ì •ëœ CustomNotificationType: ' + existingTypes.size() + 'ê°œ');
    
    Boolean salesNotificationExists = false;
    Boolean paymentNotificationExists = false;
    
    for (CustomNotificationType type : existingTypes) {
        System.debug('   â€¢ ' + type.MasterLabel + ' (' + type.DeveloperName + ')');
        
        if (type.DeveloperName == 'Sales_Order_Notification') {
            salesNotificationExists = true;
        }
        if (type.DeveloperName == 'Payment_Notification') {
            paymentNotificationExists = true;
        }
    }
    
    // 2. í•„ìˆ˜ CustomNotificationType í™•ì¸
    System.debug('');
    System.debug('âœ… í•„ìˆ˜ CustomNotificationType í™•ì¸:');
    
    if (salesNotificationExists) {
        System.debug('   âœ… Sales_Order_Notification: ì„¤ì •ë¨');
    } else {
        System.debug('   âŒ Sales_Order_Notification: ì„¤ì • í•„ìš”');
    }
    
    if (paymentNotificationExists) {
        System.debug('   âœ… Payment_Notification: ì„¤ì •ë¨');
    } else {
        System.debug('   âŒ Payment_Notification: ì„¤ì • í•„ìš”');
    }
    
    // 3. ìƒì„±ì´ í•„ìš”í•œ ê²½ìš° Setup ê°€ì´ë“œ ì œê³µ
    if (!salesNotificationExists || !paymentNotificationExists) {
        System.debug('');
        System.debug('ğŸ”§ =====CustomNotificationType ìƒì„± ê°€ì´ë“œ=====');
        System.debug('');
        System.debug('Setupì—ì„œ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ë”°ë¼ ìƒì„±í•´ì£¼ì„¸ìš”:');
        System.debug('1. Setup (âš™ï¸) > Quick Findì—ì„œ "Custom Notifications" ê²€ìƒ‰');
        System.debug('2. Custom Notification Types í˜ì´ì§€ë¡œ ì´ë™');
        System.debug('3. "New" ë²„íŠ¼ í´ë¦­');
        System.debug('');
        
        if (!salesNotificationExists) {
            System.debug('ğŸ“ Sales_Order_Notification ìƒì„±:');
            System.debug('   - Custom Notification Type Name: Sales Order Notification');
            System.debug('   - API Name: Sales_Order_Notification');
            System.debug('   - Description: Order ìƒì„±, Slack ì±„ë„ ìƒì„±, ì—°ì²´ ì•Œë¦¼');
            System.debug('   - Notification Channel: Desktop and Mobile');
            System.debug('');
        }
        
        if (!paymentNotificationExists) {
            System.debug('ğŸ“ Payment_Notification ìƒì„±:');
            System.debug('   - Custom Notification Type Name: Payment Notification');
            System.debug('   - API Name: Payment_Notification');
            System.debug('   - Description: ë‚©ë¶€ ì˜ˆì • ë° ì—°ì²´ ì•Œë¦¼');
            System.debug('   - Notification Channel: Desktop and Mobile');
            System.debug('');
        }
        
        System.debug('4. Save í´ë¦­');
        System.debug('5. ìƒì„± í›„ ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ì—¬ í™•ì¸');
    }
    
    // 4. í˜„ì¬ ì‚¬ìš©ì ì •ë³´ í™•ì¸
    System.debug('');
    System.debug('ğŸ‘¤ í˜„ì¬ ì‚¬ìš©ì ì •ë³´:');
    
    User currentUser = [
        SELECT Id, Name, Email, ProfileId, Profile.Name, ManagerId, Manager.Name, Manager.Email
        FROM User 
        WHERE Id = :UserInfo.getUserId()
    ];
    
    System.debug('   ì‚¬ìš©ì: ' + currentUser.Name + ' (' + currentUser.Email + ')');
    System.debug('   Profile: ' + currentUser.Profile.Name);
    
    if (currentUser.ManagerId != null) {
        System.debug('   Manager: ' + currentUser.Manager.Name + ' (' + currentUser.Manager.Email + ')');
    } else {
        System.debug('   Manager: ì—†ìŒ');
    }
    
    // 5. ì•Œë¦¼ ìˆ˜ì‹  í…ŒìŠ¤íŠ¸ (ì„¤ì •ì´ ì™„ë£Œëœ ê²½ìš°)
    if (salesNotificationExists) {
        System.debug('');
        System.debug('ğŸ§ª ì•Œë¦¼ ìˆ˜ì‹  í…ŒìŠ¤íŠ¸:');
        
        try {
            CustomNotificationType salesType = [
                SELECT Id FROM CustomNotificationType 
                WHERE DeveloperName = 'Sales_Order_Notification'
                LIMIT 1
            ];
            
            Set<String> recipients = new Set<String>();
            recipients.add(UserInfo.getUserId());
            
            if (currentUser.ManagerId != null) {
                recipients.add(currentUser.ManagerId);
            }
            
            Messaging.CustomNotification testNotification = new Messaging.CustomNotification();
            testNotification.setTitle('ğŸ§ª í…ŒìŠ¤íŠ¸ ì•Œë¦¼');
            testNotification.setBody('Sales ì•± ì•Œë¦¼ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.');
            testNotification.setNotificationTypeId(salesType.Id);
            testNotification.send(recipients);
            
            System.debug('   âœ… í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë°œì†¡ ì™„ë£Œ (ìˆ˜ì‹ ì: ' + recipients.size() + 'ëª…)');
            System.debug('   ğŸ’¡ ìƒë‹¨ ë²¨ ì•„ì´ì½˜ì„ í™•ì¸í•´ë³´ì„¸ìš”!');
            
        } catch (Exception testEx) {
            System.debug('   âŒ í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë°œì†¡ ì‹¤íŒ¨: ' + testEx.getMessage());
        }
    }
    
    // 6. ê²°ë¡ 
    System.debug('');
    System.debug('ğŸ“Š ì„¤ì • ìƒíƒœ ìš”ì•½:');
    System.debug('   Sales Order ì•Œë¦¼: ' + (salesNotificationExists ? 'âœ… ì¤€ë¹„ë¨' : 'âŒ ì„¤ì • í•„ìš”'));
    System.debug('   Payment ì•Œë¦¼: ' + (paymentNotificationExists ? 'âœ… ì¤€ë¹„ë¨' : 'âŒ ì„¤ì • í•„ìš”'));
    
} catch (Exception e) {
    System.debug('âŒ CustomNotificationType í™•ì¸ ì¤‘ ì˜¤ë¥˜: ' + e.getMessage());
    System.debug('   íƒ€ì…: ' + e.getTypeName());
    System.debug('   ë¼ì¸: ' + e.getLineNumber());
}

System.debug('');
System.debug('âœ… =====CustomNotificationType ì„¤ì • í™•ì¸ ì™„ë£Œ=====');
