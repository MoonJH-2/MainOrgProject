// Order 00000158 Slack Channel í™œì„±í™” ë¬¸ì œ ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸
// Slack Channel IDëŠ” ìˆì§€ë§Œ í™”ë©´ì—ì„œ ë¹„í™œì„±í™”ë˜ëŠ” ì›ì¸ ë¶„ì„

try {
    // 1. Order 00000158 ìƒì„¸ ì •ë³´ ì¡°íšŒ
    List<Order> orders = [
        SELECT Id, OrderNumber, Slack_Channel_ID__c, Slack_Channel_Name__c, 
               Slack_Notification_Status__c, Slack_Webhook_URL__c,
               CreatedDate, LastModifiedDate, Status,
               Account.Name, Opportunity__c, OwnerId, Owner.Name
        FROM Order 
        WHERE OrderNumber = '00000158'
        LIMIT 1
    ];
    
    if (orders.isEmpty()) {
        System.debug('âŒ Order 00000158ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    
    Order order = orders[0];
    System.debug('=== Order 00000158 ìƒì„¸ ë¶„ì„ ===');
    System.debug('Order ID: ' + order.Id);
    System.debug('Order Number: ' + order.OrderNumber);
    System.debug('Status: ' + order.Status);
    System.debug('Slack Channel ID: ' + order.Slack_Channel_ID__c);
    System.debug('Slack Channel Name: ' + order.Slack_Channel_Name__c);
    System.debug('Slack Webhook URL: ' + order.Slack_Webhook_URL__c);
    System.debug('Slack Notification Status: ' + order.Slack_Notification_Status__c);
    System.debug('Created Date: ' + order.CreatedDate);
    System.debug('Last Modified Date: ' + order.LastModifiedDate);
    System.debug('Account: ' + order.Account.Name);
    System.debug('Owner: ' + order.Owner.Name);
    
    // 2. Slack Channel í™œì„±í™” ì¡°ê±´ ë¶„ì„
    System.debug('\n=== Slack Channel í™œì„±í™” ì¡°ê±´ ë¶„ì„ ===');
    
    // ì¡°ê±´ 1: Slack Channel ID ì¡´ì¬ ì—¬ë¶€
    Boolean hasSlackChannelId = String.isNotBlank(order.Slack_Channel_ID__c);
    System.debug('1. Slack Channel ID ì¡´ì¬: ' + hasSlackChannelId);
    
    // ì¡°ê±´ 2: Slack Webhook URL ì¡´ì¬ ì—¬ë¶€
    Boolean hasWebhookUrl = String.isNotBlank(order.Slack_Webhook_URL__c);
    System.debug('2. Slack Webhook URL ì¡´ì¬: ' + hasWebhookUrl);
    
    // ì¡°ê±´ 3: Notification Status í™•ì¸
    String notificationStatus = order.Slack_Notification_Status__c;
    System.debug('3. Notification Status: ' + notificationStatus);
    
    // ì¡°ê±´ 4: í•„ìˆ˜ í•„ë“œ ëˆ„ë½ í™•ì¸
    List<String> missingFields = new List<String>();
    if (!hasSlackChannelId) missingFields.add('Slack_Channel_ID__c');
    if (!hasWebhookUrl) missingFields.add('Slack_Webhook_URL__c');
    if (String.isBlank(order.Slack_Channel_Name__c)) missingFields.add('Slack_Channel_Name__c');
    
    if (!missingFields.isEmpty()) {
        System.debug('âŒ ëˆ„ë½ëœ í•„ìˆ˜ í•„ë“œ: ' + String.join(missingFields, ', '));
    } else {
        System.debug('âœ… ëª¨ë“  í•„ìˆ˜ í•„ë“œ ì¡´ì¬í•¨');
    }
    
    // 3. Salesforce ì±„ë„ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
    System.debug('\n=== Salesforce ì±„ë„ ì¡´ì¬ ì—¬ë¶€ í™•ì¸ ===');
    List<CollaborationGroup> salesforceChannels = [
        SELECT Id, Name, Description, CreatedDate, MemberCount
        FROM CollaborationGroup 
        WHERE Name LIKE '%00000158%' 
        OR Description LIKE '%00000158%'
    ];
    
    if (salesforceChannels.isEmpty()) {
        System.debug('âŒ Order 00000158ìš© Salesforce ì±„ë„ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŒ');
    } else {
        System.debug('âœ… Salesforce ì±„ë„ ë°œê²¬: ' + salesforceChannels.size() + 'ê°œ');
        for (CollaborationGroup channel : salesforceChannels) {
            System.debug('- ì±„ë„ ID: ' + channel.Id);
            System.debug('- ì±„ë„ ì´ë¦„: ' + channel.Name);
            System.debug('- ì„¤ëª…: ' + channel.Description);
            System.debug('- ìƒì„±ì¼: ' + channel.CreatedDate);
            System.debug('- ë©¤ë²„ ìˆ˜: ' + channel.MemberCount);
        }
    }
    
    // 4. ê°€ëŠ¥í•œ í•´ê²° ë°©ë²• ì œì‹œ
    System.debug('\n=== í•´ê²° ë°©ë²• ì œì‹œ ===');
    
    if (notificationStatus == 'Not Created') {
        System.debug('ğŸ¯ ë¬¸ì œ: Slack Notification Statusê°€ "Not Created"');
        System.debug('ğŸ’¡ í•´ê²°ì±… 1: Notification Statusë¥¼ "Created"ë¡œ ì—…ë°ì´íŠ¸');
        System.debug('ğŸ’¡ í•´ê²°ì±… 2: Slack Webhook URL ì¬ì„¤ì •');
        System.debug('ğŸ’¡ í•´ê²°ì±… 3: Salesforce ì±„ë„ê³¼ Slack ì±„ë„ ì—°ë™ í™•ì¸');
    }
    
    if (!hasWebhookUrl) {
        System.debug('ğŸ¯ ë¬¸ì œ: Slack Webhook URLì´ ë¹„ì–´ìˆìŒ');
        System.debug('ğŸ’¡ í•´ê²°ì±…: Webhook URL ì„¤ì • í•„ìš”');
    }
    
    if (salesforceChannels.isEmpty()) {
        System.debug('ğŸ¯ ë¬¸ì œ: Salesforce ì±„ë„ì´ ìƒì„±ë˜ì§€ ì•ŠìŒ');
        System.debug('ğŸ’¡ í•´ê²°ì±…: SimpleSalesforceChannelServiceë¡œ ì±„ë„ ìƒì„±');
    }
    
} catch (Exception e) {
    System.debug('âŒ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + e.getMessage());
    System.debug('ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤: ' + e.getStackTraceString());
}
