/**
 * Sales ì•± ì±„ë„ ê¸°ëŠ¥ ë¹ ë¥¸ ë°ëª¨ ìŠ¤í¬ë¦½íŠ¸
 * ëª©ì : ì‹¤ì œ í™˜ê²½ì—ì„œ ì¦‰ì‹œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ë°ëª¨ ì‹œë‚˜ë¦¬ì˜¤
 * ì‚¬ìš©ë²•: Developer Console â†’ Execute Anonymousì—ì„œ ì‹¤í–‰
 */
 
// 1. ê¸°ì¡´ ì±„ë„ í˜„í™© í™•ì¸
System.debug('=== ğŸ“Š í˜„ì¬ ì±„ë„ í˜„í™© ===');
List<CollaborationGroup> channels = [
    SELECT Id, Name, Description, MemberCount, LastReferencedDate 
    FROM CollaborationGroup 
    WHERE Name LIKE 'Order-%' 
    ORDER BY LastReferencedDate DESC NULLS LAST
    LIMIT 5
];

for(CollaborationGroup channel : channels) {
    System.debug('ì±„ë„ëª…: ' + channel.Name + ' | ë©¤ë²„ìˆ˜: ' + channel.MemberCount + ' | ìµœê·¼í™œë™: ' + channel.LastReferencedDate);
}

// 2. ì‹ ê·œ í…ŒìŠ¤íŠ¸ Order ìƒì„± (í•„ìš”í•œ ê²½ìš°)
String testOrderName = 'Order-DEMO-' + String.valueOf(System.now().getTime()).right(6);
System.debug('=== ğŸ†• í…ŒìŠ¤íŠ¸ Order ìƒì„± ì‹œë„: ' + testOrderName + ' ===');

try {
    // Order í•„ìˆ˜ í•„ë“œë“¤ë§Œ ì‚¬ìš©í•˜ì—¬ ìƒì„±
    Order testOrder = new Order(
        Name = testOrderName,
        Status = 'Draft',
        EffectiveDate = Date.today(),
        AccountId = [SELECT Id FROM Account LIMIT 1].Id // ê¸°ì¡´ Account ì‚¬ìš©
    );
    insert testOrder;
    
    System.debug('âœ… í…ŒìŠ¤íŠ¸ Order ìƒì„± ì„±ê³µ: ' + testOrder.Id);
    
    // 3. ì±„ë„ ìë™ ìƒì„± ì‹œë®¬ë ˆì´ì…˜
    SalesforceChannelService channelService = new SalesforceChannelService();
    String channelId = channelService.createOrderChannel(testOrder.Id);
    
    if(channelId != null) {
        System.debug('âœ… ì±„ë„ ìƒì„± ì„±ê³µ: ' + channelId);
        
        // í˜„ì¬ ì‚¬ìš©ìë¥¼ ì±„ë„ì— ì¶”ê°€
        channelService.addUserToChannel(channelId, UserInfo.getUserId());
        
        // í™˜ì˜ ë©”ì‹œì§€ ë°œì†¡
        channelService.postWelcomeMessage(channelId, testOrder.Id, testOrderName);
        
        System.debug('ğŸ“± Sales ì•±ì—ì„œ í™•ì¸ ë°©ë²•:');
        System.debug('1. Sales ì•± â†’ ìƒë‹¨ ê²€ìƒ‰ì°½ì— "' + testOrderName + '" ì…ë ¥');
        System.debug('2. Chatter â†’ ê·¸ë£¹ â†’ "' + testOrderName + '" ì°¾ê¸°');
        System.debug('3. ë˜ëŠ” ì§ì ‘ URL: /lightning/r/CollaborationGroup/' + channelId + '/view');
        
    } else {
        System.debug('âŒ ì±„ë„ ìƒì„± ì‹¤íŒ¨');
    }
    
} catch(Exception e) {
    System.debug('âŒ ì˜¤ë¥˜ ë°œìƒ: ' + e.getMessage());
    System.debug('ğŸ’¡ í•´ê²°ë°©ë²•: Accountê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ê±°ë‚˜ ê¸°ì¡´ Orderë¡œ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.');
}

// 4. Payment Notification í†µê³„ í™•ì¸
System.debug('=== ğŸ’° Payment Notification í˜„í™© ===');
try {
    List<AggregateResult> notificationStats = [
        SELECT Notification_Type__c, COUNT(Id) cnt 
        FROM Payment_Notification__c 
        WHERE CreatedDate = TODAY 
        GROUP BY Notification_Type__c
    ];
    
    for(AggregateResult result : notificationStats) {
        System.debug('ì•Œë¦¼ìœ í˜•: ' + result.get('Notification_Type__c') + ' | ê±´ìˆ˜: ' + result.get('cnt'));
    }
} catch(Exception e) {
    System.debug('Payment_Notification__c ì˜¤ë¸Œì íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
}

// 5. ì¦‰ì‹œ í™•ì¸ ê°€ëŠ¥í•œ ì•¡ì…˜ ì•„ì´í…œ
System.debug('=== ğŸ¯ ì¦‰ì‹œ í™•ì¸í•  ìˆ˜ ìˆëŠ” í•­ëª©ë“¤ ===');
System.debug('1. ğŸ“± Sales ì•±ì—ì„œ Chatter â†’ ê·¸ë£¹ í™•ì¸');
System.debug('2. ğŸ” Global Searchì—ì„œ "Order-" ê²€ìƒ‰');
System.debug('3. ğŸ“Š Reports â†’ "Order ì±„ë„ í˜„í™©" ë ˆí¬íŠ¸ ìƒì„±');
System.debug('4. âš¡ PaymentNotificationDashboard LWC í™•ì¸');
System.debug('5. ğŸ“§ ì´ë©”ì¼ ì•Œë¦¼ ì„¤ì • í™•ì¸ (Setup â†’ Email)');
System.debug('6. ğŸš€ ì™„ì „ ì „í™˜: scripts/apex/migrate_order_155_to_salesforce.apex');

System.debug('=== âœ… ë°ëª¨ ì™„ë£Œ ===');
System.debug('ğŸ’¡ ì¶”ê°€ ë„ì›€ì´ í•„ìš”í•˜ë©´ Salesforce_Channels_Implementation_Guide.md ì°¸ì¡°');
System.debug('ğŸ¯ Order 00000155 ì™„ì „ ì „í™˜: migrate_order_155_to_salesforce.apex ì‹¤í–‰');
