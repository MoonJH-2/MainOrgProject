/**
 * ë¹ ë¥¸ ì™„ë‚© í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
 * Developer Consoleì—ì„œ ì‹¤í–‰
 */

System.debug('ğŸ¯ ë¹ ë¥¸ ì™„ë‚© í…ŒìŠ¤íŠ¸ ì‹œì‘');

try {
    // í…ŒìŠ¤íŠ¸í•  Order í•˜ë‚˜ ì„ íƒ
    List<Order> orders = [
        SELECT Id, OrderNumber 
        FROM Order 
        WHERE Id IN (SELECT Order__c FROM PaymentStatus__c WHERE Status__c != 'ì™„ë‚©')
        LIMIT 1
    ];
    
    if (orders.isEmpty()) {
        System.debug('âŒ í…ŒìŠ¤íŠ¸í•  Orderë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    
    Id testOrderId = orders[0].Id;
    System.debug('ğŸ“‹ í…ŒìŠ¤íŠ¸ Order: ' + orders[0].OrderNumber);
    
    // STEP 1: ì™„ë‚© ì²˜ë¦¬
    String result = PaymentStatusTimelineController.markAllPaymentsAsCompleted(testOrderId);
    System.debug('ì™„ë‚© ì²˜ë¦¬: ' + result);
    
    // STEP 2: PDF ìƒì„± (ë‚©ë¶€í™•ì¸ì„œ + ì„¸ê¸ˆê³„ì‚°ì„œ)
    String pdfId = PaymentStatusTimelineController.generatePaymentSchedulePDF(testOrderId);
    System.debug('PDF ìƒì„±: ' + pdfId);
    
    // STEP 3: ê²°ê³¼ í™•ì¸
    PaymentStatusTimelineController.PaymentTimelineWrapper timeline = 
        PaymentStatusTimelineController.getPaymentTimeline(testOrderId);
    
    System.debug('âœ… ìµœì¢… ê²°ê³¼:');
    System.debug('   ì™„ë‚©ë¥ : ' + timeline.progressPercentage + '%');
    System.debug('   ì™„ë‚© í•­ëª©: ' + timeline.completedInstallments + '/' + timeline.totalInstallments);
    
    if (timeline.progressPercentage == 100) {
        System.debug('ğŸ‰ í…ŒìŠ¤íŠ¸ ì„±ê³µ: íƒ€ì„ë¼ì¸ì´ ì™„ë‚© ìƒíƒœë¡œ ì—…ë°ì´íŠ¸ë¨');
    }
    
} catch (Exception e) {
    System.debug('âŒ ì˜¤ë¥˜: ' + e.getMessage());
}

System.debug('ğŸ¯ ë¹ ë¥¸ ì™„ë‚© í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
