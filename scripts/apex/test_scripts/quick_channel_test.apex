/**
 * @description Salesforce Channel ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
 * @author JH Moon  
 * @created 2025-07-22
 */

System.debug('ğŸ§ª =====Salesforce Channel ê°„ë‹¨ í…ŒìŠ¤íŠ¸=====');

try {
    // 1. ì»¤ìŠ¤í…€ í•„ë“œ ê²€ì¦
    System.debug('1ï¸âƒ£ Order ì»¤ìŠ¤í…€ í•„ë“œ ê²€ì¦...');
    OrderChannelFields.validateChannelFields();
    
    // 2. í…ŒìŠ¤íŠ¸í•  Order ì¡°íšŒ
    System.debug('2ï¸âƒ£ í…ŒìŠ¤íŠ¸ Order ì¡°íšŒ...');
    List<Order> orders = [
        SELECT Id, OrderNumber, Account.Name, Status, OwnerId, Owner.Name
        FROM Order 
        WHERE Status IN ('Draft', 'Activated')
        ORDER BY CreatedDate DESC
        LIMIT 3
    ];
    
    if (orders.isEmpty()) {
        System.debug('âŒ í…ŒìŠ¤íŠ¸í•  Orderê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    
    System.debug('âœ… ì°¾ì€ Order ìˆ˜: ' + orders.size() + 'ê°œ');
    for (Order order : orders) {
        System.debug('   â€¢ ' + order.OrderNumber + ' (' + order.Account.Name + ') - ' + order.Status);
    }
    
    // 3. ê¸°ë³¸ ë©”ì‹œì§€ ë°œì†¡ í…ŒìŠ¤íŠ¸
    System.debug('3ï¸âƒ£ ë©”ì‹œì§€ ë°œì†¡ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸...');
    
    String testMessage = 'ğŸš€ **Salesforce Channel ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸**\n\n';
    testMessage += 'WSDL ê¸°ë°˜ Salesforce Channels êµ¬í˜„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\n';
    testMessage += 'ğŸ“‹ **ì£¼ìš” ê¸°ëŠ¥**\n';
    testMessage += 'â€¢ Enterprise WSDL í™œìš©í•œ ë„¤ì´í‹°ë¸Œ ì±„ë„ ìƒì„±\n';
    testMessage += 'â€¢ Chatter Group í´ë°± ì‹œìŠ¤í…œ\n';  
    testMessage += 'â€¢ Payment Notification í†µí•©\n';
    testMessage += 'â€¢ ìë™ ë©¤ë²„ ê´€ë¦¬\n\n';
    testMessage += 'âœ¨ ê¸°ì¡´ Slack ì±„ë„ ëŒ€ì‹  ì™„ì „í•œ Salesforce í†µí•© ì†”ë£¨ì…˜!';
    
    System.debug('ğŸ’¬ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ë‚´ìš©:');
    System.debug(testMessage);
    
    // 4. ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸
    System.debug('4ï¸âƒ£ ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸...');
    
    // Payment Notification í†µê³„
    List<AggregateResult> notificationStats = [
        SELECT NotificationChannel__c channel, COUNT(Id) cnt
        FROM Payment_Notification__c 
        WHERE CreatedDate = LAST_N_DAYS:7
        GROUP BY NotificationChannel__c
    ];
    
    System.debug('ğŸ“Š ìµœê·¼ 7ì¼ ì•Œë¦¼ í†µê³„:');
    for (AggregateResult stat : notificationStats) {
        System.debug('   â€¢ ' + stat.get('channel') + ': ' + stat.get('cnt') + 'ê±´');
    }
    
    // Order Channel í˜„í™©
    List<AggregateResult> channelStats = [
        SELECT Channel_Status__c status, COUNT(Id) cnt
        FROM Order 
        WHERE Salesforce_Channel_ID__c != null
        GROUP BY Channel_Status__c
    ];
    
    System.debug('ğŸ“ˆ Order Channel í˜„í™©:');
    for (AggregateResult stat : channelStats) {
        System.debug('   â€¢ ' + stat.get('status') + ': ' + stat.get('cnt') + 'ê°œ');
    }
    
    // 5. ê²°ê³¼ ìš”ì•½
    System.debug('');
    System.debug('ğŸ¯ =====êµ¬í˜„ ì™„ë£Œ ê¸°ëŠ¥=====');
    System.debug('âœ… SalesforceChannelService.cls - ì±„ë„ ìƒì„±/ê´€ë¦¬');
    System.debug('âœ… PaymentNotificationService.cls - ì±„ë„ ì•Œë¦¼ í†µí•©');
    System.debug('âœ… OrderTriggerHandler.cls - Slack â†’ Salesforce ì±„ë„ ì „í™˜');
    System.debug('âœ… PaymentNotificationDashboard - UI í™•ì¥');
    System.debug('âœ… í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ - ì¢…í•© í…ŒìŠ¤íŠ¸ ê°€ëŠ¥');
    System.debug('');
    System.debug('ğŸ”§ =====ë‹¤ìŒ ë‹¨ê³„=====');
    System.debug('1. Setupì—ì„œ Order ì»¤ìŠ¤í…€ í•„ë“œ ìƒì„±');
    System.debug('2. ì‹¤ì œ Orderë¡œ ì±„ë„ ìƒì„± í…ŒìŠ¤íŠ¸');
    System.debug('3. Payment Notification ì±„ë„ ì•Œë¦¼ í…ŒìŠ¤íŠ¸');
    System.debug('4. ëŒ€ì‹œë³´ë“œì—ì„œ SalesforceChannel í†µê³„ í™•ì¸');
    
    System.debug('âœ… =====Salesforce Channel ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì™„ë£Œ=====');
    
} catch (Exception e) {
    System.debug('âŒ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ' + e.getMessage());
    System.debug('Stack Trace: ' + e.getStackTraceString());
}
