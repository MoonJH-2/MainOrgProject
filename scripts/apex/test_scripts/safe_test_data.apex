/**
 * ì™„ì „íˆ ì•ˆì „í•œ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± (êµ­ê°€/ì£¼ í•„ë“œ ì˜¤ë¥˜ í•´ê²°)
 * ëª©ì : ëª¨ë“  í™˜ê²½ì—ì„œ ë™ì‘í•˜ëŠ” ì•ˆì „í•œ ë°ì´í„° ìƒì„±
 */

System.debug('ğŸ›¡ï¸ === ì•ˆì „í•œ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ì‹œì‘ ===');

try {
    // 1. ê¸°ì¡´ ë°ì´í„° ì™„ì „ ì •ë¦¬
    System.debug('ğŸ—‘ï¸ ëª¨ë“  ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì •ë¦¬...');
    
    // Opportunity ë¨¼ì € ì‚­ì œ (ì™¸ë˜í‚¤ ì°¸ì¡° ë•Œë¬¸)
    List<Opportunity> allOpps = [SELECT Id FROM Opportunity WHERE Account.Name LIKE '%í…ŒìŠ¤íŠ¸%' OR Account.Name LIKE '%ìš°ìˆ˜%' OR Account.Name LIKE '%ì£¼ì˜%'];
    if(!allOpps.isEmpty()) {
        delete allOpps;
        System.debug('âœ… ëª¨ë“  Opportunity ì‚­ì œ: ' + allOpps.size() + 'ê°œ');
    }
    
    // Case ì‚­ì œ
    List<Case> allCases = [SELECT Id FROM Case WHERE Account.Name LIKE '%í…ŒìŠ¤íŠ¸%' OR Account.Name LIKE '%ìš°ìˆ˜%' OR Account.Name LIKE '%ì£¼ì˜%'];
    if(!allCases.isEmpty()) {
        delete allCases;
        System.debug('âœ… ëª¨ë“  Case ì‚­ì œ: ' + allCases.size() + 'ê°œ');
    }
    
    // Asset ì‚­ì œ
    List<Asset> allAssets = [SELECT Id FROM Asset WHERE Account.Name LIKE '%í…ŒìŠ¤íŠ¸%' OR Account.Name LIKE '%ìš°ìˆ˜%' OR Account.Name LIKE '%ì£¼ì˜%'];
    if(!allAssets.isEmpty()) {
        delete allAssets;
        System.debug('âœ… ëª¨ë“  Asset ì‚­ì œ: ' + allAssets.size() + 'ê°œ');
    }
    
    // Account ë§ˆì§€ë§‰ ì‚­ì œ
    List<Account> allAccounts = [SELECT Id FROM Account WHERE Name LIKE '%í…ŒìŠ¤íŠ¸%' OR Name LIKE '%ìš°ìˆ˜%' OR Name LIKE '%ì£¼ì˜%'];
    if(!allAccounts.isEmpty()) {
        delete allAccounts;
        System.debug('âœ… ëª¨ë“  Account ì‚­ì œ: ' + allAccounts.size() + 'ê°œ');
    }
    
    // 2. ìµœì†Œí•œì˜ í•„ìˆ˜ í•„ë“œë§Œìœ¼ë¡œ ì•ˆì „í•œ Account ìƒì„±
    System.debug('ğŸš€ ì•ˆì „í•œ Account ìƒì„±...');
    
    Account safeAccount1 = new Account(
        Name = 'í…ŒìŠ¤íŠ¸ê¸°ì—…',
        Type = 'Customer'
    );
    
    Account safeAccount2 = new Account(
        Name = 'ìš°ìˆ˜ê¸°ì—…', 
        Type = 'Customer'
    );
    
    Account safeAccount3 = new Account(
        Name = 'ì£¼ì˜ê¸°ì—…',
        Type = 'Customer'
    );
    
    List<Account> accountsToInsert = new List<Account>{safeAccount1, safeAccount2, safeAccount3};
    insert accountsToInsert;
    System.debug('âœ… ì•ˆì „í•œ Account 3ê°œ ìƒì„± ì™„ë£Œ');
    
    // 3. ì•ˆì „í•œ Asset ìƒì„± (í•„ìˆ˜ í•„ë“œë§Œ)
    System.debug('ğŸš€ ì•ˆì „í•œ Asset ìƒì„±...');
    
    Asset urgentAsset = new Asset(
        Name = 'ê¸´ê¸‰ ê°±ì‹  ì‹œìŠ¤í…œ',
        AccountId = safeAccount1.Id,
        Status = 'Installed',
        Price = 30000000,
        InstallDate = Date.today().addDays(-350), // 350ì¼ ì „ ì„¤ì¹˜
        UsageEndDate = Date.today().addDays(5) // 5ì¼ í›„ ë§Œë£Œ - ê¸´ê¸‰!
    );
    
    Asset mediumAsset = new Asset(
        Name = 'í‘œì¤€ ì—…ë¬´ ì‹œìŠ¤í…œ', 
        AccountId = safeAccount2.Id,
        Status = 'Installed',
        Price = 15000000,
        InstallDate = Date.today().addDays(-320), // 320ì¼ ì „ ì„¤ì¹˜
        UsageEndDate = Date.today().addDays(45) // 45ì¼ í›„ ë§Œë£Œ - ì¤‘ê°„
    );
    
    List<Asset> assetsToInsert = new List<Asset>{urgentAsset, mediumAsset};
    insert assetsToInsert;
    System.debug('âœ… ì•ˆì „í•œ Asset 2ê°œ ìƒì„± ì™„ë£Œ');
    
    // 4. ì•ˆì „í•œ Opportunity ìƒì„±
    System.debug('ğŸš€ ì•ˆì „í•œ Opportunity ìƒì„±...');
    
    Opportunity completedOpp = new Opportunity(
        Name = 'ì™„ë£Œëœ ê°±ì‹  - í…ŒìŠ¤íŠ¸ê¸°ì—…',
        AccountId = safeAccount1.Id,
        StageName = 'Closed Won',
        CloseDate = Date.today().addDays(-5), // 5ì¼ ì „ ì™„ë£Œ
        Amount = 25000000,
        Type = 'Renewal'
    );
    
    Opportunity inProgressOpp = new Opportunity(
        Name = 'ì§„í–‰ì¤‘ì¸ ê°±ì‹  - ìš°ìˆ˜ê¸°ì—…',
        AccountId = safeAccount2.Id,
        StageName = 'Prospecting', 
        CloseDate = Date.today().addDays(30), // 30ì¼ í›„ ì˜ˆì •
        Amount = 40000000,
        Type = 'Renewal'
    );
    
    List<Opportunity> oppsToInsert = new List<Opportunity>{completedOpp, inProgressOpp};
    insert oppsToInsert;
    System.debug('âœ… ì•ˆì „í•œ Opportunity 2ê°œ ìƒì„± ì™„ë£Œ');
    
    // 5. ê³ ê° ê±´ê°•ë„ë¥¼ ìœ„í•œ Case ìƒì„±
    System.debug('ğŸš€ ê±´ê°•ë„ ë¶„ì„ìš© Case ìƒì„±...');
    
    Case riskCase1 = new Case(
        AccountId = safeAccount3.Id, // ì£¼ì˜ê¸°ì—…
        Subject = 'ì‹œìŠ¤í…œ ì˜¤ë¥˜ ë³´ê³ ',
        Status = 'New',
        Priority = 'High'
    );
    
    Case riskCase2 = new Case(
        AccountId = safeAccount3.Id, // ì£¼ì˜ê¸°ì—… (ê°™ì€ ê³ ê°ì— 2ê°œ Case = ìœ„í—˜)
        Subject = 'ì„±ëŠ¥ ì €í•˜ ë¬¸ì˜',
        Status = 'Working',
        Priority = 'Medium'
    );
    
    List<Case> casesToInsert = new List<Case>{riskCase1, riskCase2};
    insert casesToInsert;
    System.debug('âœ… ê±´ê°•ë„ ë¶„ì„ìš© Case 2ê°œ ìƒì„± ì™„ë£Œ');
    
    // 6. ìµœì¢… ê²€ì¦
    System.debug('');
    System.debug('ğŸ“Š === ìµœì¢… ë°ì´í„° ê²€ì¦ ===');
    
    Integer finalAccountCount = [SELECT COUNT() FROM Account WHERE Name LIKE '%í…ŒìŠ¤íŠ¸%' OR Name LIKE '%ìš°ìˆ˜%' OR Name LIKE '%ì£¼ì˜%'];
    Integer finalAssetCount = [SELECT COUNT() FROM Asset WHERE Account.Name LIKE '%í…ŒìŠ¤íŠ¸%' OR Account.Name LIKE '%ìš°ìˆ˜%' OR Account.Name LIKE '%ì£¼ì˜%'];
    Integer finalOppCount = [SELECT COUNT() FROM Opportunity WHERE Account.Name LIKE '%í…ŒìŠ¤íŠ¸%' OR Account.Name LIKE '%ìš°ìˆ˜%' OR Account.Name LIKE '%ì£¼ì˜%'];
    Integer finalCaseCount = [SELECT COUNT() FROM Case WHERE Account.Name LIKE '%í…ŒìŠ¤íŠ¸%' OR Account.Name LIKE '%ìš°ìˆ˜%' OR Account.Name LIKE '%ì£¼ì˜%'];
    
    System.debug('âœ… ìµœì¢… Account: ' + finalAccountCount + 'ê°œ');
    System.debug('âœ… ìµœì¢… Asset: ' + finalAssetCount + 'ê°œ');
    System.debug('âœ… ìµœì¢… Opportunity: ' + finalOppCount + 'ê°œ');
    System.debug('âœ… ìµœì¢… Case: ' + finalCaseCount + 'ê°œ');
    
} catch(Exception e) {
    System.debug('âŒ ì•ˆì „í•œ ìƒì„± ì¤‘ ì˜¤ë¥˜: ' + e.getMessage());
    System.debug('âŒ íƒ€ì…: ' + e.getTypeName());
    System.debug('âŒ ë¼ì¸: ' + e.getLineNumber());
    System.debug('âŒ ìŠ¤íƒ: ' + e.getStackTraceString());
}

System.debug('');
System.debug('ğŸ¯ === ì˜ˆìƒ ëŒ€ì‹œë³´ë“œ ê²°ê³¼ ===');
System.debug('ğŸ’° ì˜¤ëŠ˜ ì˜ˆìƒ ë§¤ì¶œ: 4,050ë§Œì›');
System.debug('  ğŸ”¥ í…ŒìŠ¤íŠ¸ê¸°ì—… ê¸´ê¸‰: 2,700ë§Œì› (3,000ë§Œì› Ã— 90%)');
System.debug('  âš ï¸ ìš°ìˆ˜ê¸°ì—… ì¤‘ê°„: 1,350ë§Œì› (1,500ë§Œì› Ã— 90%)');
System.debug('ğŸ¯ ì›”ê°„ ì™„ë£Œ: 1ê±´, 2,500ë§Œì›');
System.debug('ğŸ¯ ì›”ê°„ ì§„í–‰: 1ê±´, 4,000ë§Œì›');
System.debug('ğŸ¥ ê³ ê° ê±´ê°•ë„:');
System.debug('  ğŸŸ¢ ê±´ê°•: 2ëª… (í…ŒìŠ¤íŠ¸ê¸°ì—…, ìš°ìˆ˜ê¸°ì—…)');
System.debug('  ğŸ”´ ìœ„í—˜: 1ëª… (ì£¼ì˜ê¸°ì—… - Case 2ê±´)');
System.debug('ğŸ† ì‹¤ë²„ ë ˆë²¨ ë‹¬ì„±!');
System.debug('');
System.debug('ğŸ›¡ï¸ === ì•ˆì „í•œ ë°ì´í„° ìƒì„± ì™„ë£Œ ===');
System.debug('ğŸ’¡ ì´ì œ Assets Performance ëŒ€ì‹œë³´ë“œë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”!');
