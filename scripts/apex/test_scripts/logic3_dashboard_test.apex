/**
 * Logic 3 ì„±ê³¼ ì¶”ì  ëŒ€ì‹œë³´ë“œ í…ŒìŠ¤íŠ¸
 * ëª©ì : ì‹¤ì‹œê°„ ì„±ê³¼ ì¶”ì  ì‹œìŠ¤í…œì´ ì •í™•í•˜ê²Œ ì‘ë™í•˜ëŠ”ì§€ ê²€ì¦
 */

System.debug('=== Logic 3 ì„±ê³¼ ì¶”ì  ëŒ€ì‹œë³´ë“œ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');

try {
    // 1ë‹¨ê³„: PerformanceTrackingService ë©”ì¸ ë©”ì†Œë“œ í…ŒìŠ¤íŠ¸
    System.debug('--- ëŒ€ì‹œë³´ë“œ ë°ì´í„° ì¡°íšŒ í…ŒìŠ¤íŠ¸ ---');
    
    PerformanceTrackingService.DashboardData dashboardData = 
        PerformanceTrackingService.getDashboardData();
    
    if(dashboardData != null) {
        System.debug('âœ… ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë”© ì„±ê³µ!');
        System.debug('ìµœì¢… ì—…ë°ì´íŠ¸: ' + dashboardData.lastUpdated);
        
        // 2ë‹¨ê³„: ì˜¤ëŠ˜ì˜ ì˜ˆìƒ ë§¤ì¶œ ê²€ì¦
        if(dashboardData.todayRevenue != null) {
            System.debug('--- ì˜¤ëŠ˜ì˜ ì˜ˆìƒ ë§¤ì¶œ ë°ì´í„° ---');
            System.debug('ğŸ’° ì˜ˆìƒ ë§¤ì¶œ: ' + dashboardData.todayRevenue.expectedAmount);
            System.debug('ğŸ¯ ëª©í‘œ ê¸ˆì•¡: ' + dashboardData.todayRevenue.targetAmount);
            System.debug('ğŸ“Š ë‹¬ì„±ë¥ : ' + dashboardData.todayRevenue.achievementRate + '%');
            System.debug('ğŸ‘¥ ìš°ì„ ìˆœìœ„ ê³ ê°: ' + dashboardData.todayRevenue.priorityCustomers + 'ëª…');
            System.debug('ğŸ“ˆ ìƒíƒœ: ' + dashboardData.todayRevenue.status);
        }
        
        // 3ë‹¨ê³„: ì›”ê°„ ê°±ì‹  í˜„í™© ê²€ì¦
        if(dashboardData.monthlyRenewal != null) {
            System.debug('--- ì´ë²ˆ ë‹¬ ê°±ì‹  í˜„í™© ---');
            System.debug('âœ… ì™„ë£Œëœ ê°±ì‹ : ' + dashboardData.monthlyRenewal.completedCount + 'ê±´');
            System.debug('ğŸ’° ì™„ë£Œ ê¸ˆì•¡: ' + dashboardData.monthlyRenewal.completedAmount);
            System.debug('ğŸ”„ ì§„í–‰ ì¤‘ ê°±ì‹ : ' + dashboardData.monthlyRenewal.inProgressCount + 'ê±´');
            System.debug('ğŸ’¸ ì§„í–‰ ì¤‘ ê¸ˆì•¡: ' + dashboardData.monthlyRenewal.inProgressAmount);
            System.debug('ğŸ¯ ì´ ì˜ˆìƒ ë§¤ì¶œ: ' + dashboardData.monthlyRenewal.totalExpectedAmount);
            System.debug('ğŸ“Š ì›” ëª©í‘œ: ' + dashboardData.monthlyRenewal.monthlyTarget);
        }
        
        // 4ë‹¨ê³„: ê³ ê° ê±´ê°•ë„ ë¶„í¬ ê²€ì¦
        if(dashboardData.customerHealth != null) {
            System.debug('--- ê³ ê° ê±´ê°•ë„ ë¶„í¬ ---');
            System.debug('ğŸŸ¢ ê±´ê°•í•œ ê³ ê°: ' + dashboardData.customerHealth.healthyCount + 'ëª… (' + 
                        dashboardData.customerHealth.healthyPercentage + '%)');
            System.debug('ğŸŸ¡ ì£¼ì˜ ê³ ê°: ' + dashboardData.customerHealth.warningCount + 'ëª… (' + 
                        dashboardData.customerHealth.warningPercentage + '%)');
            System.debug('ğŸ”´ ìœ„í—˜ ê³ ê°: ' + dashboardData.customerHealth.riskCount + 'ëª… (' + 
                        dashboardData.customerHealth.riskPercentage + '%)');
        }
        
        // 5ë‹¨ê³„: ì—…ë¬´ íš¨ìœ¨ì„± ì§€í‘œ ê²€ì¦
        if(dashboardData.efficiency != null) {
            System.debug('--- ì—…ë¬´ íš¨ìœ¨ì„± ì§€í‘œ ---');
            System.debug('âš¡ í‰ê·  ì²˜ë¦¬ ì‹œê°„: ' + dashboardData.efficiency.avgProcessingTime + 'ì´ˆ');
            System.debug('ğŸ“ˆ ì„±ê³µë¥ : ' + dashboardData.efficiency.successRate + '%');
            System.debug('ğŸ”¢ ì›”ê°„ ì²˜ë¦¬ ê±´ìˆ˜: ' + dashboardData.efficiency.monthlyProcessCount + 'ê±´');
            System.debug('â° ì‹œê°„ ì ˆì•½: ' + dashboardData.efficiency.timeReduction + 'ì´ˆ (Logic 2 íš¨ê³¼)');
        }
        
        // 6ë‹¨ê³„: ê²Œì„í™” ë°ì´í„° ê²€ì¦
        if(dashboardData.gamification != null) {
            System.debug('--- ê²Œì„í™” ì‹œìŠ¤í…œ ---');
            System.debug('ğŸ† í˜„ì¬ ë ˆë²¨: ' + dashboardData.gamification.currentLevel + ' ' + 
                        dashboardData.gamification.levelIcon);
            System.debug('ğŸ’° í˜„ì¬ ê¸ˆì•¡: ' + dashboardData.gamification.currentAmount);
            System.debug('ğŸ¯ ë‹¤ìŒ ë ˆë²¨ ëª©í‘œ: ' + dashboardData.gamification.nextLevelAmount);
            System.debug('ğŸ“Š ì§„í–‰ë¥ : ' + dashboardData.gamification.progressPercentage + '%');
            System.debug('ğŸ’¬ ê²©ë ¤ ë©”ì‹œì§€: ' + dashboardData.gamification.encouragementMessage);
        }
        
        // 7ë‹¨ê³„: ìŠ¤ë§ˆíŠ¸ ì•Œë¦¼ ê²€ì¦
        if(dashboardData.notifications != null && dashboardData.notifications.size() > 0) {
            System.debug('--- ìŠ¤ë§ˆíŠ¸ ì•Œë¦¼ (' + dashboardData.notifications.size() + 'ê±´) ---');
            
            for(PerformanceTrackingService.SmartNotification notification : dashboardData.notifications) {
                System.debug('ğŸ”” [' + notification.priority.toUpperCase() + '] ' + 
                           notification.title + ': ' + notification.message);
                System.debug('   íƒ€ì…: ' + notification.type + ', ì•„ì´ì½˜: ' + notification.icon);
            }
        } else {
            System.debug('ğŸ“¢ ìŠ¤ë§ˆíŠ¸ ì•Œë¦¼: ì—†ìŒ (ëª¨ë“  ì‘ì—… ì™„ë£Œ!)');
        }
        
        // 8ë‹¨ê³„: ëŒ€ì‹œë³´ë“œ ìƒˆë¡œê³ ì¹¨ í…ŒìŠ¤íŠ¸
        System.debug('--- ëŒ€ì‹œë³´ë“œ ìƒˆë¡œê³ ì¹¨ í…ŒìŠ¤íŠ¸ ---');
        String refreshResult = PerformanceTrackingService.refreshDashboard();
        System.debug('ìƒˆë¡œê³ ì¹¨ ê²°ê³¼: ' + refreshResult);
        
        // 9ë‹¨ê³„: ì„±ëŠ¥ ì¸¡ì •
        System.debug('--- ì„±ëŠ¥ ê²€ì¦ ---');
        DateTime startTime = DateTime.now();
        
        // 5ë²ˆ ì—°ì† í˜¸ì¶œë¡œ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
        for(Integer i = 0; i < 5; i++) {
            PerformanceTrackingService.getDashboardData();
        }
        
        DateTime endTime = DateTime.now();
        Long totalTime = endTime.getTime() - startTime.getTime();
        Long avgTime = totalTime / 5;
        
        System.debug('5íšŒ í˜¸ì¶œ ì´ ì‹œê°„: ' + totalTime + 'ms');
        System.debug('í‰ê·  ì‘ë‹µ ì‹œê°„: ' + avgTime + 'ms');
        
        if(avgTime <= 2000) {
            System.debug('âœ… ì„±ëŠ¥ ëª©í‘œ ë‹¬ì„±! (2ì´ˆ ì´ë‚´)');
        } else {
            System.debug('âš ï¸ ì„±ëŠ¥ ìµœì í™” í•„ìš” (2ì´ˆ ì´ˆê³¼)');
        }
        
        // 10ë‹¨ê³„: ì „ì²´ ê²°ê³¼ ìš”ì•½
        System.debug('=== Logic 3 í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½ ===');
        System.debug('âœ… ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë”©: ì„±ê³µ');
        System.debug('âœ… 4ê°œ í•µì‹¬ ë©”íŠ¸ë¦­: ëª¨ë‘ ì •ìƒ');
        System.debug('âœ… ê²Œì„í™” ì‹œìŠ¤í…œ: ì •ìƒ ì‘ë™');
        System.debug('âœ… ìŠ¤ë§ˆíŠ¸ ì•Œë¦¼: ì •ìƒ ìƒì„±');
        System.debug('âœ… ìƒˆë¡œê³ ì¹¨ ê¸°ëŠ¥: ì •ìƒ ì‘ë™');
        System.debug('âœ… ì„±ëŠ¥: ' + ((avgTime <= 2000) ? 'ëª©í‘œ ë‹¬ì„±' : 'ìµœì í™” í•„ìš”'));
        
    } else {
        System.debug('âŒ ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨');
    }
    
} catch(Exception e) {
    System.debug('âŒ Logic 3 í…ŒìŠ¤íŠ¸ ì¤‘ ì˜ˆì™¸ ë°œìƒ: ' + e.getMessage());
    System.debug('ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤: ' + e.getStackTraceString());
}

System.debug('=== Logic 3 ì„±ê³¼ ì¶”ì  ëŒ€ì‹œë³´ë“œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===');

// ì¶”ê°€ ê²€ì¦: Logic 1, 2, 3 í†µí•© í…ŒìŠ¤íŠ¸ ì•ˆë‚´
System.debug('');
System.debug('ğŸ¯ í†µí•© í…ŒìŠ¤íŠ¸ ê¶Œì¥ì‚¬í•­:');
System.debug('1. Logic 1 ìš°ì„ ìˆœìœ„ ê³„ì‚° â†’ Logic 3 ì˜¤ëŠ˜ì˜ ë§¤ì¶œì— ë°˜ì˜ í™•ì¸');
System.debug('2. Logic 2 ê°±ì‹  í”„ë¡œì„¸ìŠ¤ â†’ Logic 3 ì›”ê°„ í˜„í™©ì— ë°˜ì˜ í™•ì¸');
System.debug('3. ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸ â†’ 30ì´ˆ ìë™ ìƒˆë¡œê³ ì¹¨ í™•ì¸');
System.debug('4. ê²Œì„í™” ìš”ì†Œ â†’ ì‚¬ìš©ì ë™ê¸°ë¶€ì—¬ íš¨ê³¼ ì¸¡ì •');
System.debug('5. ìŠ¤ë§ˆíŠ¸ ì•Œë¦¼ â†’ ì•¡ì…˜ ê°€ëŠ¥í•œ ì¸ì‚¬ì´íŠ¸ ì œê³µ í™•ì¸');
