/**
 * ì „ì²´ Assets ë¡œì§ í†µí•© í…ŒìŠ¤íŠ¸ (Logic 1 + 2 + 3)
 * ëª©ì : 3ê°œ ë¡œì§ì´ ì„œë¡œ ì—°ê²°ë˜ì–´ ì™„ì „í•œ ì‹œìŠ¤í…œìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ ê²€ì¦
 */

System.debug('ğŸš€ === Assets ë¡œì§ í†µí•© í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
System.debug('í…ŒìŠ¤íŠ¸ ë²”ìœ„: Logic 1(ìš°ì„ ìˆœìœ„) â†’ Logic 2(ì›í´ë¦­ ê°±ì‹ ) â†’ Logic 3(ì„±ê³¼ ì¶”ì )');
System.debug('');

DateTime integrationTestStart = DateTime.now();

try {
    // ===========================================
    // PHASE 1: Logic 1 ìš°ì„ ìˆœìœ„ ê³„ì‚° í…ŒìŠ¤íŠ¸
    // ===========================================
    System.debug('ğŸ“Š PHASE 1: Logic 1 ìš°ì„ ìˆœìœ„ ê³„ì‚° ì‹œìŠ¤í…œ');
    
    // ìš°ì„ ìˆœìœ„ ë†’ì€ ìì‚° ì¡°íšŒ (Logic 1 ê²°ê³¼)
    List<Asset> priorityAssets = [
        SELECT Id, Name, AccountId, Account.Name, Price, Quantity, 
               UsageEndDate, Priority_Score__c, Contract_Status__c
        FROM Asset 
        WHERE Priority_Score__c >= 60 
        AND Contract_Status__c = 'Active'
        ORDER BY Priority_Score__c DESC
        LIMIT 5
    ];
    
    System.debug('âœ… Logic 1 ê²°ê³¼: ìš°ì„ ìˆœìœ„ ìì‚° ' + priorityAssets.size() + 'ê°œ ë°œê²¬');
    
    for(Integer i = 0; i < priorityAssets.size(); i++) {
        Asset asset = priorityAssets[i];
        System.debug('  ' + (i+1) + '. ' + asset.Account.Name + ' - ' + asset.Name + 
                    ' (ì ìˆ˜: ' + asset.Priority_Score__c + ')');
    }
    
    if(priorityAssets.isEmpty()) {
        System.debug('âš ï¸ ê²½ê³ : ìš°ì„ ìˆœìœ„ ìì‚°ì´ ì—†ìŠµë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ë¨¼ì € ìƒì„±í•˜ì„¸ìš”.');
        return;
    }
    
    // ===========================================
    // PHASE 2: Logic 2 ì›í´ë¦­ ê°±ì‹  í…ŒìŠ¤íŠ¸
    // ===========================================
    System.debug('');
    System.debug('âš¡ PHASE 2: Logic 2 ì›í´ë¦­ ê°±ì‹  ì›Œí¬í”Œë¡œìš°');
    
    Integer renewalSuccessCount = 0;
    List<Id> processedAssetIds = new List<Id>();
    
    // ìƒìœ„ 3ê°œ ìš°ì„ ìˆœìœ„ ìì‚°ì— ëŒ€í•´ ì›í´ë¦­ ê°±ì‹  ì‹¤í–‰
    for(Integer i = 0; i < Math.min(3, priorityAssets.size()); i++) {
        Asset asset = priorityAssets[i];
        
        try {
            System.debug('ê°±ì‹  ì²˜ë¦¬ ì¤‘: ' + asset.Name);
            
            // OneClickRenewalService í˜¸ì¶œ (Logic 2)
            OneClickRenewalService.RenewalResult renewalResult = 
                OneClickRenewalService.startRenewalProcess(asset.Id);
            
            if(renewalResult.success) {
                renewalSuccessCount++;
                processedAssetIds.add(asset.Id);
                System.debug('  âœ… ê°±ì‹  ì„±ê³µ - Opportunity: ' + renewalResult.opportunityId + 
                           ', Task: ' + renewalResult.taskId);
            } else {
                System.debug('  âŒ ê°±ì‹  ì‹¤íŒ¨: ' + renewalResult.message);
            }
            
        } catch(Exception e) {
            System.debug('  âŒ ì˜ˆì™¸ ë°œìƒ: ' + e.getMessage());
        }
    }
    
    System.debug('âœ… Logic 2 ê²°ê³¼: ' + renewalSuccessCount + '/' + Math.min(3, priorityAssets.size()) + 
                ' ìì‚° ê°±ì‹  ì„±ê³µ');
    
    // ===========================================
    // PHASE 3: Logic 3 ì„±ê³¼ ì¶”ì  í…ŒìŠ¤íŠ¸
    // ===========================================
    System.debug('');
    System.debug('ğŸ“ˆ PHASE 3: Logic 3 ì„±ê³¼ ì¶”ì  ëŒ€ì‹œë³´ë“œ');
    
    // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ì¡°íšŒ (Logic 3)
    PerformanceTrackingService.DashboardData dashboardData = 
        PerformanceTrackingService.getDashboardData();
    
    if(dashboardData != null) {
        System.debug('âœ… Logic 3 ê²°ê³¼: ì„±ê³¼ ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë”© ì„±ê³µ');
        
        // í•µì‹¬ ì§€í‘œ ìš”ì•½
        System.debug('  ğŸ“Š ì˜¤ëŠ˜ ì˜ˆìƒ ë§¤ì¶œ: ' + dashboardData.todayRevenue.expectedAmount + 
                    ' (ë‹¬ì„±ë¥ : ' + dashboardData.todayRevenue.achievementRate + '%)');
        System.debug('  ğŸ¯ ì›”ê°„ ê°±ì‹ : ì™„ë£Œ ' + dashboardData.monthlyRenewal.completedCount + 'ê±´, ' +
                    'ì§„í–‰ ' + dashboardData.monthlyRenewal.inProgressCount + 'ê±´');
        System.debug('  ğŸ¥ ê³ ê° ê±´ê°•ë„: ğŸŸ¢' + dashboardData.customerHealth.healthyCount + 
                    ' ğŸŸ¡' + dashboardData.customerHealth.warningCount + 
                    ' ğŸ”´' + dashboardData.customerHealth.riskCount);
        System.debug('  âš¡ íš¨ìœ¨ì„±: ì„±ê³µë¥  ' + dashboardData.efficiency.successRate + 
                    '%, ì²˜ë¦¬ ' + dashboardData.efficiency.monthlyProcessCount + 'ê±´');
        System.debug('  ğŸ† ê²Œì„í™”: ' + dashboardData.gamification.currentLevel + ' ' +
                    dashboardData.gamification.levelIcon + ' (' + 
                    dashboardData.gamification.progressPercentage + '%)');
        System.debug('  ğŸ”” ì•Œë¦¼: ' + dashboardData.notifications.size() + 'ê±´');
        
    } else {
        System.debug('âŒ Logic 3 ì‹¤íŒ¨: ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë”© ì˜¤ë¥˜');
    }
    
    // ===========================================
    // PHASE 4: ë¡œì§ ê°„ ì—°ê²°ì„± ê²€ì¦
    // ===========================================
    System.debug('');
    System.debug('ğŸ”— PHASE 4: ë¡œì§ ê°„ ì—°ê²°ì„± ê²€ì¦');
    
    // 4-1: Logic 1 â†’ Logic 2 ì—°ê²° í™•ì¸
    System.debug('ê²€ì¦ 1: Logic 1 ìš°ì„ ìˆœìœ„ â†’ Logic 2 ê°±ì‹  ì—°ê²°');
    if(renewalSuccessCount > 0) {
        System.debug('  âœ… ì—°ê²° ì„±ê³µ: ìš°ì„ ìˆœìœ„ ìì‚°ì´ ê°±ì‹  í”„ë¡œì„¸ìŠ¤ë¡œ ì •ìƒ ì „ë‹¬ë¨');
    } else {
        System.debug('  âš ï¸ ì—°ê²° í™•ì¸ í•„ìš”: ìš°ì„ ìˆœìœ„ ìì‚°ì˜ ê°±ì‹  ì²˜ë¦¬ ì‹¤íŒ¨');
    }
    
    // 4-2: Logic 2 â†’ Logic 3 ì—°ê²° í™•ì¸
    System.debug('ê²€ì¦ 2: Logic 2 ê°±ì‹  â†’ Logic 3 ì„±ê³¼ì¶”ì  ì—°ê²°');
    if(dashboardData != null && dashboardData.monthlyRenewal.inProgressCount > 0) {
        System.debug('  âœ… ì—°ê²° ì„±ê³µ: ê°±ì‹  í”„ë¡œì„¸ìŠ¤ê°€ ì„±ê³¼ ì¶”ì ì— ë°˜ì˜ë¨');
    } else {
        System.debug('  âš ï¸ ì—°ê²° í™•ì¸ í•„ìš”: ê°±ì‹  ê²°ê³¼ê°€ ì„±ê³¼ ì¶”ì ì— ë¯¸ë°˜ì˜');
    }
    
    // 4-3: Logic 1 + Logic 3 ì—°ê²° í™•ì¸
    System.debug('ê²€ì¦ 3: Logic 1 ìš°ì„ ìˆœìœ„ â†’ Logic 3 ì˜ˆìƒë§¤ì¶œ ì—°ê²°');
    if(dashboardData != null && dashboardData.todayRevenue.priorityCustomers > 0) {
        System.debug('  âœ… ì—°ê²° ì„±ê³µ: ìš°ì„ ìˆœìœ„ ê³ ê°ì´ ì˜ˆìƒ ë§¤ì¶œ ê³„ì‚°ì— ë°˜ì˜ë¨');
    } else {
        System.debug('  âš ï¸ ì—°ê²° í™•ì¸ í•„ìš”: ìš°ì„ ìˆœìœ„ ê³„ì‚°ì´ ì˜ˆìƒ ë§¤ì¶œì— ë¯¸ë°˜ì˜');
    }
    
    // ===========================================
    // PHASE 5: ì „ì²´ ì‹œìŠ¤í…œ ì„±ëŠ¥ ì¸¡ì •
    // ===========================================
    System.debug('');
    System.debug('â±ï¸ PHASE 5: ì „ì²´ ì‹œìŠ¤í…œ ì„±ëŠ¥ ì¸¡ì •');
    
    DateTime integrationTestEnd = DateTime.now();
    Long totalIntegrationTime = integrationTestEnd.getTime() - integrationTestStart.getTime();
    
    System.debug('ì „ì²´ í†µí•© í…ŒìŠ¤íŠ¸ ì‹œê°„: ' + totalIntegrationTime + 'ms');
    
    // ê°œë³„ ë¡œì§ ì„±ëŠ¥ ëª©í‘œ
    // Logic 1: 3ì´ˆ ì´ë‚´ (ë³µì¡í•œ ìš°ì„ ìˆœìœ„ ê³„ì‚°)
    // Logic 2: 5ì´ˆ ì´ë‚´ (ì›í´ë¦­ ê°±ì‹  í”„ë¡œì„¸ìŠ¤)
    // Logic 3: 2ì´ˆ ì´ë‚´ (ëŒ€ì‹œë³´ë“œ ë¡œë”©)
    // ì „ì²´: 10ì´ˆ ì´ë‚´ (í†µí•© ì›Œí¬í”Œë¡œìš°)
    
    if(totalIntegrationTime <= 10000) {
        System.debug('âœ… ì „ì²´ ì„±ëŠ¥ ëª©í‘œ ë‹¬ì„±! (10ì´ˆ ì´ë‚´)');
    } else {
        System.debug('âš ï¸ ì „ì²´ ì„±ëŠ¥ ìµœì í™” í•„ìš” (10ì´ˆ ì´ˆê³¼)');
    }
    
    // ===========================================
    // PHASE 6: ìµœì¢… ê²°ê³¼ ìš”ì•½
    // ===========================================
    System.debug('');
    System.debug('ğŸ¯ === í†µí•© í…ŒìŠ¤íŠ¸ ìµœì¢… ê²°ê³¼ ===');
    
    // ì„±ê³µ ì§€í‘œ ê³„ì‚°
    Integer totalChecks = 6; // ê²€ì¦í•  í•­ëª© ìˆ˜
    Integer passedChecks = 0;
    
    // 1. Logic 1 ì‘ë™ ì—¬ë¶€
    if(priorityAssets.size() > 0) passedChecks++;
    
    // 2. Logic 2 ì‘ë™ ì—¬ë¶€  
    if(renewalSuccessCount > 0) passedChecks++;
    
    // 3. Logic 3 ì‘ë™ ì—¬ë¶€
    if(dashboardData != null) passedChecks++;
    
    // 4. Logic 1â†’2 ì—°ê²°
    if(renewalSuccessCount > 0) passedChecks++;
    
    // 5. Logic 2â†’3 ì—°ê²°
    if(dashboardData != null && dashboardData.monthlyRenewal != null) passedChecks++;
    
    // 6. ì „ì²´ ì„±ëŠ¥
    if(totalIntegrationTime <= 10000) passedChecks++;
    
    Decimal successRate = (Decimal)passedChecks / totalChecks * 100;
    
    System.debug('ğŸ“Š í†µí•© í…ŒìŠ¤íŠ¸ ì„±ê³µë¥ : ' + passedChecks + '/' + totalChecks + 
                ' (' + successRate.intValue() + '%)');
    
    if(successRate >= 100) {
        System.debug('ğŸ‰ ì™„ë²½í•œ í†µí•©! ëª¨ë“  ë¡œì§ì´ ì—°ê²°ë˜ì–´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.');
    } else if(successRate >= 80) {
        System.debug('âœ… ì–‘í˜¸í•œ í†µí•©! ëŒ€ë¶€ë¶„ì˜ ë¡œì§ì´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.');
    } else if(successRate >= 60) {
        System.debug('âš ï¸ ë¶€ë¶„ í†µí•©! ì¼ë¶€ ë¡œì§ì—ì„œ ë¬¸ì œê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
    } else {
        System.debug('âŒ í†µí•© ì‹¤íŒ¨! ë¡œì§ ê°„ ì—°ê²°ì— ì‹¬ê°í•œ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.');
    }
    
    // ì‚¬ìš©ì ê°€ì¹˜ ìš”ì•½
    System.debug('');
    System.debug('ğŸ’¼ === ë¹„ì¦ˆë‹ˆìŠ¤ ê°€ì¹˜ ë‹¬ì„±ë„ ===');
    System.debug('ğŸ¯ ëª©í‘œ 1: ìš°ì„ ìˆœìœ„ ìë™ ë¶„ë¥˜ â†’ ' + (priorityAssets.size() > 0 ? 'âœ… ë‹¬ì„±' : 'âŒ ë¯¸ë‹¬ì„±'));
    System.debug('âš¡ ëª©í‘œ 2: 20ë¶„â†’5ì´ˆ ê°±ì‹  í”„ë¡œì„¸ìŠ¤ â†’ ' + (renewalSuccessCount > 0 ? 'âœ… ë‹¬ì„±' : 'âŒ ë¯¸ë‹¬ì„±'));
    System.debug('ğŸ“ˆ ëª©í‘œ 3: ì‹¤ì‹œê°„ ì„±ê³¼ ì¶”ì  â†’ ' + (dashboardData != null ? 'âœ… ë‹¬ì„±' : 'âŒ ë¯¸ë‹¬ì„±'));
    System.debug('ğŸ® ëª©í‘œ 4: ê²Œì„í™” ë™ê¸°ë¶€ì—¬ â†’ ' + 
                (dashboardData != null && dashboardData.gamification != null ? 'âœ… ë‹¬ì„±' : 'âŒ ë¯¸ë‹¬ì„±'));
    
} catch(Exception e) {
    System.debug('âŒ í†µí•© í…ŒìŠ¤íŠ¸ ì¤‘ ì˜ˆì™¸ ë°œìƒ: ' + e.getMessage());
    System.debug('ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤: ' + e.getStackTraceString());
}

System.debug('');
System.debug('ğŸš€ === Assets ë¡œì§ í†µí•© í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===');
System.debug('âœ¨ ì˜ì—…ì‚¬ì›ì„ ìœ„í•œ ì™„ì „í•œ Assets ê´€ë¦¬ ì‹œìŠ¤í…œ ì¤€ë¹„ë¨!');
