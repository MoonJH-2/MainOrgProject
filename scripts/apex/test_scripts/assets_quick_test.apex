/**
 * ê°„ë‹¨í•œ Assets í™œìš© í…ŒìŠ¤íŠ¸
 * Order 00000153 ê¸°ë°˜ í•µì‹¬ ê¸°ëŠ¥ë§Œ ì‹œì—°
 */

System.debug('=== ê°„ë‹¨ Assets í™œìš© í…ŒìŠ¤íŠ¸ ===');

// Order ì¡°íšŒ
List<Order> orders = [
    SELECT Id, OrderNumber, AccountId, Account.Name, Status, TotalAmount
    FROM Order 
    WHERE OrderNumber = '00000153'
    LIMIT 1
];

if (orders.isEmpty()) {
    System.debug('âŒ Order 00000153ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    return;
}

Order testOrder = orders[0];
System.debug('âœ… Order ì •ë³´: ' + testOrder.OrderNumber + ' - ' + testOrder.Account.Name);

// ì—°ê²°ëœ Asset ì¡°íšŒ
List<Asset> assets = [
    SELECT Id, Name, Status, SerialNumber, AccountId
    FROM Asset 
    WHERE SerialNumber = :testOrder.OrderNumber
    OR Name LIKE '%' + testOrder.OrderNumber + '%'
];

System.debug('ğŸ­ ì—°ê²°ëœ Assets: ' + assets.size() + 'ê°œ');
for (Asset asset : assets) {
    System.debug('  - ' + asset.Name + ' (' + asset.Status + ')');
}

// PaymentStatus í™•ì¸
List<PaymentStatus__c> payments = [
    SELECT Id, Status__c, Amount__c
    FROM PaymentStatus__c 
    WHERE Order__c = :testOrder.Id
];

System.debug('ğŸ’³ Payment Status: ' + payments.size() + 'ê±´');
Integer completedPayments = 0;
for (PaymentStatus__c payment : payments) {
    System.debug('  - Status: ' + payment.Status__c + ', Amount: ' + payment.Amount__c);
    if (payment.Status__c == 'ì™„ë‚©') {
        completedPayments++;
    }
}

// ê°±ì‹  ê¸°íšŒ ë¶„ì„
Decimal renewalScore = 50; // ê¸°ë³¸ 50%
if (completedPayments == payments.size() && payments.size() > 0) {
    renewalScore += 30;
    System.debug('âœ… ì™„ë²½í•œ ê²°ì œ ì´ë ¥: +30%');
}

if (assets.size() > 0) {
    renewalScore += 20;
    System.debug('âœ… Asset ë³´ìœ : +20%');
}

System.debug('ğŸ¯ ê°±ì‹  ê°€ëŠ¥ì„±: ' + renewalScore + '%');

if (renewalScore >= 80) {
    System.debug('ğŸŸ¢ HIGH: ì ê·¹ì  ê°±ì‹  ì œì•ˆ ê¶Œì¥');
} else if (renewalScore >= 60) {
    System.debug('ğŸŸ¡ MEDIUM: ê´€ê³„ ê°•í™” í•„ìš”');
} else {
    System.debug('ğŸ”´ LOW: ìœ„í—˜ ê³ ê° ê´€ë¦¬');
}

System.debug('');
System.debug('âœ… Assets ê¸°ë°˜ ê³ ê° ë¶„ì„ ì™„ë£Œ!');
System.debug('ğŸ’¡ ' + testOrder.Account.Name + 'ëŠ” ' + renewalScore + '% í™•ë¥ ë¡œ ê°±ì‹  ì˜ˆìƒë©ë‹ˆë‹¤.');
