/**
 * Asset ë¡œì§ ë‹¨ê³„ë³„ ì‹¤í–‰ ì‹œì—°
 * ê° ë‹¨ê³„ì˜ ì‹¤ì œ ë™ì‘ì„ ë³´ì—¬ì£¼ëŠ” ì‹œë®¬ë ˆì´ì…˜
 */

System.debug('=== Asset ë¡œì§ ë‹¨ê³„ë³„ ì‹¤í–‰ ì‹œì—° ===');
System.debug('');

// í…ŒìŠ¤íŠ¸ìš© Order ì„ íƒ
List<Order> testOrders = [
    SELECT Id, OrderNumber, AccountId, Account.Name, Account.Industry,
           Account.NumberOfEmployees, Account.AnnualRevenue, Account.Key_Account__c,
           Account.CustomerPriority__c, TotalAmount, EffectiveDate
    FROM Order 
    WHERE AccountId != null
    LIMIT 1
];

if (testOrders.isEmpty()) {
    System.debug('í…ŒìŠ¤íŠ¸ìš© Orderê°€ ì—†ìŠµë‹ˆë‹¤.');
    return;
}

Order testOrder = testOrders[0];
System.debug('ğŸ¯ ì„ íƒëœ Order: ' + testOrder.OrderNumber + ' (' + testOrder.Account.Name + ')');
System.debug('');

// ============================================
// 1ë‹¨ê³„: PaymentStatus ì™„ë‚© ê°ì§€ ì‹œë®¬ë ˆì´ì…˜
// ============================================
System.debug('ğŸ“ 1ë‹¨ê³„: PaymentStatus ì™„ë‚© ê°ì§€');
System.debug('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

List<PaymentStatus__c> payments = [
    SELECT Status__c, InstallmentNumber__c, Amount__c
    FROM PaymentStatus__c 
    WHERE Order__c = :testOrder.Id
    ORDER BY InstallmentNumber__c
];

if (payments.isEmpty()) {
    System.debug('âš ï¸ PaymentStatusê°€ ì—†ìŠµë‹ˆë‹¤. ì‹œë®¬ë ˆì´ì…˜ì„ ìœ„í•´ ìƒì„± í•„ìš”');
} else {
    System.debug('ğŸ’³ í˜„ì¬ PaymentStatus ìƒíƒœ:');
    for (PaymentStatus__c payment : payments) {
        System.debug('  ' + payment.InstallmentNumber__c + 'ì°¨: ' + payment.Status__c + 
                    ' (' + (payment.Amount__c != null ? payment.Amount__c.format() : '0') + 'ì›)');
    }
}
System.debug('ğŸ” íŠ¸ë¦¬ê±° ì¡°ê±´: Status__cê°€ "ì™„ë‚©"ìœ¼ë¡œ ë³€ê²½ëœ ê²½ìš°');
System.debug('');

// ============================================
// 2ë‹¨ê³„: ì™„ë‚© ìƒíƒœ ê²€ì¦
// ============================================
System.debug('ğŸ“ 2ë‹¨ê³„: ì™„ë‚© ìƒíƒœ ê²€ì¦');
System.debug('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

Boolean isFullyPaid = true;
Integer totalPayments = payments.size();
Integer completedPayments = 0;

for (PaymentStatus__c payment : payments) {
    if (payment.Status__c == 'ì™„ë‚©') {
        completedPayments++;
    } else {
        isFullyPaid = false;
    }
}

System.debug('ğŸ“Š ë‚©ë¶€ í†µê³„:');
System.debug('  - ì´ ë‚©ë¶€ íšŒì°¨: ' + totalPayments);
System.debug('  - ì™„ë£Œëœ íšŒì°¨: ' + completedPayments);
System.debug('  - ì™„ë‚© ì—¬ë¶€: ' + isFullyPaid);
System.debug('âœ… ê²€ì¦ ê²°ê³¼: ' + (isFullyPaid ? 'Asset ìƒì„± ê°€ëŠ¥' : 'ë‚©ë¶€ ë¯¸ì™„ë£Œ'));
System.debug('');

// ============================================
// 3ë‹¨ê³„: Account ì¸í…”ë¦¬ì „ìŠ¤ ë¶„ì„
// ============================================
System.debug('ğŸ“ 3ë‹¨ê³„: Account ì¸í…”ë¦¬ì „ìŠ¤ ë¶„ì„');
System.debug('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

System.debug('ğŸ¢ Account ê¸°ë³¸ ì •ë³´:');
System.debug('  - íšŒì‚¬ëª…: ' + testOrder.Account.Name);
System.debug('  - ì‚°ì—…êµ°: ' + (testOrder.Account.Industry ?? 'ë¯¸ë¶„ë¥˜'));
System.debug('  - ì§ì› ìˆ˜: ' + (testOrder.Account.NumberOfEmployees != null ? testOrder.Account.NumberOfEmployees.format() : 'ë¯¸í™•ì¸') + 'ëª…');
System.debug('  - ì—°ë§¤ì¶œ: ' + (testOrder.Account.AnnualRevenue != null ? testOrder.Account.AnnualRevenue.format() : 'ë¯¸í™•ì¸') + 'ì›');
System.debug('  - Key Account: ' + (testOrder.Account.Key_Account__c ? 'Yes' : 'No'));
System.debug('  - ê³ ê° ìš°ì„ ìˆœìœ„: ' + (testOrder.Account.CustomerPriority__c ?? 'ì¼ë°˜'));
System.debug('');

// ============================================
// 4ë‹¨ê³„: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ì ìš©
// ============================================
System.debug('ğŸ“ 4ë‹¨ê³„: ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ì ìš©');
System.debug('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

Integer lifecycleMonths = 12; // ê¸°ë³¸ê°’
String companySize = 'ì¤‘ì†Œê¸°ì—…';

// ê¸°ì—… ê·œëª¨ë³„ ë¶„ë¥˜
if (testOrder.Account.NumberOfEmployees != null) {
    if (testOrder.Account.NumberOfEmployees >= 1000) {
        lifecycleMonths = 36;
        companySize = 'ëŒ€ê¸°ì—…';
        System.debug('ğŸ¢ ê¸°ì—… ê·œëª¨: ëŒ€ê¸°ì—… (1000ëª…+) â†’ 36ê°œì›” ê¸°ë³¸ Lifecycle');
    } else if (testOrder.Account.NumberOfEmployees >= 100) {
        lifecycleMonths = 24;
        companySize = 'ì¤‘ê²¬ê¸°ì—…';
        System.debug('ğŸ¢ ê¸°ì—… ê·œëª¨: ì¤‘ê²¬ê¸°ì—… (100-999ëª…) â†’ 24ê°œì›” ê¸°ë³¸ Lifecycle');
    } else {
        lifecycleMonths = 12;
        companySize = 'ì¤‘ì†Œê¸°ì—…';
        System.debug('ğŸ¢ ê¸°ì—… ê·œëª¨: ì¤‘ì†Œê¸°ì—… (~99ëª…) â†’ 12ê°œì›” ê¸°ë³¸ Lifecycle');
    }
}

// Key Account ë³´ë„ˆìŠ¤
if (testOrder.Account.Key_Account__c) {
    lifecycleMonths += 12;
    System.debug('ğŸŒŸ Key Account ë³´ë„ˆìŠ¤: +12ê°œì›” ì—°ì¥');
}

// ê³ ë§¤ì¶œ ë³´ë„ˆìŠ¤
if (testOrder.Account.AnnualRevenue != null && testOrder.Account.AnnualRevenue >= 100000000) {
    lifecycleMonths += 6;
    System.debug('ğŸ’° ê³ ë§¤ì¶œ ê¸°ì—… ë³´ë„ˆìŠ¤: +6ê°œì›” ì—°ì¥');
}

System.debug('â° ìµœì¢… Lifecycle: ' + lifecycleMonths + 'ê°œì›”');
System.debug('');

// ============================================
// 5ë‹¨ê³„: Industryë³„ ë§ì¶¤ ì „ëµ
// ============================================
System.debug('ğŸ“ 5ë‹¨ê³„: Industryë³„ ë§ì¶¤ ì „ëµ');
System.debug('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

List<String> industryInsights = new List<String>();
String industry = testOrder.Account.Industry;

if (String.isNotBlank(industry)) {
    System.debug('ğŸ¯ ' + industry + ' ì—…ê³„ ë§ì¶¤ ì „ëµ:');
    
    switch on industry {
        when 'Technology' {
            industryInsights.add('ìµœì‹  ê¸°ìˆ  íŠ¸ë Œë“œ ë° í˜ì‹  ì†”ë£¨ì…˜ ì œì•ˆ');
            industryInsights.add('ë¹ ë¥¸ ê¸°ìˆ  ë„ì… ì„±í–¥ìœ¼ë¡œ ì¡°ê¸° ê°±ì‹  ê°€ëŠ¥ì„± ë†’ìŒ');
        }
        when 'Manufacturing' {
            industryInsights.add('ìƒì‚°ì„± í–¥ìƒ ë° ë¹„ìš© ì ˆê° íš¨ê³¼ ê°•ì¡°');
            industryInsights.add('ì¥ê¸° ê³„ì•½ ì„ í˜¸í•˜ëŠ” ì—…ê³„ íŠ¹ì„± í™œìš©');
        }
        when 'Healthcare' {
            industryInsights.add('ê·œì œ ì¤€ìˆ˜ ë° ë³´ì•ˆ ê°•í™” ì†”ë£¨ì…˜ ì¤‘ì ');
            industryInsights.add('ì•ˆì •ì„±ê³¼ ì‹ ë¢°ì„± ìš°ì„  ê³ ë ¤');
        }
        when 'Financial Services' {
            industryInsights.add('ë³´ì•ˆ ë° ì»´í”Œë¼ì´ì–¸ìŠ¤ ìµœìš°ì„ ');
            industryInsights.add('ê³ ê°€ìš©ì„± ì†”ë£¨ì…˜ ìš”êµ¬ì‚¬í•­ ë°˜ì˜');
        }
        when else {
            industryInsights.add('ì¼ë°˜ì ì¸ ë¹„ì¦ˆë‹ˆìŠ¤ ì†”ë£¨ì…˜ ì ‘ê·¼');
            industryInsights.add('ì—…ê³„ íŠ¹ì„± íŒŒì•… í›„ ë§ì¶¤ ì „ëµ ìˆ˜ë¦½');
        }
    }
    
    for (String insight : industryInsights) {
        System.debug('  â€¢ ' + insight);
    }
} else {
    System.debug('âš ï¸ Industry ì •ë³´ ì—†ìŒ - ì¼ë°˜ ì „ëµ ì ìš©');
}
System.debug('');

// ============================================
// 6ë‹¨ê³„: Asset ì„¤ê³„
// ============================================
System.debug('ğŸ“ 6ë‹¨ê³„: Asset ì„¤ê³„');
System.debug('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

// Asset ì´ë¦„ êµ¬ì„±
List<String> nameParts = new List<String>();
nameParts.add(testOrder.Account.Name);
nameParts.add('[' + companySize + ']');

if (testOrder.Account.Key_Account__c) {
    nameParts.add('(Key Account)');
}

if (String.isNotBlank(industry)) {
    nameParts.add('[' + industry + ']');
}

String finalAssetName = String.join(nameParts, ' ') + ' - ' + testOrder.OrderNumber;

System.debug('ğŸ·ï¸ Asset ì„¤ê³„ ì •ë³´:');
System.debug('  - Asset ì´ë¦„: ' + finalAssetName);
System.debug('  - Serial Number: ' + testOrder.OrderNumber);
System.debug('  - ìƒíƒœ: Installed');
System.debug('  - êµ¬ë§¤ì¼: ' + (testOrder.EffectiveDate != null ? testOrder.EffectiveDate.format() : Date.today().format()));
System.debug('  - ì„¤ì¹˜ì¼: ' + Date.today().format());
System.debug('');

// ============================================
// 7ë‹¨ê³„: ìƒì„¸ Description ìƒì„±
// ============================================
System.debug('ğŸ“ 7ë‹¨ê³„: ìƒì„¸ Description ìƒì„±');
System.debug('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

List<String> descriptionParts = new List<String>();

descriptionParts.add('=== Order ì •ë³´ ===');
descriptionParts.add('Order Number: ' + testOrder.OrderNumber);
descriptionParts.add('ì´ ê¸ˆì•¡: ' + (testOrder.TotalAmount != null ? testOrder.TotalAmount.format() : '0') + 'ì›');

descriptionParts.add('=== Account ë¶„ì„ ===');
descriptionParts.add('ì‚°ì—…êµ°: ' + (industry ?? 'ë¯¸ë¶„ë¥˜'));
descriptionParts.add('ê¸°ì—…ê·œëª¨: ' + companySize);
descriptionParts.add('ì˜ˆìƒ Lifecycle: ' + lifecycleMonths + 'ê°œì›”');

if (!industryInsights.isEmpty()) {
    descriptionParts.add('=== ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì‚¬ì´íŠ¸ ===');
    for (String insight : industryInsights) {
        descriptionParts.add('â€¢ ' + insight);
    }
}

String finalDescription = String.join(descriptionParts, '\n');
System.debug('ğŸ“ Asset Description ë¯¸ë¦¬ë³´ê¸°:');
System.debug(finalDescription);
System.debug('');

// ============================================
// 8ë‹¨ê³„: í›„ì† ì•¡ì…˜ ê³„íš
// ============================================
System.debug('ğŸ“ 8ë‹¨ê³„: í›„ì† ì•¡ì…˜ ê³„íš');
System.debug('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

List<String> plannedTasks = new List<String>();

// Account Manager Task
System.debug('ğŸ“‹ ìƒì„±ë  Task ëª©ë¡:');

// Key Account íŠ¹ë³„ ê´€ë¦¬
if (testOrder.Account.Key_Account__c) {
    plannedTasks.add('[Key Account] VIP ê³ ê° íŠ¹ë³„ ê´€ë¦¬ - 1ì¼ í›„, ë†’ì€ ìš°ì„ ìˆœìœ„');
}

// ê³ ìš°ì„ ìˆœìœ„ ê³ ê°
if (testOrder.Account.CustomerPriority__c == 'High') {
    plannedTasks.add('[ê³ ìš°ì„ ìˆœìœ„] ì¦‰ì‹œ ëŒ€ì‘ í•„ìš” - ë‹¹ì¼, ë†’ì€ ìš°ì„ ìˆœìœ„');
}

// ê¸°ë³¸ ê°±ì‹  ê´€ë¦¬ Task
plannedTasks.add('[Asset ê´€ë¦¬] ì •ê¸° ì ê²€ ë° ê°±ì‹  ì¤€ë¹„ - 7ì¼ í›„, ë³´í†µ ìš°ì„ ìˆœìœ„');

for (String task : plannedTasks) {
    System.debug('  â€¢ ' + task);
}

if (plannedTasks.isEmpty()) {
    System.debug('  â€¢ ê¸°ë³¸ Asset ê´€ë¦¬ Taskë§Œ ìƒì„±ë©ë‹ˆë‹¤.');
}
System.debug('');

// ============================================
// 9ë‹¨ê³„: UI ë„¤ë¹„ê²Œì´ì…˜ ì§€ì›
// ============================================
System.debug('ğŸ“ 9ë‹¨ê³„: UI ë„¤ë¹„ê²Œì´ì…˜ ì§€ì›');
System.debug('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

System.debug('ğŸ–¥ï¸ Order í™”ë©´ì— í‘œì‹œë  ì •ë³´:');
System.debug('  - ë‚©ë¶€ ì§„í–‰ë¥ : ' + (totalPayments > 0 ? (completedPayments * 100 / totalPayments) : 0) + '%');
System.debug('  - ì™„ë£Œ íšŒì°¨: ' + completedPayments + '/' + totalPayments);
System.debug('  - Asset ìƒíƒœ: ' + (isFullyPaid ? 'Asset ìƒì„± ê°€ëŠ¥/ì™„ë£Œ' : 'ë‚©ë¶€ ì§„í–‰ ì¤‘'));
System.debug('  - ë„¤ë¹„ê²Œì´ì…˜: ' + (isFullyPaid ? 'Asset ë³´ê¸° ë²„íŠ¼ í‘œì‹œ' : 'ì§„í–‰ë¥  ë°” í‘œì‹œ'));
System.debug('');

// ============================================
// ì‹œìŠ¤í…œ íë¦„ ìš”ì•½
// ============================================
System.debug('ğŸ“ ì „ì²´ ì‹œìŠ¤í…œ íë¦„ ìš”ì•½');
System.debug('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');

System.debug('');
System.debug('ğŸ”„ PaymentStatus ì™„ë‚© â†’ Account ë¶„ì„ â†’ Asset ìƒì„± â†’ í›„ì† ê´€ë¦¬');
System.debug('   â†“');
System.debug('1ï¸âƒ£ íŠ¸ë¦¬ê±° ìë™ ê°ì§€ (PaymentStatus__c)');
System.debug('   â†“');
System.debug('2ï¸âƒ£ ì™„ë‚© ìƒíƒœ ê²€ì¦ (ëª¨ë“  PaymentStatus í™•ì¸)');
System.debug('   â†“');
System.debug('3ï¸âƒ£ Account ì •ë³´ ìˆ˜ì§‘ (ê¸°ì—…ê·œëª¨, ì—…ê³„, ê³ ê°ë“±ê¸‰)');
System.debug('   â†“');
System.debug('4ï¸âƒ£ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ì ìš© (' + lifecycleMonths + 'ê°œì›” Lifecycle)');
System.debug('   â†“');
System.debug('5ï¸âƒ£ Industry ë§ì¶¤ ì „ëµ (' + (industry ?? 'ì¼ë°˜') + ' íŠ¹í™”)');
System.debug('   â†“');
System.debug('6ï¸âƒ£ Asset ìƒì„± (' + finalAssetName + ')');
System.debug('   â†“');
System.debug('7ï¸âƒ£ ìƒì„¸ ë¶„ì„ Description í¬í•¨');
System.debug('   â†“');
System.debug('8ï¸âƒ£ í›„ì† Task ìë™ ìƒì„± (' + plannedTasks.size() + 'ê°œ)');
System.debug('   â†“');
System.debug('9ï¸âƒ£ Order í™”ë©´ì—ì„œ ì›í´ë¦­ Asset ë„¤ë¹„ê²Œì´ì…˜');
System.debug('');

System.debug('âœ… Asset ë¡œì§ ë‹¨ê³„ë³„ ì‹œì—° ì™„ë£Œ!');
System.debug('ğŸ’¡ ì´ ì „ì²´ í”„ë¡œì„¸ìŠ¤ëŠ” PaymentStatus ì™„ë‚© ì‹œ ìë™ìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.');
System.debug('ğŸš€ Account íŠ¹ì„±ë³„ ë§ì¶¤í˜• Asset ê´€ë¦¬ë¡œ ê³ ê° ë§Œì¡±ë„ì™€ ë§¤ì¶œ í–¥ìƒì„ ë‹¬ì„±í•©ë‹ˆë‹¤!');
