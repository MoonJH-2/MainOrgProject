/**
 * @description Sales ì•± Salesforce Channels í™•ì¸ ì‹¤ìŠµ ê°€ì´ë“œ
 * @author JH Moon
 * @created 2025-07-22
 */

System.debug('ğŸ“± =====Sales ì•± Salesforce Channels í™•ì¸ ì‹¤ìŠµ=====');

// ğŸ“‹ ì‹¤ìŠµ ëª©í‘œ: Sales ì•±ì—ì„œ êµ¬í˜„ëœ Salesforce Channels ê¸°ëŠ¥ í™•ì¸

// 1ï¸âƒ£ Dashboard í™•ì¸ ì¤€ë¹„
System.debug('1ï¸âƒ£ Payment Notification Dashboard í™•ì¸ ì¤€ë¹„');
System.debug('ğŸ”— ë„¤ë¹„ê²Œì´ì…˜: App Launcher â†’ Payment Notification Dashboard');
System.debug('âœ… í™•ì¸ì‚¬í•­:');
System.debug('   â€¢ SalesforceChannel í†µê³„ í‘œì‹œ');
System.debug('   â€¢ ë…¹ìƒ‰ ì•„ì´ì½˜ (standard:groups)');
System.debug('   â€¢ ì‹¤ì‹œê°„ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸');

// 2ï¸âƒ£ Order ë ˆì½”ë“œì—ì„œ ì±„ë„ ì •ë³´ í™•ì¸
System.debug('');
System.debug('2ï¸âƒ£ Order ë ˆì½”ë“œ ì±„ë„ ì •ë³´ í™•ì¸');

List<Order> recentOrders = [
    SELECT Id, OrderNumber, Account.Name, Status, CreatedDate
    FROM Order 
    ORDER BY CreatedDate DESC 
    LIMIT 5
];

System.debug('ğŸ“Š ìµœê·¼ Order ëª©ë¡:');
for (Order order : recentOrders) {
    System.debug('   â€¢ ' + order.OrderNumber + ' (' + order.Account.Name + ') - ' + order.Status);
    System.debug('     ğŸ”— í™•ì¸ ê²½ë¡œ: Sales ì•± â†’ Orders â†’ ' + order.OrderNumber);
}

// 3ï¸âƒ£ Chatter Groups í™•ì¸
System.debug('');
System.debug('3ï¸âƒ£ Chatter Groups ì±„ë„ í™•ì¸');

List<CollaborationGroup> orderChannels = [
    SELECT Id, Name, Description, MemberCount, CreatedDate
    FROM CollaborationGroup 
    WHERE Name LIKE 'Order-%'
    AND IsArchived = false
    ORDER BY CreatedDate DESC
    LIMIT 10
];

System.debug('ğŸ’¬ Order ê´€ë ¨ Chatter Groups:');
for (CollaborationGroup group : orderChannels) {
    System.debug('   â€¢ ' + group.Name + ' (ë©¤ë²„: ' + group.MemberCount + 'ëª…)');
    System.debug('     ğŸ“… ìƒì„±ì¼: ' + group.CreatedDate.format());
}

if (orderChannels.isEmpty()) {
    System.debug('âš ï¸ Order ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆ Orderë¥¼ ìƒì„±í•˜ì—¬ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.');
} else {
    System.debug('ğŸ”— í™•ì¸ ê²½ë¡œ: Chatter íƒ­ â†’ Groups â†’ ë‚´ ê·¸ë£¹');
}

// 4ï¸âƒ£ Payment Notifications í™•ì¸
System.debug('');
System.debug('4ï¸âƒ£ Payment Notifications ì±„ë„ ì‚¬ìš© í˜„í™©');

List<AggregateResult> channelStats = [
    SELECT NotificationChannel__c channel, COUNT(Id) cnt, 
           AVG(CASE WHEN NotificationStatus__c = 'Sent' THEN 1.0 ELSE 0.0 END) successRate
    FROM Payment_Notification__c 
    WHERE CreatedDate = LAST_N_DAYS:7
    GROUP BY NotificationChannel__c
];

System.debug('ğŸ“ˆ ìµœê·¼ 7ì¼ ì•Œë¦¼ ì±„ë„ í†µê³„:');
for (AggregateResult stat : channelStats) {
    String channel = (String)stat.get('channel');
    Integer count = (Integer)stat.get('cnt');
    Decimal successRate = (Decimal)stat.get('successRate');
    
    System.debug('   â€¢ ' + channel + ': ' + count + 'ê±´ (ì„±ê³µë¥ : ' + 
                 (successRate * 100).setScale(1) + '%)');
}

// 5ï¸âƒ£ ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì•ˆë‚´
System.debug('');
System.debug('5ï¸âƒ£ ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤');
System.debug('');

System.debug('ğŸ“ Order ìƒì„± í…ŒìŠ¤íŠ¸:');
System.debug('1. Sales ì•±ì—ì„œ ìƒˆ Order ìƒì„±');
System.debug('2. Account, Products, ë‹´ë‹¹ì ì„¤ì •');
System.debug('3. ì €ì¥ í›„ Chatter Groups í™•ì¸');
System.debug('4. ìƒì„±ëœ "Order-[ë²ˆí˜¸]" ê·¸ë£¹ í™•ì¸');
System.debug('5. í™˜ì˜ ë©”ì‹œì§€ ìë™ í¬ìŠ¤íŠ¸ í™•ì¸');

System.debug('');
System.debug('ğŸ’° Payment Notification í…ŒìŠ¤íŠ¸:');
System.debug('1. PaymentStatus ë ˆì½”ë“œ ìƒì„±');
System.debug('2. NotificationChannel__c = "SalesforceChannel" ì„¤ì •');
System.debug('3. ë°°ì¹˜ ì‹¤í–‰ ë˜ëŠ” ìŠ¤ì¼€ì¤„ëŸ¬ ëŒ€ê¸°');
System.debug('4. í•´ë‹¹ Order ì±„ë„ì—ì„œ ì•Œë¦¼ í™•ì¸');

System.debug('');
System.debug('ğŸ¤– Order Product ìë™í™” í…ŒìŠ¤íŠ¸:');
System.debug('1. Order ìƒíƒœë¥¼ "Activated"ë¡œ ë³€ê²½');
System.debug('2. ìë™í™” íŠ¸ë¦¬ê±° ì‹¤í–‰ ëŒ€ê¸°');
System.debug('3. ì±„ë„ì—ì„œ "ìë™í™” ì™„ë£Œ" ë©”ì‹œì§€ í™•ì¸');

// 6ï¸âƒ£ Mobile ì•± í™•ì¸ ê°€ì´ë“œ
System.debug('');
System.debug('6ï¸âƒ£ Mobile Sales ì•± í™•ì¸');
System.debug('ğŸ“± Salesforce Mobile ì•±ì—ì„œ:');
System.debug('   â€¢ Orders â†’ íŠ¹ì • Order â†’ Chatter í™•ì¸');
System.debug('   â€¢ í‘¸ì‹œ ì•Œë¦¼ ì„¤ì • í™•ì¸');
System.debug('   â€¢ ì±„ë„ ë©”ì‹œì§€ ì‹¤ì‹œê°„ í™•ì¸');
System.debug('   â€¢ @ë©˜ì…˜ ì•Œë¦¼ í…ŒìŠ¤íŠ¸');

// 7ï¸âƒ£ Dashboard í™œìš© íŒ
System.debug('');
System.debug('7ï¸âƒ£ Dashboard í™œìš© íŒ');
System.debug('ğŸ“Š Payment Notification Dashboardì—ì„œ:');
System.debug('   â€¢ "Time Frame" í•„í„°ë¡œ ê¸°ê°„ ì¡°ì •');
System.debug('   â€¢ "Retry Failed Notifications" ë²„íŠ¼ í™œìš©');
System.debug('   â€¢ "Execute Batch Job" ìˆ˜ë™ ì‹¤í–‰');
System.debug('   â€¢ "Scheduler Status" ìƒíƒœ ëª¨ë‹ˆí„°ë§');

// 8ï¸âƒ£ ë¬¸ì œ í•´ê²° ì²´í¬ë¦¬ìŠ¤íŠ¸
System.debug('');
System.debug('8ï¸âƒ£ ë¬¸ì œ í•´ê²° ì²´í¬ë¦¬ìŠ¤íŠ¸');
System.debug('');

System.debug('âŒ ì±„ë„ì´ ìƒì„±ë˜ì§€ ì•ŠëŠ” ê²½ìš°:');
System.debug('   âœ“ Order Ownerê°€ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸');
System.debug('   âœ“ Account Ownerê°€ í™œì„± ì‚¬ìš©ìì¸ì§€ í™•ì¸'); 
System.debug('   âœ“ Developer Consoleì—ì„œ ì˜¤ë¥˜ ë¡œê·¸ í™•ì¸');
System.debug('   âœ“ Chatter Groups ìƒì„± ê¶Œí•œ í™•ì¸');

System.debug('');
System.debug('âŒ ì•Œë¦¼ì´ ë°œì†¡ë˜ì§€ ì•ŠëŠ” ê²½ìš°:');
System.debug('   âœ“ PaymentStatusì™€ Payment_Notification ê´€ê³„ í™•ì¸');
System.debug('   âœ“ NotificationChannel__c ê°’ì´ "SalesforceChannel"ì¸ì§€ í™•ì¸');
System.debug('   âœ“ ë°°ì¹˜ ì‘ì—… ì‹¤í–‰ ìƒíƒœ í™•ì¸');
System.debug('   âœ“ ì±„ë„ ì¡´ì¬ ì—¬ë¶€ í™•ì¸');

System.debug('');
System.debug('âŒ Dashboardì—ì„œ í†µê³„ê°€ í‘œì‹œë˜ì§€ ì•ŠëŠ” ê²½ìš°:');
System.debug('   âœ“ SalesforceChannel ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ í™•ì¸');
System.debug('   âœ“ Time Frame ì„¤ì • í™•ì¸');
System.debug('   âœ“ ë¸Œë¼ìš°ì € ìºì‹œ ìƒˆë¡œê³ ì¹¨');
System.debug('   âœ“ User Permission í™•ì¸');

// 9ï¸âƒ£ ì„±ê³µ ì§€í‘œ í™•ì¸
System.debug('');
System.debug('9ï¸âƒ£ ì„±ê³µ ì§€í‘œ í™•ì¸');

// í˜„ì¬ ì‹œìŠ¤í…œ ìƒíƒœ ìš”ì•½
Integer totalOrders = [SELECT COUNT() FROM Order WHERE CreatedDate = TODAY];
Integer totalChannels = [SELECT COUNT() FROM CollaborationGroup WHERE Name LIKE 'Order-%' AND CreatedDate = TODAY];
Integer totalNotifications = [SELECT COUNT() FROM Payment_Notification__c WHERE NotificationChannel__c = 'SalesforceChannel' AND CreatedDate = TODAY];

System.debug('ğŸ“ˆ ì˜¤ëŠ˜ì˜ ì„±ê³¼:');
System.debug('   â€¢ ìƒì„±ëœ Order: ' + totalOrders + 'ê°œ');
System.debug('   â€¢ ìƒì„±ëœ ì±„ë„: ' + totalChannels + 'ê°œ');
System.debug('   â€¢ SalesforceChannel ì•Œë¦¼: ' + totalNotifications + 'ê±´');

if (totalChannels > 0) {
    System.debug('âœ… Salesforce Channels ì‹œìŠ¤í…œì´ ì •ìƒ ì‘ë™ ì¤‘ì…ë‹ˆë‹¤!');
} else {
    System.debug('âš ï¸ ì•„ì§ ì±„ë„ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. Order ìƒì„±ì„ í†µí•´ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.');
}

System.debug('');
System.debug('ğŸ¯ ì¶”ì²œ ë‹¤ìŒ ë‹¨ê³„:');
System.debug('1. Sales ì•±ì—ì„œ ì‹¤ì œ Order ìƒì„±í•˜ì—¬ ì±„ë„ í™•ì¸');
System.debug('2. Payment Notification Dashboardì—ì„œ í†µê³„ ëª¨ë‹ˆí„°ë§');
System.debug('3. íŒ€ì›ë“¤ê³¼ ì±„ë„ ê³µìœ  ë° í˜‘ì—… í…ŒìŠ¤íŠ¸');
System.debug('4. Mobile ì•±ì—ì„œ ì‹¤ì‹œê°„ ì•Œë¦¼ í™•ì¸');
System.debug('5. ì •ê¸°ì ì¸ ì„±ëŠ¥ ë¦¬í¬íŠ¸ ì‘ì„±');

System.debug('âœ… =====Sales ì•± Salesforce Channels í™•ì¸ ì‹¤ìŠµ ì™„ë£Œ=====');
