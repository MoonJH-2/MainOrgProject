/**
 * @description Agentforce Email Draft Actions for Order, PaymentStatus, Asset
 * @author AI Assistant
 * @created 2025-07-24
 */
public with sharing class AgentforceEmailActions {
    
    /**
     * ë²”ìš© ì´ë©”ì¼ ì´ˆì•ˆ ìƒì„± - ë‹¨ì¼ InvocableMethod
     */
    @InvocableMethod(label='Generate Email Draft' description='ë ˆì½”ë“œ íƒ€ì…ê³¼ ìƒí™©ì— ë”°ë¥¸ ì´ë©”ì¼ ì´ˆì•ˆì„ ìƒì„±í•©ë‹ˆë‹¤')
    public static List<EmailDraftResult> generateEmailDraft(List<UniversalEmailRequest> requests) {
        List<EmailDraftResult> results = new List<EmailDraftResult>();
        
        for(UniversalEmailRequest request : requests) {
            EmailDraftResult result = new EmailDraftResult();
            
            try {
                switch on request.emailType {
                    when 'order' {
                        result = generateOrderEmail(request);
                    }
                    when 'payment' {
                        result = generatePaymentEmail(request);
                    }
                    when 'asset_renewal' {
                        result = generateAssetEmail(request);
                    }
                    when else {
                        result = generateGeneralEmail(request);
                    }
                }
            } catch (Exception e) {
                result.success = false;
                result.errorMessage = e.getMessage();
            }
            
            results.add(result);
        }
        
        return results;
    }
    
    // Order ì´ë©”ì¼ ìƒì„± (ê¸°ì¡´ ë¡œì§ì„ private methodë¡œ ë³€í™˜)
    private static EmailDraftResult generateOrderEmail(UniversalEmailRequest request) {
        List<EmailDraftResult> results = new List<EmailDraftResult>();
        
        for(OrderEmailRequest request : requests) {
            EmailDraftResult result = new EmailDraftResult();
            
            try {
                // Order ì •ë³´ ì¡°íšŒ
                Order orderRecord = [
                    SELECT Id, OrderNumber, Status, TotalAmount, EffectiveDate,
                           Account.Name, Account.BillingStreet, Account.BillingCity,
                           Owner.Name, Owner.Email, Owner.Phone
                    FROM Order 
                    WHERE Id = :request.orderId 
                    LIMIT 1
                ];
                
                // ì´ë©”ì¼ í…œí”Œë¦¿ ìƒì„±
                String emailSubject = generateOrderEmailSubject(orderRecord, request.emailType);
                String emailBody = generateOrderEmailBody(orderRecord, request.emailType);
                
                result.emailSubject = emailSubject;
                result.emailBody = emailBody;
                result.recipientEmail = getOrderRecipientEmail(orderRecord);
                result.emailType = request.emailType;
                result.orderNumber = orderRecord.OrderNumber;
                result.success = true;
                
            } catch(Exception e) {
                result.success = false;
                result.errorMessage = 'Order ì´ë©”ì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜: ' + e.getMessage();
            }
            
            results.add(result);
        }
        
        return results;
    }
    
    /**
     * Payment ì•Œë¦¼ ì´ë©”ì¼ ì´ˆì•ˆ ìƒì„±
     */
    @InvocableMethod(label='Draft Payment Email' description='Payment ìƒíƒœì— ë”°ë¥¸ ì•Œë¦¼ ì´ë©”ì¼ ì´ˆì•ˆì„ ìƒì„±í•©ë‹ˆë‹¤')
    public static List<EmailDraftResult> draftPaymentEmail(List<PaymentEmailRequest> requests) {
        List<EmailDraftResult> results = new List<EmailDraftResult>();
        
        for(PaymentEmailRequest request : requests) {
            EmailDraftResult result = new EmailDraftResult();
            
            try {
                // PaymentStatus ì •ë³´ ì¡°íšŒ
                List<SObject> paymentRecords = Database.query(
                    'SELECT Id, Name, Order__c, Order__r.OrderNumber, Order__r.Account.Name, ' +
                    'Amount__c, DueDate__c, Status__c, Installment_Number__c, ' +
                    'Order__r.Owner.Name, Order__r.Owner.Email ' +
                    'FROM PaymentStatus__c WHERE Id = :request.paymentId LIMIT 1'
                );
                
                if(paymentRecords.isEmpty()) {
                    result.success = false;
                    result.errorMessage = 'PaymentStatusë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                    results.add(result);
                    continue;
                }
                
                SObject paymentRecord = paymentRecords[0];
                
                // ì´ë©”ì¼ í…œí”Œë¦¿ ìƒì„±
                String emailSubject = generatePaymentEmailSubject(paymentRecord, request.emailType);
                String emailBody = generatePaymentEmailBody(paymentRecord, request.emailType);
                
                result.emailSubject = emailSubject;
                result.emailBody = emailBody;
                result.recipientEmail = getPaymentRecipientEmail(paymentRecord);
                result.emailType = request.emailType;
                result.orderNumber = (String)paymentRecord.get('Order__r.OrderNumber');
                result.success = true;
                
            } catch(Exception e) {
                result.success = false;
                result.errorMessage = 'Payment ì´ë©”ì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜: ' + e.getMessage();
            }
            
            results.add(result);
        }
        
        return results;
    }
    
    /**
     * Asset ê°±ì‹  ì´ë©”ì¼ ì´ˆì•ˆ ìƒì„±
     */
    @InvocableMethod(label='Draft Asset Renewal Email' description='Asset ê°±ì‹  ê´€ë ¨ ì´ë©”ì¼ ì´ˆì•ˆì„ ìƒì„±í•©ë‹ˆë‹¤')
    public static List<EmailDraftResult> draftAssetRenewalEmail(List<AssetEmailRequest> requests) {
        List<EmailDraftResult> results = new List<EmailDraftResult>();
        
        for(AssetEmailRequest request : requests) {
            EmailDraftResult result = new EmailDraftResult();
            
            try {
                // Asset ì •ë³´ ì¡°íšŒ
                Asset assetRecord = [
                    SELECT Id, Name, Status, InstallDate, UsageEndDate,
                           Account.Name, Account.BillingStreet, Account.BillingCity,
                           Account.Owner.Name, Account.Owner.Email
                    FROM Asset 
                    WHERE Id = :request.assetId 
                    LIMIT 1
                ];
                
                // ì´ë©”ì¼ í…œí”Œë¦¿ ìƒì„±
                String emailSubject = generateAssetEmailSubject(assetRecord, request.emailType);
                String emailBody = generateAssetEmailBody(assetRecord, request.emailType);
                
                result.emailSubject = emailSubject;
                result.emailBody = emailBody;
                result.recipientEmail = getAssetRecipientEmail(assetRecord);
                result.emailType = request.emailType;
                result.assetName = assetRecord.Name;
                result.success = true;
                
            } catch(Exception e) {
                result.success = false;
                result.errorMessage = 'Asset ì´ë©”ì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜: ' + e.getMessage();
            }
            
            results.add(result);
        }
        
        return results;
    }
    
    /**
     * í†µí•© ì´ë©”ì¼ ìˆ˜ì • ê¸°ëŠ¥
     */
    @InvocableMethod(label='Revise Email Draft' description='ê¸°ì¡´ ì´ë©”ì¼ ì´ˆì•ˆì„ ìˆ˜ì •í•©ë‹ˆë‹¤')
    public static List<EmailDraftResult> reviseEmailDraft(List<EmailRevisionRequest> requests) {
        List<EmailDraftResult> results = new List<EmailDraftResult>();
        
        for(EmailRevisionRequest request : requests) {
            EmailDraftResult result = new EmailDraftResult();
            
            try {
                // ê¸°ì¡´ ì´ë©”ì¼ ë‚´ìš© ê¸°ë°˜ìœ¼ë¡œ ìˆ˜ì •
                String revisedSubject = reviseEmailSubject(request.originalSubject, request.revisionInstructions);
                String revisedBody = reviseEmailBody(request.originalBody, request.revisionInstructions);
                
                result.emailSubject = revisedSubject;
                result.emailBody = revisedBody;
                result.recipientEmail = request.recipientEmail;
                result.emailType = 'Revised';
                result.revisionNotes = generateRevisionNotes(request.revisionInstructions);
                result.success = true;
                
            } catch(Exception e) {
                result.success = false;
                result.errorMessage = 'ì´ë©”ì¼ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜: ' + e.getMessage();
            }
            
            results.add(result);
        }
        
        return results;
    }
    
    // Helper Methods for Order Emails
    private static String generateOrderEmailSubject(Order orderRecord, String emailType) {
        String subject = '';
        
        switch on emailType {
            when 'Order_Confirmation' {
                subject = '[ì£¼ë¬¸ í™•ì¸] Order ' + orderRecord.OrderNumber + ' - ' + orderRecord.Account.Name;
            }
            when 'Order_Activation' {
                subject = '[ì„œë¹„ìŠ¤ í™œì„±í™”] Order ' + orderRecord.OrderNumber + ' ì„œë¹„ìŠ¤ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤';
            }
            when 'Order_Status_Update' {
                subject = '[ì§„í–‰ ìƒí™©] Order ' + orderRecord.OrderNumber + ' ìƒíƒœ ì—…ë°ì´íŠ¸';
            }
            when 'Order_Completion' {
                subject = '[ì™„ë£Œ ì•Œë¦¼] Order ' + orderRecord.OrderNumber + ' ì„œë¹„ìŠ¤ ì™„ë£Œ';
            }
            when else {
                subject = '[ì•Œë¦¼] Order ' + orderRecord.OrderNumber + ' ê´€ë ¨ ì•ˆë‚´';
            }
        }
        
        return subject;
    }
    
    private static String generateOrderEmailBody(Order orderRecord, String emailType) {
        String body = '';
        
        body += 'ì•ˆë…•í•˜ì„¸ìš”, ' + orderRecord.Account.Name + ' ë‹´ë‹¹ìë‹˜\n\n';
        body += 'ë‹´ë‹¹ ì˜ì—…ì‚¬ì› ' + orderRecord.Owner.Name + 'ì…ë‹ˆë‹¤.\n\n';
        
        switch on emailType {
            when 'Order_Confirmation' {
                body += 'ğŸ“‹ ì£¼ë¬¸ì´ ì •ìƒì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n';
                body += 'ì£¼ë¬¸ ì •ë³´:\n';
                body += 'â€¢ ì£¼ë¬¸ë²ˆí˜¸: ' + orderRecord.OrderNumber + '\n';
                body += 'â€¢ ì£¼ë¬¸ê¸ˆì•¡: â‚©' + String.valueOf(orderRecord.TotalAmount) + '\n';
                body += 'â€¢ ì‹œì‘ì¼: ' + orderRecord.EffectiveDate.format() + '\n\n';
                body += 'ì¶”ê°€ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ì—°ë½ì£¼ì„¸ìš”.\n';
            }
            when 'Order_Activation' {
                body += 'ğŸš€ ì„œë¹„ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n';
                body += 'ì´ì œ ì£¼ë¬¸í•˜ì‹  ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n';
                body += 'ì„œë¹„ìŠ¤ ì´ìš© ì¤‘ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ë‹´ë‹¹ìì—ê²Œ ì—°ë½ì£¼ì„¸ìš”.\n';
            }
            when 'Order_Status_Update' {
                body += 'ğŸ“Š ì£¼ë¬¸ ì§„í–‰ ìƒí™©ì„ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.\n\n';
                body += 'í˜„ì¬ ìƒíƒœ: ' + orderRecord.Status + '\n';
                body += 'ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰ ì‹œ ë³„ë„ ì•ˆë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n';
            }
            when 'Order_Completion' {
                body += 'ğŸ‰ ì£¼ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\n\n';
                body += 'ì„œë¹„ìŠ¤ ì´ìš©í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.\n';
                body += 'ì¶”ê°€ ì„œë¹„ìŠ¤ë‚˜ ì—°ì¥ì´ í•„ìš”í•˜ì‹œë©´ ì–¸ì œë“  ë¬¸ì˜ì£¼ì„¸ìš”.\n';
            }
        }
        
        body += '\nê°ì‚¬í•©ë‹ˆë‹¤.\n';
        body += orderRecord.Owner.Name + '\n';
        body += 'ì „í™”: ' + orderRecord.Owner.Phone + '\n';
        body += 'ì´ë©”ì¼: ' + orderRecord.Owner.Email;
        
        return body;
    }
    
    // Helper Methods for Payment Emails
    private static String generatePaymentEmailSubject(SObject paymentRecord, String emailType) {
        String orderNumber = (String)paymentRecord.get('Order__r.OrderNumber');
        String subject = '';
        
        switch on emailType {
            when 'Payment_Reminder' {
                subject = '[ê²°ì œ ì•ˆë‚´] Order ' + orderNumber + ' - ' + paymentRecord.get('Installment_Number__c') + 'íšŒì°¨ ê²°ì œ ì•ˆë‚´';
            }
            when 'Payment_Overdue' {
                subject = '[ì—°ì²´ ì•Œë¦¼] Order ' + orderNumber + ' - ê²°ì œ ì§€ì—° ì•ˆë‚´';
            }
            when 'Payment_Confirmation' {
                subject = '[ê²°ì œ ì™„ë£Œ] Order ' + orderNumber + ' - ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤';
            }
            when else {
                subject = '[ê²°ì œ ì•Œë¦¼] Order ' + orderNumber + ' ê²°ì œ ê´€ë ¨ ì•ˆë‚´';
            }
        }
        
        return subject;
    }
    
    private static String generatePaymentEmailBody(SObject paymentRecord, String emailType) {
        String body = '';
        String accountName = (String)paymentRecord.get('Order__r.Account.Name');
        String orderNumber = (String)paymentRecord.get('Order__r.OrderNumber');
        String ownerName = (String)paymentRecord.get('Order__r.Owner.Name');
        
        body += 'ì•ˆë…•í•˜ì„¸ìš”, ' + accountName + ' ë‹´ë‹¹ìë‹˜\n\n';
        body += 'ë‹´ë‹¹ ì˜ì—…ì‚¬ì› ' + ownerName + 'ì…ë‹ˆë‹¤.\n\n';
        
        switch on emailType {
            when 'Payment_Reminder' {
                Date dueDate = (Date)paymentRecord.get('DueDate__c');
                Decimal amount = (Decimal)paymentRecord.get('Amount__c');
                
                body += 'ğŸ’° ê²°ì œ ì˜ˆì • ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.\n\n';
                body += 'ê²°ì œ ì •ë³´:\n';
                body += 'â€¢ ì£¼ë¬¸ë²ˆí˜¸: ' + orderNumber + '\n';
                body += 'â€¢ íšŒì°¨: ' + paymentRecord.get('Installment_Number__c') + 'íšŒì°¨\n';
                body += 'â€¢ ê²°ì œê¸ˆì•¡: â‚©' + String.valueOf(amount) + '\n';
                body += 'â€¢ ê²°ì œì˜ˆì •ì¼: ' + dueDate.format() + '\n\n';
                body += 'ê²°ì œì¼ 3ì¼ ì „ ì•ˆë‚´ë“œë¦¬ë©°, ì¤€ë¹„í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.\n';
            }
            when 'Payment_Overdue' {
                body += 'âš ï¸ ê²°ì œê°€ ì§€ì—°ë˜ì–´ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.\n\n';
                body += 'ë¹ ë¥¸ ì‹œì¼ ë‚´ì— ê²°ì œë¥¼ ì™„ë£Œí•´ ì£¼ì‹œê¸° ë°”ë¼ë©°,\n';
                body += 'ê²°ì œ ê´€ë ¨ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ë‹´ë‹¹ìì—ê²Œ ì—°ë½ì£¼ì„¸ìš”.\n';
            }
            when 'Payment_Confirmation' {
                body += 'âœ… ê²°ì œê°€ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\n\n';
                body += 'ê²°ì œí•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.\n';
                body += 'ë‹¤ìŒ íšŒì°¨ ê²°ì œì¼ì´ ë‹¤ê°€ì˜¤ë©´ ë¯¸ë¦¬ ì•ˆë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n';
            }
        }
        
        body += '\nê°ì‚¬í•©ë‹ˆë‹¤.\n';
        body += ownerName + '\n';
        body += 'ë¬¸ì˜: ' + paymentRecord.get('Order__r.Owner.Email');
        
        return body;
    }
    
    // Helper Methods for Asset Emails
    private static String generateAssetEmailSubject(Asset assetRecord, String emailType) {
        String subject = '';
        
        switch on emailType {
            when 'Asset_Renewal_Notice' {
                subject = '[ê°±ì‹  ì•ˆë‚´] ' + assetRecord.Name + ' ê°±ì‹  ì‹œê¸° ì•ˆë‚´';
            }
            when 'Asset_Expiration_Warning' {
                subject = '[ë§Œë£Œ ì˜ˆì •] ' + assetRecord.Name + ' ì„œë¹„ìŠ¤ ë§Œë£Œ ì•ˆë‚´';
            }
            when 'Asset_Renewal_Offer' {
                subject = '[ê°±ì‹  ì œì•ˆ] ' + assetRecord.Name + ' íŠ¹ë³„ ê°±ì‹  í˜œíƒ';
            }
            when else {
                subject = '[Asset ì•Œë¦¼] ' + assetRecord.Name + ' ê´€ë ¨ ì•ˆë‚´';
            }
        }
        
        return subject;
    }
    
    private static String generateAssetEmailBody(Asset assetRecord, String emailType) {
        String body = '';
        
        body += 'ì•ˆë…•í•˜ì„¸ìš”, ' + assetRecord.Account.Name + ' ë‹´ë‹¹ìë‹˜\n\n';
        body += 'ë‹´ë‹¹ ì˜ì—…ì‚¬ì› ' + assetRecord.Account.Owner.Name + 'ì…ë‹ˆë‹¤.\n\n';
        
        switch on emailType {
            when 'Asset_Renewal_Notice' {
                Integer daysToExpiry = Date.today().daysBetween(assetRecord.UsageEndDate);
                
                body += 'ğŸ”„ Asset ê°±ì‹  ì‹œê¸°ê°€ ë‹¤ê°€ì™€ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.\n\n';
                body += 'Asset ì •ë³´:\n';
                body += 'â€¢ Assetëª…: ' + assetRecord.Name + '\n';
                body += 'â€¢ í˜„ì¬ ìƒíƒœ: ' + assetRecord.Status + '\n';
                body += 'â€¢ ë§Œë£Œì˜ˆì •ì¼: ' + assetRecord.UsageEndDate.format() + '\n';
                body += 'â€¢ ë‚¨ì€ ê¸°ê°„: ' + daysToExpiry + 'ì¼\n\n';
                body += 'ì„œë¹„ìŠ¤ ì—°ì¥ì„ í¬ë§í•˜ì‹œë©´ ë¯¸ë¦¬ ì—°ë½ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.\n';
            }
            when 'Asset_Expiration_Warning' {
                body += 'âš ï¸ Asset ì„œë¹„ìŠ¤ ë§Œë£Œê°€ ì„ë°•í–ˆìŠµë‹ˆë‹¤.\n\n';
                body += 'ì„œë¹„ìŠ¤ ì¤‘ë‹¨ì„ í”¼í•˜ë ¤ë©´ ê°±ì‹  ì ˆì°¨ë¥¼ ì§„í–‰í•´ ì£¼ì„¸ìš”.\n';
                body += 'ê°±ì‹  ê´€ë ¨ ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“  ì—°ë½ì£¼ì„¸ìš”.\n';
            }
            when 'Asset_Renewal_Offer' {
                body += 'ğŸ íŠ¹ë³„ ê°±ì‹  í˜œíƒì„ ì œì•ˆë“œë¦½ë‹ˆë‹¤.\n\n';
                body += 'ê¸°ì¡´ ê³ ê° ëŒ€ìƒ í• ì¸ í˜œíƒê³¼ ì¶”ê°€ ì„œë¹„ìŠ¤ë¥¼\n';
                body += 'ì œê³µí•´ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n';
                body += 'ìì„¸í•œ ë‚´ìš©ì€ ë‹´ë‹¹ìì™€ ìƒë‹´í•´ ì£¼ì„¸ìš”.\n';
            }
        }
        
        body += '\nê°ì‚¬í•©ë‹ˆë‹¤.\n';
        body += assetRecord.Account.Owner.Name + '\n';
        body += 'ì´ë©”ì¼: ' + assetRecord.Account.Owner.Email;
        
        return body;
    }
    
    // Email Revision Helper Methods
    private static String reviseEmailSubject(String originalSubject, String instructions) {
        String revisedSubject = originalSubject;
        
        if(instructions.containsIgnoreCase('urgent') || instructions.containsIgnoreCase('ê¸´ê¸‰')) {
            revisedSubject = '[ê¸´ê¸‰] ' + revisedSubject;
        }
        
        if(instructions.containsIgnoreCase('reminder') || instructions.containsIgnoreCase('ë¦¬ë§ˆì¸ë”')) {
            revisedSubject = revisedSubject.replace('[ì•Œë¦¼]', '[ë¦¬ë§ˆì¸ë”]');
        }
        
        return revisedSubject;
    }
    
    private static String reviseEmailBody(String originalBody, String instructions) {
        String revisedBody = originalBody;
        
        if(instructions.containsIgnoreCase('formal') || instructions.containsIgnoreCase('ê³µì‹ì ')) {
            revisedBody = revisedBody.replace('ì•ˆë…•í•˜ì„¸ìš”', 'ì•ˆë…•í•˜ì‹­ë‹ˆê¹Œ');
            revisedBody = revisedBody.replace('ì£¼ì„¸ìš”', 'ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤');
        }
        
        if(instructions.containsIgnoreCase('brief') || instructions.containsIgnoreCase('ê°„ë‹¨')) {
            // ê°„ë‹¨í•˜ê²Œ ìš”ì•½
            String[] lines = revisedBody.split('\n');
            String briefBody = '';
            for(String line : lines) {
                if(line.contains('â€¢') || line.contains('ğŸ“‹') || line.contains('ğŸ’°') || line.contains('ğŸ”„')) {
                    briefBody += line + '\n';
                }
            }
            revisedBody = briefBody;
        }
        
        return revisedBody;
    }
    
    private static String getOrderRecipientEmail(Order orderRecord) {
        // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” Contact ë˜ëŠ” Accountì—ì„œ ì´ë©”ì¼ ì¡°íšŒ
        return 'customer@example.com'; // placeholder
    }
    
    private static String getPaymentRecipientEmail(SObject paymentRecord) {
        // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” Account Contactì—ì„œ ì´ë©”ì¼ ì¡°íšŒ
        return 'finance@example.com'; // placeholder
    }
    
    private static String getAssetRecipientEmail(Asset assetRecord) {
        // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” Account Contactì—ì„œ ì´ë©”ì¼ ì¡°íšŒ
        return 'admin@example.com'; // placeholder
    }
    
    private static String generateRevisionNotes(String instructions) {
        return 'ìˆ˜ì • ìš”ì²­: ' + instructions + ' (ìˆ˜ì • ì‹œê°„: ' + Datetime.now().format('yyyy-MM-dd HH:mm:ss') + ')';
    }
    
    // Input/Output Classes
    public class OrderEmailRequest {
        @InvocableVariable(required=true)
        public String orderId;
        @InvocableVariable(required=true)
        public String emailType; // Order_Confirmation, Order_Activation, Order_Status_Update, Order_Completion
    }
    
    public class PaymentEmailRequest {
        @InvocableVariable(required=true)
        public String paymentId;
        @InvocableVariable(required=true)
        public String emailType; // Payment_Reminder, Payment_Overdue, Payment_Confirmation
    }
    
    public class AssetEmailRequest {
        @InvocableVariable(required=true)
        public String assetId;
        @InvocableVariable(required=true)
        public String emailType; // Asset_Renewal_Notice, Asset_Expiration_Warning, Asset_Renewal_Offer
    }
    
    public class EmailRevisionRequest {
        @InvocableVariable(required=true)
        public String originalSubject;
        @InvocableVariable(required=true)
        public String originalBody;
        @InvocableVariable(required=true)
        public String revisionInstructions;
        @InvocableVariable
        public String recipientEmail;
    }
    
    public class EmailDraftResult {
        @InvocableVariable
        public Boolean success;
        @InvocableVariable
        public String errorMessage;
        @InvocableVariable
        public String emailSubject;
        @InvocableVariable
        public String emailBody;
        @InvocableVariable
        public String recipientEmail;
        @InvocableVariable
        public String emailType;
        @InvocableVariable
        public String orderNumber;
        @InvocableVariable
        public String assetName;
        @InvocableVariable
        public String revisionNotes;
    }
}
