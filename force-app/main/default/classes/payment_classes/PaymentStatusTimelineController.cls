/**
 * @description       : 
 * @author            : JH Moon
 * @last modified on  : 07-14-2025
 * @last modified by  : JH Moon
**/
public with sharing class PaymentStatusTimelineController {
    
    @AuraEnabled(cacheable=true)
    public static PaymentTimelineWrapper getPaymentTimeline(Id orderId) {
        try {
            // Order ì •ë³´ ì¡°íšŒ
            Order orderInfo = [
                SELECT Id, OrderNumber, TotalAmount, EffectiveDate, Payment_Method__c, Account.Name
                FROM Order 
                WHERE Id = :orderId 
                LIMIT 1
            ];
            
            // PaymentStatus ëª©ë¡ ì¡°íšŒ
            List<PaymentStatus__c> paymentStatuses = [
                SELECT Id, Order__c, Amount__c, DueDate__c, InstallmentNumber__c, Status__c, PaidDate__c
                FROM PaymentStatus__c 
                WHERE Order__c = :orderId 
                ORDER BY InstallmentNumber__c ASC
            ];
            
            // ì§„í–‰ë¥  ê³„ì‚°
            Integer totalInstallments = paymentStatuses.size();
            Integer completedInstallments = 0;
            Integer overdueInstallments = 0;
            Date today = Date.today();
            
            for (PaymentStatus__c ps : paymentStatuses) {
                if (ps.Status__c == 'ì™„ë‚©') {
                    completedInstallments++;
                } else if (ps.DueDate__c != null && ps.DueDate__c < today) {
                    overdueInstallments++;
                }
            }
            
            Decimal progressPercentage = totalInstallments > 0 ? 
                (Decimal.valueOf(completedInstallments) / totalInstallments * 100).setScale(1) : 0;
            
            PaymentTimelineWrapper wrapper = new PaymentTimelineWrapper();
            wrapper.orderInfo = orderInfo;
            wrapper.paymentStatuses = paymentStatuses;
            wrapper.totalInstallments = totalInstallments;
            wrapper.completedInstallments = completedInstallments;
            wrapper.overdueInstallments = overdueInstallments;
            wrapper.progressPercentage = progressPercentage;
            
            return wrapper;
            
        } catch (Exception e) {
            throw new AuraHandledException('ë‚©ë¶€ ì¼ì •ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + e.getMessage());
        }
    }
    
    @AuraEnabled
    public static String updatePaymentStatus(Id paymentStatusId, String newStatus) {
        try {
            PaymentStatus__c ps = new PaymentStatus__c(
                Id = paymentStatusId,
                Status__c = newStatus
            );
            
            // ì™„ë‚© ì²˜ë¦¬ ì‹œ ë‚©ë¶€ì¼ì ì„¤ì •, ë¯¸ë‚© ì²˜ë¦¬ ì‹œ ë‚©ë¶€ì¼ì ì œê±°
            if (newStatus == 'ì™„ë‚©') {
                ps.PaidDate__c = Date.today();
            } else {
                ps.PaidDate__c = null;
            }
            
            update ps;
            
            // íŠ¸ë¦¬ê±°ì—ì„œ Task ìƒì„±ì„ ì²˜ë¦¬í•˜ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì œê±°
            // checkOverdueAndCreateTasks(new List<Id>{paymentStatusId});
            
            return 'SUCCESS';
        } catch (Exception e) {
            throw new AuraHandledException('ë‚©ë¶€ ìƒíƒœ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + e.getMessage());
        }
    }
    
    @AuraEnabled
    public static String updateMultiplePaymentStatus(List<Id> paymentStatusIds, String newStatus) {
        try {
            List<PaymentStatus__c> paymentStatusesToUpdate = new List<PaymentStatus__c>();
            
            for (Id psId : paymentStatusIds) {
                paymentStatusesToUpdate.add(new PaymentStatus__c(
                    Id = psId,
                    Status__c = newStatus
                ));
            }
            
            if (!paymentStatusesToUpdate.isEmpty()) {
                update paymentStatusesToUpdate;
            }
            
            return 'SUCCESS';
        } catch (Exception e) {
            throw new AuraHandledException('ë‚©ë¶€ ìƒíƒœ ì¼ê´„ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + e.getMessage());
        }
    }
    
    @AuraEnabled
    public static String generatePaymentSchedulePDF(Id orderId) {
        try {
            // Order ì •ë³´ ì¡°íšŒ
            Order orderInfo = [
                SELECT Id, OrderNumber, Account.Name, TotalAmount
                FROM Order 
                WHERE Id = :orderId 
                LIMIT 1
            ];
            
            // PDF í˜ì´ì§€ URL ìƒì„±
            PageReference pdfPage = Page.PaymentSchedule_PDF;
            pdfPage.getParameters().put('orderId', orderId);
            
            // PDF ìƒì„± ë° ì²¨ë¶€íŒŒì¼ë¡œ ì €ì¥
            Blob pdfBlob = pdfPage.getContentAsPDF();
            
            // ì²¨ë¶€íŒŒì¼ ìƒì„± (Salesforce Files ì‚¬ìš©)
            ContentVersion contentVersion = new ContentVersion();
            contentVersion.Title = 'ë‚©ë¶€ì¼ì •ì„œ_' + orderInfo.OrderNumber + '_' + String.valueOf(System.now()).replace(' ', '_').replace(':', '');
            contentVersion.PathOnClient = contentVersion.Title + '.pdf';
            contentVersion.VersionData = pdfBlob;
            contentVersion.FirstPublishLocationId = orderId;
            contentVersion.ContentLocation = 'S'; // Salesforceì— ì €ì¥
            
            insert contentVersion;
            
            // PDF ìƒì„± ê´€ë ¨ Task ìƒì„±
            createPDFGenerationTask(orderId, orderInfo.OrderNumber, contentVersion.Title);
            
            return contentVersion.Id;
        } catch (Exception e) {
            throw new AuraHandledException('PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + e.getMessage());
        }
    }
    
    @AuraEnabled
    public static String sendPaymentNotificationEmail(Id orderId, String emailAddress) {
        try {
            // Order ì •ë³´ ì¡°íšŒ
            Order orderInfo = [
                SELECT Id, OrderNumber, Account.Name, TotalAmount
                FROM Order 
                WHERE Id = :orderId 
                LIMIT 1
            ];
            
            // PaymentStatus ì¡°íšŒ
            List<PaymentStatus__c> paymentStatuses = [
                SELECT Id, Amount__c, DueDate__c, InstallmentNumber__c, Status__c
                FROM PaymentStatus__c 
                WHERE Order__c = :orderId AND Status__c = 'ë¯¸ë‚©'
                ORDER BY InstallmentNumber__c ASC
            ];
            
            // ì´ë©”ì¼ ë°œì†¡
            Messaging.SingleEmailMessage email = new Messaging.SingleEmailMessage();
            email.setToAddresses(new String[] { emailAddress });
            email.setSubject('[' + orderInfo.OrderNumber + '] ë‚©ë¶€ ì¼ì • ì•ˆë‚´');
            
            // HTML ì´ë©”ì¼ ë³¸ë¬¸ ìƒì„±
            String emailBody = generateEmailBody(orderInfo, paymentStatuses);
            email.setHtmlBody(emailBody);
            
            // PDF ì²¨ë¶€
            try {
                PageReference pdfPage = Page.PaymentSchedule_PDF;
                pdfPage.getParameters().put('orderId', orderId);
                Blob pdfBlob = pdfPage.getContentAsPDF();
                
                Messaging.EmailFileAttachment attachment = new Messaging.EmailFileAttachment();
                attachment.setFileName('ë‚©ë¶€ì¼ì •ì„œ.pdf');
                attachment.setBody(pdfBlob);
                attachment.setContentType('application/pdf');
                
                email.setFileAttachments(new Messaging.EmailFileAttachment[] { attachment });
            } catch (Exception pdfEx) {
                System.debug('PDF ì²¨ë¶€ ì‹¤íŒ¨: ' + pdfEx.getMessage());
            }
            
            Messaging.sendEmail(new Messaging.SingleEmailMessage[] { email });
            
            return 'EMAIL_SENT_SUCCESS';
        } catch (Exception e) {
            throw new AuraHandledException('ì´ë©”ì¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + e.getMessage());
        }
    }
    
    private static String generateEmailBody(Order orderInfo, List<PaymentStatus__c> paymentStatuses) {
        String body = '<html><body>';
        body += '<h2>ë‚©ë¶€ ì¼ì • ì•ˆë‚´</h2>';
        body += '<p>ì•ˆë…•í•˜ì„¸ìš”, ' + orderInfo.Account.Name + ' ê³ ê°ë‹˜</p>';
        body += '<p>ì£¼ë¬¸ë²ˆí˜¸ <strong>' + orderInfo.OrderNumber + '</strong>ì— ëŒ€í•œ ë‚©ë¶€ ì¼ì •ì„ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.</p>';
        
        if (!paymentStatuses.isEmpty()) {
            body += '<h3>ë¯¸ë‚© ë‚´ì—­</h3>';
            body += '<table border="1" style="border-collapse: collapse; width: 100%;">';
            body += '<tr style="background-color: #f0f0f0;"><th>íšŒì°¨</th><th>ë‚©ë¶€ ì˜ˆì •ì¼</th><th>ë‚©ë¶€ ê¸ˆì•¡</th></tr>';
            
            for (PaymentStatus__c ps : paymentStatuses) {
                body += '<tr>';
                body += '<td style="text-align: center;">' + ps.InstallmentNumber__c + '</td>';
                body += '<td style="text-align: center;">' + ps.DueDate__c + '</td>';
                body += '<td style="text-align: right;">' + String.valueOf(ps.Amount__c) + 'ì›</td>';
                body += '</tr>';
            }
            
            body += '</table>';
        }
        
        body += '<p>ìì„¸í•œ ë‚´ìš©ì€ ì²¨ë¶€ëœ ë‚©ë¶€ì¼ì •ì„œë¥¼ í™•ì¸í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.</p>';
        body += '<p>ê°ì‚¬í•©ë‹ˆë‹¤.</p>';
        body += '</body></html>';
        
        return body;
    }
    
    // ì—°ì²´ ì²´í¬ ë° Task ìƒì„± ë©”ì„œë“œ
    @AuraEnabled
    public static void checkOverdueAndCreateTasks(List<Id> paymentStatusIds) {
        try {
            List<PaymentStatus__c> paymentStatuses = [
                SELECT Id, Order__c, Order__r.OrderNumber, Order__r.Account.Name, 
                       Amount__c, DueDate__c, InstallmentNumber__c, Status__c, PaidDate__c
                FROM PaymentStatus__c 
                WHERE Id IN :paymentStatusIds
            ];
            
            Date today = Date.today();
            List<Task> tasksToCreate = new List<Task>();
            Set<String> subjectsToCheck = new Set<String>();
            
            // ë¨¼ì € ìƒì„±í•  Task Subjectë“¤ì„ ìˆ˜ì§‘
            for (PaymentStatus__c ps : paymentStatuses) {
                // ì—°ì²´ ìƒí™© ì²´í¬
                if (ps.DueDate__c != null && ps.DueDate__c < today && ps.Status__c == 'ë¯¸ë‚©') {
                    subjectsToCheck.add('ì—°ì²´ ì•Œë¦¼ - ' + ps.Order__r.OrderNumber + ' ' + ps.InstallmentNumber__c + 'ì°¨');
                }
                
                // ì™„ë‚© ì²˜ë¦¬ ì‹œ ì™„ë£Œ Task ìƒì„±
                if (ps.Status__c == 'ì™„ë‚©' && ps.PaidDate__c == Date.today()) {
                    subjectsToCheck.add('ë‚©ë¶€ ì™„ë£Œ - ' + ps.Order__r.OrderNumber + ' ' + ps.InstallmentNumber__c + 'ì°¨');
                }
            }
            
            // ì˜¤ëŠ˜ ìƒì„±ëœ ë™ì¼í•œ Subjectì˜ Taskê°€ ìˆëŠ”ì§€ í™•ì¸
            Set<String> existingSubjects = new Set<String>();
            if (!subjectsToCheck.isEmpty()) {
                List<Task> existingTasks = [
                    SELECT Subject FROM Task 
                    WHERE Subject IN :subjectsToCheck 
                    AND CreatedDate = TODAY
                ];
                
                for (Task t : existingTasks) {
                    existingSubjects.add(t.Subject);
                }
            }
            
            // ì¤‘ë³µë˜ì§€ ì•Šì€ Taskë§Œ ìƒì„±
            for (PaymentStatus__c ps : paymentStatuses) {
                // ì—°ì²´ ìƒí™© ì²´í¬ (ë‚©ë¶€ ê¸°ì¼ì´ ì§€ë‚¬ëŠ”ë° ë¯¸ë‚© ìƒíƒœ)
                if (ps.DueDate__c != null && ps.DueDate__c < today && ps.Status__c == 'ë¯¸ë‚©') {
                    String overdueSubject = 'ì—°ì²´ ì•Œë¦¼ - ' + ps.Order__r.OrderNumber + ' ' + ps.InstallmentNumber__c + 'ì°¨';
                    
                    if (!existingSubjects.contains(overdueSubject)) {
                        Integer overdueDays = today.daysBetween(ps.DueDate__c);
                        
                        Task overdueTask = new Task();
                        overdueTask.Subject = overdueSubject;
                        overdueTask.Description = buildOverdueTaskDescription(ps, overdueDays);
                        overdueTask.WhatId = ps.Order__c; // Orderì™€ ì—°ê²°
                        overdueTask.ActivityDate = Date.today();
                        overdueTask.Priority = 'High';
                        overdueTask.Status = 'Open';
                        overdueTask.Type = 'ì—°ì²´ ê´€ë¦¬';
                        
                        tasksToCreate.add(overdueTask);
                        existingSubjects.add(overdueSubject); // ì¤‘ë³µ ë°©ì§€ìš© ì¶”ê°€
                    }
                }
                
                // ì™„ë‚© ì²˜ë¦¬ ì‹œ ì™„ë£Œ Task ìƒì„±
                if (ps.Status__c == 'ì™„ë‚©' && ps.PaidDate__c == Date.today()) {
                    String completedSubject = 'ë‚©ë¶€ ì™„ë£Œ - ' + ps.Order__r.OrderNumber + ' ' + ps.InstallmentNumber__c + 'ì°¨';
                    
                    if (!existingSubjects.contains(completedSubject)) {
                        Task completedTask = new Task();
                        completedTask.Subject = completedSubject;
                        completedTask.Description = buildCompletedTaskDescription(ps);
                        completedTask.WhatId = ps.Order__c; // Orderì™€ ì—°ê²°
                        completedTask.ActivityDate = Date.today();
                        completedTask.Priority = 'Normal';
                        completedTask.Status = 'Completed';
                        completedTask.Type = 'ë‚©ë¶€ ê´€ë¦¬';
                        
                        tasksToCreate.add(completedTask);
                        existingSubjects.add(completedSubject); // ì¤‘ë³µ ë°©ì§€ìš© ì¶”ê°€
                    }
                }
            }
            
            if (!tasksToCreate.isEmpty()) {
                insert tasksToCreate;
            }
            
        } catch (Exception e) {
            System.debug('Task ìƒì„± ì¤‘ ì˜¤ë¥˜: ' + e.getMessage());
        }
    }
    
    // PDF ìƒì„± Task ìƒì„± ë©”ì„œë“œ
    private static void createPDFGenerationTask(Id orderId, String orderNumber, String pdfFileName) {
        try {
            Task pdfTask = new Task();
            pdfTask.Subject = 'PDF ìƒì„± ì™„ë£Œ - ' + orderNumber + ' ë‚©ë¶€ì¼ì •ì„œ';
            pdfTask.Description = buildPDFTaskDescription(orderNumber, pdfFileName);
            pdfTask.WhatId = orderId; // Orderì™€ ì—°ê²°
            pdfTask.ActivityDate = Date.today();
            pdfTask.Priority = 'Normal';
            pdfTask.Status = 'Completed';
            pdfTask.Type = 'ë¬¸ì„œ ê´€ë¦¬';
            
            insert pdfTask;
            
        } catch (Exception e) {
            System.debug('PDF Task ìƒì„± ì¤‘ ì˜¤ë¥˜: ' + e.getMessage());
        }
    }
    
    // ì—°ì²´ Task ì„¤ëª… ìƒì„±
    private static String buildOverdueTaskDescription(PaymentStatus__c ps, Integer overdueDays) {
        String description = 'ğŸš¨ ì—°ì²´ ì•Œë¦¼\n\n';
        description += 'ğŸ“‹ ì£¼ë¬¸ ì •ë³´:\n';
        description += 'â€¢ ì£¼ë¬¸ë²ˆí˜¸: ' + ps.Order__r.OrderNumber + '\n';
        description += 'â€¢ ê³ ê°ëª…: ' + ps.Order__r.Account.Name + '\n';
        description += 'â€¢ ë‚©ë¶€ íšŒì°¨: ' + ps.InstallmentNumber__c + 'ì°¨\n\n';
        
        description += 'ğŸ’° ì—°ì²´ ë‚´ì—­:\n';
        description += 'â€¢ ë‚©ë¶€ ì˜ˆì •ì¼: ' + ps.DueDate__c.format() + '\n';
        description += 'â€¢ ë‚©ë¶€ ê¸ˆì•¡: ' + String.valueOf(ps.Amount__c.format()) + 'ì›\n';
        description += 'â€¢ ì—°ì²´ ì¼ìˆ˜: ' + overdueDays + 'ì¼\n';
        description += 'â€¢ í˜„ì¬ ìƒíƒœ: ' + ps.Status__c + '\n\n';
        
        description += 'ğŸ“ í•„ìš” ì¡°ì¹˜:\n';
        description += 'â€¢ ê³ ê° ì—°ë½ ë° ë‚©ë¶€ ë…ì´‰\n';
        description += 'â€¢ ì—°ì²´ë£Œ ì‚°ì • ê²€í† \n';
        description += 'â€¢ ë‚©ë¶€ ê³„íš ì¬í˜‘ì˜ í•„ìš” ì‹œ í˜‘ì˜\n\n';
        
        description += 'â° ìƒì„±ì¼ì‹œ: ' + System.now().format('yyyy-MM-dd HH:mm:ss');
        
        return description;
    }
    
    // ì™„ë‚© Task ì„¤ëª… ìƒì„±
    private static String buildCompletedTaskDescription(PaymentStatus__c ps) {
        String description = 'âœ… ë‚©ë¶€ ì™„ë£Œ\n\n';
        description += 'ğŸ“‹ ì£¼ë¬¸ ì •ë³´:\n';
        description += 'â€¢ ì£¼ë¬¸ë²ˆí˜¸: ' + ps.Order__r.OrderNumber + '\n';
        description += 'â€¢ ê³ ê°ëª…: ' + ps.Order__r.Account.Name + '\n';
        description += 'â€¢ ë‚©ë¶€ íšŒì°¨: ' + ps.InstallmentNumber__c + 'ì°¨\n\n';
        
        description += 'ğŸ’° ë‚©ë¶€ ë‚´ì—­:\n';
        description += 'â€¢ ë‚©ë¶€ ì˜ˆì •ì¼: ' + ps.DueDate__c.format() + '\n';
        description += 'â€¢ ë‚©ë¶€ ì™„ë£Œì¼: ' + ps.PaidDate__c.format() + '\n';
        description += 'â€¢ ë‚©ë¶€ ê¸ˆì•¡: ' + String.valueOf(ps.Amount__c.format()) + 'ì›\n';
        description += 'â€¢ í˜„ì¬ ìƒíƒœ: ' + ps.Status__c + '\n\n';
        
        description += 'â° ì™„ë£Œì¼ì‹œ: ' + System.now().format('yyyy-MM-dd HH:mm:ss');
        
        return description;
    }
    
    // PDF ìƒì„± Task ì„¤ëª… ìƒì„±
    private static String buildPDFTaskDescription(String orderNumber, String pdfFileName) {
        String description = 'ğŸ“„ ë‚©ë¶€ì¼ì •ì„œ PDF ìƒì„± ì™„ë£Œ\n\n';
        description += 'ğŸ“‹ ìƒì„± ì •ë³´:\n';
        description += 'â€¢ ì£¼ë¬¸ë²ˆí˜¸: ' + orderNumber + '\n';
        description += 'â€¢ íŒŒì¼ëª…: ' + pdfFileName + '\n';
        description += 'â€¢ ìƒì„±ì¼ì‹œ: ' + System.now().format('yyyy-MM-dd HH:mm:ss') + '\n\n';
        
        description += 'ğŸ“ íŒŒì¼ ìœ„ì¹˜:\n';
        description += 'â€¢ Notes & Attachments ì„¹ì…˜ì—ì„œ í™•ì¸ ê°€ëŠ¥\n';
        description += 'â€¢ ê³ ê° ë°œì†¡ìš©ìœ¼ë¡œ í™œìš© ê°€ëŠ¥\n\n';
        
        description += 'ğŸ“ í›„ì† ì¡°ì¹˜:\n';
        description += 'â€¢ í•„ìš” ì‹œ ê³ ê°ì—ê²Œ ì´ë©”ì¼ ë°œì†¡\n';
        description += 'â€¢ ë‚©ë¶€ ì¼ì • ì•ˆë‚´ ë° í™•ì¸\n';
        
        return description;
    }
    
    // ìŠ¤ì¼€ì¤„ëŸ¬ìš© ì—°ì²´ ì²´í¬ ë©”ì„œë“œ (ì¼ì¼ ë°°ì¹˜ ì‹¤í–‰ìš©)
    @AuraEnabled
    public static void checkAllOverduePayments() {
        try {
            Date today = Date.today();
            
            // ì—°ì²´ëœ ëª¨ë“  PaymentStatus ì¡°íšŒ
            List<PaymentStatus__c> overduePayments = [
                SELECT Id, Order__c, Order__r.OrderNumber, Order__r.Account.Name,
                       Amount__c, DueDate__c, InstallmentNumber__c, Status__c
                FROM PaymentStatus__c 
                WHERE DueDate__c < :today 
                AND Status__c = 'ë¯¸ë‚©'
                ORDER BY DueDate__c ASC
                LIMIT 200
            ];
            
            if (!overduePayments.isEmpty()) {
                // ì˜¤ëŠ˜ ìƒì„±ëœ ì—°ì²´ ì•Œë¦¼ Task ì¡°íšŒ (ì¤‘ë³µ ë°©ì§€)
                Set<String> existingTaskSubjects = new Set<String>();
                List<Task> todayTasks = [
                    SELECT Subject FROM Task 
                    WHERE Subject LIKE '%ì—°ì²´ ì•Œë¦¼%' 
                    AND CreatedDate = TODAY
                ];
                
                for (Task t : todayTasks) {
                    existingTaskSubjects.add(t.Subject);
                }
                
                // ì¤‘ë³µë˜ì§€ ì•Šì€ PaymentStatusë§Œ ì²˜ë¦¬
                List<Id> overdueIds = new List<Id>();
                for (PaymentStatus__c ps : overduePayments) {
                    String expectedSubject = 'ì—°ì²´ ì•Œë¦¼ - ' + ps.Order__r.OrderNumber + ' ' + ps.InstallmentNumber__c + 'ì°¨';
                    if (!existingTaskSubjects.contains(expectedSubject)) {
                        overdueIds.add(ps.Id);
                    }
                }
                
                if (!overdueIds.isEmpty()) {
                    checkOverdueAndCreateTasks(overdueIds);
                }
            }
            
        } catch (Exception e) {
            System.debug('ì¼ê´„ ì—°ì²´ ì²´í¬ ì¤‘ ì˜¤ë¥˜: ' + e.getMessage());
        }
    }
    
    // Wrapper í´ë˜ìŠ¤
    public class PaymentTimelineWrapper {
        @AuraEnabled public Order orderInfo { get; set; }
        @AuraEnabled public List<PaymentStatus__c> paymentStatuses { get; set; }
        @AuraEnabled public Integer totalInstallments { get; set; }
        @AuraEnabled public Integer completedInstallments { get; set; }
        @AuraEnabled public Integer overdueInstallments { get; set; }
        @AuraEnabled public Decimal progressPercentage { get; set; }
    }
}
