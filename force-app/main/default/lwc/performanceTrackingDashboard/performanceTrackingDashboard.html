<template>
    <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ -->
    <template if:true={isLoading}>
        <div class="loading-container">
            <lightning-spinner alternative-text="ëŒ€ì‹œë³´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..." size="large"></lightning-spinner>
            <p class="loading-text">ì„±ê³¼ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
        </div>
    </template>

    <!-- ì—ëŸ¬ ìƒíƒœ -->
    <template if:true={error}>
        <div class="error-container">
            <lightning-icon icon-name="utility:error" variant="error" size="large"></lightning-icon>
            <h3>ë°ì´í„° ë¡œë”© ì˜¤ë¥˜</h3>
            <p>ëŒ€ì‹œë³´ë“œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</p>
            <lightning-button 
                label="ë‹¤ì‹œ ì‹œë„" 
                variant="brand" 
                onclick={handleRefresh}>
            </lightning-button>
        </div>
    </template>

    <!-- ë©”ì¸ ëŒ€ì‹œë³´ë“œ -->
    <template if:true={hasData}>
        <div class="dashboard-container">
            
            <!-- í—¤ë” ì„¹ì…˜ -->
            <div class="dashboard-header">
                <div class="header-content">
                    <h1 class="dashboard-title">
                        <lightning-icon icon-name="standard:dashboard" size="medium"></lightning-icon>
                        ì„±ê³¼ ì¶”ì  ëŒ€ì‹œë³´ë“œ
                    </h1>
                    <div class="header-actions">
                        <span class="last-updated">ìµœì¢… ì—…ë°ì´íŠ¸: {lastUpdated}</span>
                        <lightning-button-icon 
                            icon-name="utility:refresh" 
                            variant="border-filled" 
                            alternative-text="ìƒˆë¡œê³ ì¹¨"
                            title="ìƒˆë¡œê³ ì¹¨"
                            onclick={handleRefresh}>
                        </lightning-button-icon>
                    </div>
                </div>
            </div>

            <!-- ì£¼ìš” ì§€í‘œ ì¹´ë“œ ì„¹ì…˜ -->
            <div class="metrics-grid">
                
                <!-- 1. ì˜¤ëŠ˜ì˜ ì˜ˆìƒ ë§¤ì¶œ -->
                <div class="metric-card today-revenue">
                    <div class="metric-header">
                        <div class="metric-icon">ğŸ’°</div>
                        <h3>ì˜¤ëŠ˜ì˜ ì˜ˆìƒ ë§¤ì¶œ</h3>
                    </div>
                    <div class="metric-content">
                        <div class="metric-main-value">
                            {todayRevenue.expectedAmount}
                        </div>
                        <div class="metric-target">
                            ëª©í‘œ: {todayRevenue.targetAmount}
                        </div>
                        <div class="achievement-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" data-progress={todayRevenue.achievementRate}></div>
                            </div>
                            <span class={todayRevenueStatusClass}>
                                ë‹¬ì„±ë¥ : {todayRevenue.achievementRate}%
                            </span>
                        </div>
                        <div class="metric-detail">
                            ìš°ì„ ìˆœìœ„ ê³ ê° {todayRevenue.priorityCustomers}ëª…
                        </div>
                    </div>
                </div>

                <!-- 2. ì´ë²ˆ ë‹¬ ê°±ì‹  í˜„í™© -->
                <div class="metric-card monthly-renewal">
                    <div class="metric-header">
                        <div class="metric-icon">ğŸ¯</div>
                        <h3>ì´ë²ˆ ë‹¬ ê°±ì‹  í˜„í™©</h3>
                    </div>
                    <div class="metric-content">
                        <div class="renewal-stats">
                            <div class="stat-item completed">
                                <span class="stat-label">ì™„ë£Œ</span>
                                <span class="stat-value">{monthlyRenewal.completedCount}ê±´</span>
                                <span class="stat-amount">{monthlyRenewal.completedAmount}</span>
                            </div>
                            <div class="stat-item in-progress">
                                <span class="stat-label">ì§„í–‰ì¤‘</span>
                                <span class="stat-value">{monthlyRenewal.inProgressCount}ê±´</span>
                                <span class="stat-amount">{monthlyRenewal.inProgressAmount}</span>
                            </div>
                        </div>
                        <div class="total-expected">
                            <strong>ì˜ˆìƒ ì´ ë§¤ì¶œ: {monthlyRenewal.totalExpectedAmount}</strong>
                        </div>
                        <div class="monthly-target">
                            ì›” ëª©í‘œ: {monthlyRenewal.monthlyTarget}
                        </div>
                    </div>
                </div>

                <!-- 3. ê³ ê° ê±´ê°•ë„ ë¶„í¬ -->
                <div class="metric-card customer-health">
                    <div class="metric-header">
                        <div class="metric-icon">ğŸ¥</div>
                        <h3>ê³ ê° ê±´ê°•ë„ ë¶„í¬</h3>
                    </div>
                    <div class="metric-content">
                        <div class="health-chart">
                            <template for:each={customerHealthChartData} for:item="healthItem">
                                <div key={healthItem.label} class="health-item">
                                    <span class="health-icon">{healthItem.icon}</span>
                                    <div class="health-info">
                                        <span class="health-label">{healthItem.label}</span>
                                        <span class="health-count">{healthItem.value}ëª…</span>
                                        <span class="health-percentage">{healthItem.percentage}%</span>
                                    </div>
                                    <div class="health-bar">
                                        <div class="health-fill" 
                                             data-color={healthItem.color}
                                             data-width={healthItem.percentage}>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- 4. ì—…ë¬´ íš¨ìœ¨ì„± ì§€í‘œ -->
                <div class="metric-card efficiency-metrics">
                    <div class="metric-header">
                        <div class="metric-icon">âš¡</div>
                        <h3>ì—…ë¬´ íš¨ìœ¨ì„± ì§€í‘œ</h3>
                    </div>
                    <div class="metric-content">
                        <div class="efficiency-stats">
                            <div class="efficiency-item">
                                <span class="efficiency-label">í‰ê·  ì²˜ë¦¬ ì‹œê°„</span>
                                <span class="efficiency-value">{efficiency.avgProcessingTime}ì´ˆ</span>
                            </div>
                            <div class="efficiency-item">
                                <span class="efficiency-label">ì„±ê³µë¥ </span>
                                <span class="efficiency-value">{efficiency.successRate}%</span>
                            </div>
                            <div class="efficiency-item">
                                <span class="efficiency-label">ì›” ì²˜ë¦¬ ê±´ìˆ˜</span>
                                <span class="efficiency-value">{efficiency.monthlyProcessCount}ê±´</span>
                            </div>
                            <div class="efficiency-item highlight">
                                <span class="efficiency-label">ì‹œê°„ ì ˆì•½</span>
                                <span class="efficiency-value time-saved">{efficiency.timeReduction}</span>
                                <small>Logic 2 íš¨ê³¼</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ê²Œì„í™” ì„¹ì…˜ -->
            <div class="gamification-section">
                <div class="level-card">
                    <div class="level-header">
                        <h2>í˜„ì¬ ë ˆë²¨</h2>
                        <div class="level-badge">
                            <span class="level-icon">{gamification.levelIcon}</span>
                            <span class="level-name">{gamification.currentLevel}</span>
                        </div>
                    </div>
                    <div class="level-progress">
                        <div class="progress-info">
                            <span>í˜„ì¬: {gamification.currentAmount}</span>
                            <span>ëª©í‘œ: {gamification.nextLevelAmount}</span>
                        </div>
                        <div class="level-progress-bar">
                            <div class="level-progress-fill" data-progress={gamification.progressPercentage}></div>
                        </div>
                        <div class="progress-percentage">{gamification.progressPercentage}%</div>
                    </div>
                    <div class="encouragement-message">
                        {gamification.encouragementMessage}
                    </div>
                </div>
            </div>

            <!-- ìŠ¤ë§ˆíŠ¸ ì•Œë¦¼ ì„¹ì…˜ -->
            <div class="notifications-section">
                <div class="notifications-header">
                    <h2>
                        <lightning-icon icon-name="utility:notification" size="small"></lightning-icon>
                        ìŠ¤ë§ˆíŠ¸ ì•Œë¦¼
                    </h2>
                </div>
                
                <template if:true={sortedNotifications.length}>
                    <div class="notifications-list">
                        <template for:each={sortedNotifications} for:item="notification">
                            <button key={notification.id} 
                                 class="notification-item"
                                 data-id={notification.id}
                                 data-priority={notification.priority}
                                 onclick={handleNotificationClick}
                                 type="button"
                                 title={notification.title}>
                                
                                <div class="notification-icon">
                                    {notification.icon}
                                </div>
                                
                                <div class="notification-content">
                                    <div class="notification-title">
                                        {notification.title}
                                    </div>
                                    <div class="notification-message">
                                        {notification.message}
                                    </div>
                                    <div class="notification-time">
                                        {notification.createdDate}
                                    </div>
                                </div>
                                
                                <div class="notification-priority">
                                    <lightning-badge 
                                        label={notification.priority}
                                        variant={notification.priority}>
                                    </lightning-badge>
                                </div>
                            </button>
                        </template>
                    </div>
                </template>
                
                <template if:false={sortedNotifications.length}>
                    <div class="no-notifications">
                        <lightning-icon icon-name="utility:check" variant="success" size="large"></lightning-icon>
                        <p>ëª¨ë“  ì•Œë¦¼ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤!</p>
                        <p>í›Œë¥­í•œ ì„±ê³¼ë¥¼ ìœ ì§€í•˜ê³  ê³„ì‹­ë‹ˆë‹¤.</p>
                    </div>
                </template>
            </div>

            <!-- ë¹ ë¥¸ ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
            <div class="quick-actions">
                <lightning-button 
                    label="ìš°ì„ ìˆœìœ„ ê³ ê° ë³´ê¸°" 
                    variant="brand"
                    icon-name="standard:lead"
                    onclick={handleViewPriorityCustomers}>
                </lightning-button>
                
                <lightning-button 
                    label="ê°±ì‹  í”„ë¡œì„¸ìŠ¤ ì‹œì‘" 
                    variant="success"
                    icon-name="utility:refresh"
                    onclick={handleStartRenewalProcess}>
                </lightning-button>
                
                <lightning-button 
                    label="ìƒì„¸ ë¦¬í¬íŠ¸ ë³´ê¸°" 
                    variant="neutral"
                    icon-name="standard:report"
                    onclick={handleViewDetailedReport}>
                </lightning-button>
            </div>

        </div>
    </template>
</template>
