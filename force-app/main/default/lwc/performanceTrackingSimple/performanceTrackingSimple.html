<template>
    <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ -->
    <template if:true={isLoading}>
        <div class="loading-container">
            <lightning-spinner alternative-text="ëŒ€ì‹œë³´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..." size="large"></lightning-spinner>
            <p class="loading-text">ì„±ê³¼ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
        </div>
    </template>

    <!-- ì—ëŸ¬ ìƒíƒœ -->
    <template if:true={error}>
        <div class="error-container">
            <lightning-icon icon-name="utility:error" variant="error" size="large"></lightning-icon>
            <h3>ë°ì´í„° ë¡œë”© ì˜¤ë¥˜</h3>
            <p>ëŒ€ì‹œë³´ë“œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</p>
            <lightning-button 
                label="ë‹¤ì‹œ ì‹œë„" 
                variant="brand" 
                onclick={handleRefresh}>
            </lightning-button>
        </div>
    </template>

    <!-- ë©”ì¸ ëŒ€ì‹œë³´ë“œ -->
    <template if:true={hasData}>
        <div class="dashboard-container">
            
            <!-- í—¤ë” ì„¹ì…˜ -->
            <div class="dashboard-header">
                <div class="header-content">
                    <h1 class="dashboard-title">
                        <lightning-icon icon-name="standard:dashboard" size="medium"></lightning-icon>
                        ì„±ê³¼ ì¶”ì  ëŒ€ì‹œë³´ë“œ
                    </h1>
                    <div class="header-actions">
                        <span class="last-updated">ìµœì¢… ì—…ë°ì´íŠ¸: {lastUpdated}</span>
                        
                        <!-- Assets í†µí•© ê´€ë¦¬ ë²„íŠ¼ -->
                        <lightning-button 
                            label="Assets ë°ì´í„° ìƒì„±" 
                            variant="success" 
                            icon-name="utility:add"
                            onclick={handleCreateAssetsData}
                            class="assets-setup-btn">
                        </lightning-button>
                        
                        <lightning-button 
                            label="ì „ì²´ ê°±ì‹  ì‹¤í–‰" 
                            variant="brand" 
                            icon-name="utility:refresh"
                            onclick={handleBulkRenewal}
                            class="bulk-renewal-btn">
                        </lightning-button>
                        
                        <lightning-button-icon 
                            icon-name="utility:refresh" 
                            variant="border-filled" 
                            alternative-text="ìƒˆë¡œê³ ì¹¨"
                            title="ìƒˆë¡œê³ ì¹¨"
                            onclick={handleRefresh}>
                        </lightning-button-icon>
                    </div>
                </div>
            </div>

            <!-- ì£¼ìš” ì§€í‘œ ì¹´ë“œ ì„¹ì…˜ -->
            <div class="metrics-grid">
                
                <!-- 1. ì˜¤ëŠ˜ì˜ ì˜ˆìƒ ë§¤ì¶œ -->
                <div class="metric-card today-revenue">
                    <div class="metric-header">
                        <div class="metric-icon">ğŸ’°</div>
                        <h3>ì˜¤ëŠ˜ì˜ ì˜ˆìƒ ë§¤ì¶œ</h3>
                    </div>
                    <div class="metric-content">
                        <div class="metric-main-value">
                            â‚©{todayRevenue.expectedAmount}
                        </div>
                        <div class="metric-target">
                            ëª©í‘œ: â‚©{todayRevenue.targetAmount}
                        </div>
                        <div class="achievement">
                            <span class={todayRevenueStatusClass}>
                                ë‹¬ì„±ë¥ : {todayRevenue.achievementRate}%
                            </span>
                        </div>
                        <div class="metric-detail">
                            ìš°ì„ ìˆœìœ„ ê³ ê° {todayRevenue.priorityCustomers}ëª…
                        </div>
                    </div>
                </div>

                <!-- 2. ì´ë²ˆ ë‹¬ ê°±ì‹  í˜„í™© -->
                <div class="metric-card monthly-renewal">
                    <div class="metric-header">
                        <div class="metric-icon">ğŸ¯</div>
                        <h3>ì´ë²ˆ ë‹¬ ê°±ì‹  í˜„í™©</h3>
                    </div>
                    <div class="metric-content">
                        <div class="renewal-stats">
                            <div class="stat-item">
                                <span class="stat-label">ì™„ë£Œ</span>
                                <span class="stat-value">{monthlyRenewal.completedCount}ê±´</span>
                                <span class="stat-amount">â‚©{monthlyRenewal.completedAmount}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">ì§„í–‰ì¤‘</span>
                                <span class="stat-value">{monthlyRenewal.inProgressCount}ê±´</span>
                                <span class="stat-amount">â‚©{monthlyRenewal.inProgressAmount}</span>
                            </div>
                        </div>
                        <div class="total-expected">
                            <strong>ì´ ì˜ˆìƒ ë§¤ì¶œ: â‚©{monthlyRenewal.totalExpectedAmount}</strong>
                        </div>
                    </div>
                </div>

                <!-- 3. ê³ ê° ê±´ê°•ë„ ë¶„í¬ -->
                <div class="metric-card customer-health">
                    <div class="metric-header">
                        <div class="metric-icon">ğŸ¥</div>
                        <h3>ê³ ê° ê±´ê°•ë„ ë¶„í¬</h3>
                    </div>
                    <div class="metric-content">
                        <div class="health-stats">
                            <div class="health-item healthy">
                                <span class="health-icon">ğŸŸ¢</span>
                                <span class="health-label">ê±´ê°•í•œ ê³ ê°</span>
                                <span class="health-count">{customerHealth.healthyCount}ëª…</span>
                            </div>
                            <div class="health-item warning">
                                <span class="health-icon">ğŸŸ¡</span>
                                <span class="health-label">ì£¼ì˜ ê³ ê°</span>
                                <span class="health-count">{customerHealth.warningCount}ëª…</span>
                            </div>
                            <div class="health-item risk">
                                <span class="health-icon">ğŸ”´</span>
                                <span class="health-label">ìœ„í—˜ ê³ ê°</span>
                                <span class="health-count">{customerHealth.riskCount}ëª…</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 4. ì—…ë¬´ íš¨ìœ¨ì„± ì§€í‘œ -->
                <div class="metric-card efficiency-metrics">
                    <div class="metric-header">
                        <div class="metric-icon">âš¡</div>
                        <h3>ì—…ë¬´ íš¨ìœ¨ì„± ì§€í‘œ</h3>
                    </div>
                    <div class="metric-content">
                        <div class="efficiency-stats">
                            <div class="efficiency-item">
                                <span class="efficiency-label">ì„±ê³µë¥ </span>
                                <span class="efficiency-value">{efficiency.successRate}%</span>
                            </div>
                            <div class="efficiency-item">
                                <span class="efficiency-label">ì›” ì²˜ë¦¬ ê±´ìˆ˜</span>
                                <span class="efficiency-value">{efficiency.monthlyProcessCount}ê±´</span>
                            </div>
                            <div class="efficiency-item highlight">
                                <span class="efficiency-label">ì‹œê°„ ì ˆì•½</span>
                                <span class="efficiency-value">{efficiency.timeReduction}ì´ˆ</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ê²Œì„í™” ì„¹ì…˜ -->
            <div class="gamification-section">
                <div class="level-card">
                    <div class="level-header">
                        <h2>í˜„ì¬ ë ˆë²¨</h2>
                        <div class="level-badge">
                            <span class="level-icon">{gamification.levelIcon}</span>
                            <span class="level-name">{gamification.currentLevel}</span>
                        </div>
                    </div>
                    <div class="level-content">
                        <div class="level-amounts">
                            <span>í˜„ì¬: â‚©{gamification.currentAmount}</span>
                            <span>ëª©í‘œ: â‚©{gamification.nextLevelAmount}</span>
                        </div>
                        <div class="progress-info">
                            <span class="progress-percentage">{gamification.progressPercentage}%</span>
                        </div>
                        <div class="encouragement-message">
                            {gamification.encouragementMessage}
                        </div>
                    </div>
                </div>
            </div>

            <!-- ìŠ¤ë§ˆíŠ¸ ì•Œë¦¼ ì„¹ì…˜ -->
            <template if:true={notifications.length}>
                <div class="notifications-section">
                    <div class="notifications-header">
                        <h2>
                            <lightning-icon icon-name="utility:notification" size="small"></lightning-icon>
                            ìŠ¤ë§ˆíŠ¸ ì•Œë¦¼
                        </h2>
                    </div>
                    
                    <div class="notifications-list">
                        <template for:each={notifications} for:item="notification">
                            <div key={notification.id} class="notification-item">
                                <div class="notification-icon">
                                    {notification.icon}
                                </div>
                                <div class="notification-content">
                                    <div class="notification-title">
                                        {notification.title}
                                    </div>
                                    <div class="notification-message">
                                        {notification.message}
                                    </div>
                                </div>
                                <div class="notification-priority">
                                    <lightning-badge 
                                        label={notification.priority}
                                        variant={notification.priority}>
                                    </lightning-badge>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </template>

        </div>
    </template>
</template>
