<template>
    <div class="asset-sales-dashboard">
        <!-- ÎåÄÏãúÎ≥¥Îìú Ìó§Îçî -->
        <div class="slds-card slds-m-bottom_medium">
            <div class="slds-card__header slds-grid">
                <header class="slds-media slds-media_center slds-has-flexi-truncate">
                    <div class="slds-media__figure">
                        <lightning-icon icon-name="standard:asset_relationship" size="large"></lightning-icon>
                    </div>
                    <div class="slds-media__body">
                        <h1 class="slds-card__header-title">
                            <span class="slds-text-heading_medium">
                                üìä ÏòÅÏóÖ Ïù∏ÏÇ¨Ïù¥Ìä∏ ÎåÄÏãúÎ≥¥Îìú
                            </span>
                        </h1>
                        <p class="slds-text-body_regular slds-text-color_weak">
                            {assetName} ‚Ä¢ {assetPrice} ‚Ä¢ {assetStatus}
                        </p>
                    </div>
                </header>
                <div class="slds-no-flex">
                    <lightning-button 
                        label="ÏÉàÎ°úÍ≥†Ïπ®" 
                        icon-name="utility:refresh"
                        onclick={handleRefresh}
                        variant="neutral">
                    </lightning-button>
                </div>
            </div>
        </div>

        <!-- ÏöîÏïΩ Ïπ¥ÎìúÎì§ -->
        <div class="slds-grid slds-gutters slds-wrap summary-cards">
            <!-- Í∞±Ïã† Í∏∞Ìöå ÏöîÏïΩ -->
            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3">
                <div class="slds-card summary-card renewal-card">
                    <div class="slds-card__body slds-card__body_inner">
                        <div class="slds-media">
                            <div class="slds-media__figure">
                                <lightning-icon icon-name="utility:refresh" size="medium" variant="success"></lightning-icon>
                            </div>
                            <div class="slds-media__body">
                                <div class="slds-text-heading_large">{renewalSummary.totalOpportunities}</div>
                                <div class="slds-text-body_regular">Í∞±Ïã† Í∏∞Ìöå</div>
                                <div class="slds-text-body_small">Í≥†Ïö∞ÏÑ†ÏàúÏúÑ: {renewalSummary.highPriorityCount}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÏòÅÏóÖ Í∏∞Ìöå ÏöîÏïΩ -->
            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3">
                <div class="slds-card summary-card sales-card">
                    <div class="slds-card__body slds-card__body_inner">
                        <div class="slds-media">
                            <div class="slds-media__figure">
                                <lightning-icon icon-name="utility:opportunity" size="medium" variant="brand"></lightning-icon>
                            </div>
                            <div class="slds-media__body">
                                <div class="slds-text-heading_large">{salesSummary.totalValue}</div>
                                <div class="slds-text-body_regular">ÏòÅÏóÖ Í∏∞Ìöå Í∞ÄÏπò</div>
                                <div class="slds-text-body_small">ÏóÖÍ∑∏Î†àÏù¥Îìú: {salesSummary.upgradeCount} | ÌôïÏû•: {salesSummary.crossSellCount}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Î¶¨Ïä§ÌÅ¨ Î∂ÑÏÑù ÏöîÏïΩ -->
            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3">
                <div class="slds-card summary-card risk-card">
                    <div class="slds-card__body slds-card__body_inner">
                        <div class="slds-media">
                            <div class="slds-media__figure">
                                <lightning-icon icon-name="utility:warning" size="medium" variant="warning"></lightning-icon>
                            </div>
                            <div class="slds-media__body">
                                <lightning-badge label={riskSummary.overallRisk} variant={riskSummary.riskVariant}></lightning-badge>
                                <div class="slds-text-body_regular slds-m-top_xx-small">Í≥†Í∞ù Î¶¨Ïä§ÌÅ¨</div>
                                <div class="slds-text-body_small">ÎßåÏ°±ÎèÑ: {riskSummary.satisfactionScore}%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÏÉÅÏÑ∏ Î∂ÑÏÑù ÌÉ≠ -->
        <div class="slds-tabs_default">
            <ul class="slds-tabs_default__nav">
                <li class={renewalTabClass} title="Í∞±Ïã† Í∏∞Ìöå">
                    <button class="slds-tabs_default__link" data-tab="renewal" onclick={handleTabSelect}>
                        üîÑ Í∞±Ïã† Í∏∞Ìöå
                    </button>
                </li>
                <li class={salesTabClass} title="ÏòÅÏóÖ Í∏∞Ìöå">
                    <button class="slds-tabs_default__link" data-tab="sales" onclick={handleTabSelect}>
                        üíº ÏòÅÏóÖ Í∏∞Ìöå
                    </button>
                </li>
                <li class={riskTabClass} title="Î¶¨Ïä§ÌÅ¨ Î∂ÑÏÑù">
                    <button class="slds-tabs_default__link" data-tab="risk" onclick={handleTabSelect}>
                        ‚ö†Ô∏è Î¶¨Ïä§ÌÅ¨ Î∂ÑÏÑù
                    </button>
                </li>
            </ul>

            <!-- Í∞±Ïã† Í∏∞Ìöå ÌÉ≠ -->
            <div if:true={isRenewalTab} class="slds-tabs_default__content">
                <template if:true={renewalOpportunities}>
                    <template for:each={renewalOpportunities} for:item="renewal">
                        <div key={renewal.assetId} class="slds-card slds-m-bottom_medium">
                            <div class="slds-card__header">
                                <div class="slds-grid">
                                    <div class="slds-col slds-grow">
                                        <h3 class="slds-text-heading_small">{renewal.assetName}</h3>
                                        <p class="slds-text-body_small">{renewal.accountName}</p>
                                    </div>
                                    <div class="slds-col slds-no-flex">
                                        <lightning-badge 
                                            label={renewal.priorityScore} 
                                            variant={renewal.priorityVariant}>
                                        </lightning-badge>
                                    </div>
                                </div>
                            </div>
                            <div class="slds-card__body slds-card__body_inner">
                                <div class="slds-grid slds-gutters">
                                    <div class="slds-col slds-size_1-of-2">
                                        <dl class="slds-list_horizontal slds-wrap">
                                            <dt class="slds-item_label slds-text-color_weak">Í∞±Ïã†Ïùº:</dt>
                                            <dd class="slds-item_detail">
                                                <lightning-formatted-text value={renewal.renewalDate}></lightning-formatted-text>
                                            </dd>
                                            <dt class="slds-item_label slds-text-color_weak">ÌòÑÏû¨ Í∞ÄÏπò:</dt>
                                            <dd class="slds-item_detail">
                                                <lightning-formatted-text value={renewal.assetValue}></lightning-formatted-text>
                                            </dd>
                                            <dt class="slds-item_label slds-text-color_weak">ÏòàÏÉÅ Í∞±Ïã†Í∞Ä:</dt>
                                            <dd class="slds-item_detail">
                                                <lightning-formatted-text value={renewal.estimatedRenewalValue}></lightning-formatted-text>
                                            </dd>
                                        </dl>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2">
                                        <div class="slds-text-body_small">
                                            <strong>Í∞±Ïã† Ï†ÑÎûµ:</strong>
                                            <div class="slds-m-top_xx-small">{renewal.renewalStrategy}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-m-top_medium">
                                    <lightning-button 
                                        label="Opportunity ÏÉùÏÑ±" 
                                        data-name={renewal.assetName}
                                        data-value={renewal.estimatedRenewalValue}
                                        onclick={handleCreateOpportunity}
                                        variant="brand"
                                        class="slds-m-right_x-small">
                                    </lightning-button>
                                    <lightning-button 
                                        label="Task ÏÉùÏÑ±" 
                                        data-subject={renewal.assetName}
                                        onclick={handleCreateTask}
                                        variant="neutral">
                                    </lightning-button>
                                </div>
                            </div>
                        </div>
                    </template>
                </template>
                <template if:false={renewalOpportunities}>
                    <div class="slds-text-align_center slds-p-vertical_large">
                        <lightning-icon icon-name="utility:info" variant="neutral" size="large"></lightning-icon>
                        <div class="slds-text-heading_medium slds-m-top_small">Í∞±Ïã† Í∏∞ÌöåÍ∞Ä ÏóÜÏäµÎãàÎã§</div>
                    </div>
                </template>
            </div>

            <!-- ÏòÅÏóÖ Í∏∞Ìöå ÌÉ≠ -->
            <div if:true={isSalesTab} class="slds-tabs_default__content">
                <template if:true={salesOpportunities}>
                    <template for:each={salesOpportunities} for:item="sales">
                        <div key={sales.recommendedProduct} class="slds-card slds-m-bottom_medium">
                            <div class="slds-card__header">
                                <div class="slds-grid">
                                    <div class="slds-col slds-grow">
                                        <h3 class="slds-text-heading_small">{sales.recommendedProduct}</h3>
                                        <lightning-badge label={sales.opportunityType}></lightning-badge>
                                    </div>
                                    <div class="slds-col slds-no-flex">
                                        <span class="slds-text-body_small">Ïã†Î¢∞ÎèÑ: {sales.confidenceLevel}%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="slds-card__body slds-card__body_inner">
                                <div class="slds-grid slds-gutters">
                                    <div class="slds-col slds-size_1-of-2">
                                        <dl class="slds-list_horizontal slds-wrap">
                                            <dt class="slds-item_label slds-text-color_weak">ÌòÑÏû¨:</dt>
                                            <dd class="slds-item_detail">{sales.currentAsset}</dd>
                                            <dt class="slds-item_label slds-text-color_weak">ÏòàÏÉÅ Í∞ÄÏπò:</dt>
                                            <dd class="slds-item_detail">
                                                <lightning-formatted-text value={sales.estimatedValue}></lightning-formatted-text>
                                            </dd>
                                            <dt class="slds-item_label slds-text-color_weak">ÏãúÍ∞Ñ:</dt>
                                            <dd class="slds-item_detail">{sales.timeframe}</dd>
                                        </dl>
                                    </div>
                                    <div class="slds-col slds-size_1-of-2">
                                        <div class="slds-text-body_small">
                                            <strong>Ï∂îÏ≤ú Í∑ºÍ±∞:</strong>
                                            <div class="slds-m-top_xx-small">{sales.reasoning}</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-m-top_medium">
                                    <div class="slds-text-body_small">
                                        <strong>Ïï°ÏÖò ÌîåÎûú:</strong>
                                        <div class="slds-m-top_xx-small">{sales.actionPlan}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                </template>
            </div>

            <!-- Î¶¨Ïä§ÌÅ¨ Î∂ÑÏÑù ÌÉ≠ -->
            <div if:true={isRiskTab} class="slds-tabs_default__content">
                <div class="slds-card">
                    <div class="slds-card__header">
                        <h2 class="slds-card__header-title">
                            <span class="slds-text-heading_small">üéØ Í≥†Í∞ù Î¶¨Ïä§ÌÅ¨ Ï¢ÖÌï© Î∂ÑÏÑù</span>
                        </h2>
                    </div>
                    <div class="slds-card__body slds-card__body_inner">
                        <!-- Î¶¨Ïä§ÌÅ¨ Ï†êÏàò ÏöîÏïΩ -->
                        <div class="slds-grid slds-gutters slds-wrap">
                            <div class="slds-col slds-size_1-of-2 slds-medium-size_1-of-4">
                                <div class="risk-metric">
                                    <div class="slds-text-heading_medium">{riskAnalysis.paymentRiskScore}%</div>
                                    <div class="slds-text-body_small">ÎÇ©Î∂Ä Î¶¨Ïä§ÌÅ¨</div>
                                </div>
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-medium-size_1-of-4">
                                <div class="risk-metric">
                                    <div class="slds-text-heading_medium">{riskAnalysis.usageRiskScore}%</div>
                                    <div class="slds-text-body_small">ÏÇ¨Ïö© Ìå®ÌÑ¥</div>
                                </div>
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-medium-size_1-of-4">
                                <div class="risk-metric">
                                    <div class="slds-text-heading_medium">{riskAnalysis.communicationRiskScore}%</div>
                                    <div class="slds-text-body_small">Ïª§ÎÆ§ÎãàÏºÄÏù¥ÏÖò</div>
                                </div>
                            </div>
                            <div class="slds-col slds-size_1-of-2 slds-medium-size_1-of-4">
                                <div class="risk-metric">
                                    <div class="slds-text-heading_medium">{riskAnalysis.competitorRiskScore}%</div>
                                    <div class="slds-text-body_small">Í≤ΩÏüÅÏÇ¨ ÏúÑÌóò</div>
                                </div>
                            </div>
                        </div>

                        <!-- Ï¢ÖÌï© ÌèâÍ∞Ä -->
                        <div class="slds-m-top_large">
                            <div class="slds-grid slds-gutters">
                                <div class="slds-col slds-size_1-of-2">
                                    <div class="overall-risk">
                                        <div class="slds-text-heading_large">{riskAnalysis.overallRiskScore}%</div>
                                        <lightning-badge 
                                            label={riskAnalysis.riskLevel} 
                                            variant={riskAnalysis.riskVariant}>
                                        </lightning-badge>
                                        <div class="slds-text-body_small">Ï¢ÖÌï© Î¶¨Ïä§ÌÅ¨</div>
                                    </div>
                                </div>
                                <div class="slds-col slds-size_1-of-2">
                                    <div class="satisfaction-score">
                                        <div class="slds-text-heading_large">{riskAnalysis.satisfactionPrediction}%</div>
                                        <lightning-badge 
                                            label={riskAnalysis.satisfactionLevel} 
                                            variant="brand">
                                        </lightning-badge>
                                        <div class="slds-text-body_small">ÎßåÏ°±ÎèÑ ÏòàÏ∏°</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Î¶¨Ïä§ÌÅ¨ ÏôÑÌôî Ïï°ÏÖò -->
                        <div class="slds-m-top_large">
                            <h3 class="slds-text-heading_small slds-m-bottom_small">üéØ Í∂åÏû• Ïï°ÏÖò</h3>
                            <div class="slds-box slds-theme_shade">
                                <div class="slds-text-body_regular">{riskAnalysis.riskMitigationActions}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Î°úÎî© Ïä§ÌîºÎÑà -->
        <template if:true={isLoading}>
            <div class="slds-backdrop slds-backdrop_open">
                <div class="slds-align_absolute-center">
                    <lightning-spinner alternative-text="Î∂ÑÏÑù Ï§ë..." size="medium"></lightning-spinner>
                </div>
            </div>
        </template>
    </div>
</template>
